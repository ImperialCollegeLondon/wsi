
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://imperialcollegelondon.github.io/wsi/reference-wtw/">
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.7">
    
    
      
        <title>API Reference - WTW - WSIMOD docs</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.8608ea7d.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#api-reference-wtw" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="WSIMOD docs" class="md-header__button md-logo" aria-label="WSIMOD docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            WSIMOD docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              API Reference - WTW
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/ImperialCollegeLondon/wsi" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="WSIMOD docs" class="md-nav__button md-logo" aria-label="WSIMOD docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    WSIMOD docs
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ImperialCollegeLondon/wsi" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../paper/paper/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorials/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tutorials
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../how-to/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to guide
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../component-library/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Component library
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../wsimod-cli/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Command line interface
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../dafni/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Run WSIMOD in DAFNI
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API reference
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../demo/scripts/quickstart_demo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quickstart (.py)
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../coverage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Coverage report
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/barneydobson/wsi" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    WSIMOD repository
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#wsimod.nodes.wtw" class="md-nav__link">
    <span class="md-ellipsis">
      wtw
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wsimod.nodes.wtw.FWTW" class="md-nav__link">
    <span class="md-ellipsis">
      FWTW
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FWTW">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.wtw.FWTW.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.wtw.FWTW.apply_overrides" class="md-nav__link">
    <span class="md-ellipsis">
      apply_overrides
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.wtw.FWTW.end_timestep_" class="md-nav__link">
    <span class="md-ellipsis">
      end_timestep_
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.wtw.FWTW.pull_check_fwtw" class="md-nav__link">
    <span class="md-ellipsis">
      pull_check_fwtw
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.wtw.FWTW.pull_set_fwtw" class="md-nav__link">
    <span class="md-ellipsis">
      pull_set_fwtw
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.wtw.FWTW.reinit" class="md-nav__link">
    <span class="md-ellipsis">
      reinit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.wtw.FWTW.treat_water" class="md-nav__link">
    <span class="md-ellipsis">
      treat_water
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wsimod.nodes.wtw.WTW" class="md-nav__link">
    <span class="md-ellipsis">
      WTW
    </span>
  </a>
  
    <nav class="md-nav" aria-label="WTW">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.wtw.WTW.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.wtw.WTW.apply_overrides" class="md-nav__link">
    <span class="md-ellipsis">
      apply_overrides
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.wtw.WTW.calculate_volume" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_volume
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.wtw.WTW.end_timestep" class="md-nav__link">
    <span class="md-ellipsis">
      end_timestep
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.wtw.WTW.get_excess_throughput" class="md-nav__link">
    <span class="md-ellipsis">
      get_excess_throughput
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.wtw.WTW.treat_current_input" class="md-nav__link">
    <span class="md-ellipsis">
      treat_current_input
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wsimod.nodes.wtw.WWTW" class="md-nav__link">
    <span class="md-ellipsis">
      WWTW
    </span>
  </a>
  
    <nav class="md-nav" aria-label="WWTW">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.wtw.WWTW.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.wtw.WWTW.apply_overrides" class="md-nav__link">
    <span class="md-ellipsis">
      apply_overrides
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.wtw.WWTW.calculate_discharge" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_discharge
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.wtw.WWTW.end_timestep_" class="md-nav__link">
    <span class="md-ellipsis">
      end_timestep_
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.wtw.WWTW.make_discharge" class="md-nav__link">
    <span class="md-ellipsis">
      make_discharge
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.wtw.WWTW.pull_check_reuse" class="md-nav__link">
    <span class="md-ellipsis">
      pull_check_reuse
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.wtw.WWTW.pull_set_reuse" class="md-nav__link">
    <span class="md-ellipsis">
      pull_set_reuse
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.wtw.WWTW.push_check_sewer" class="md-nav__link">
    <span class="md-ellipsis">
      push_check_sewer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.wtw.WWTW.push_set_sewer" class="md-nav__link">
    <span class="md-ellipsis">
      push_set_sewer
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="api-reference-wtw">API Reference - WTW</h1>
<p>This section of the documentation provides a reference for the API of the nodes.wtw module.</p>


<div class="doc doc-object doc-module">



<a id="wsimod.nodes.wtw"></a>
    <div class="doc doc-contents first">

        <p>Created on Mon Nov 15 14:20:36 2021.</p>
<p>@author: bdobson
Converted to totals on 2022-05-03</p>








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="wsimod.nodes.wtw.FWTW" class="doc doc-heading">
            <code>FWTW</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="wsimod.nodes.wtw.WTW" href="#wsimod.nodes.wtw.WTW">WTW</a></code></p>


        






              <details class="quote">
                <summary>Source code in <code>wsimod/nodes/wtw.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">FWTW</span><span class="p">(</span><span class="n">WTW</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">service_reservoir_storage_capacity</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">service_reservoir_storage_area</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">service_reservoir_storage_elevation</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">service_reservoir_initial_storage</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">data_input_dict</span><span class="o">=</span><span class="p">{},</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A freshwater treatment works wrapper for WTW. Contains service reservoirs</span>
<span class="sd">        that treated water is released to and pulled from. Cannot allow deficit (thus</span>
<span class="sd">        any deficit is satisfied by water entering the model &#39;via other means&#39;). Liquor</span>
<span class="sd">        and solids are sent to sewers.</span>

<span class="sd">        Args:</span>
<span class="sd">            service_reservoir_storage_capacity (float, optional): Capacity of service</span>
<span class="sd">                reservoirs. Defaults to 10.</span>
<span class="sd">            service_reservoir_storage_area (float, optional): Area of service</span>
<span class="sd">                reservoirs. Defaults to 1.</span>
<span class="sd">            service_reservoir_storage_elevation (float, optional): Datum of service</span>
<span class="sd">                reservoirs. Defaults to 10.</span>
<span class="sd">            service_reservoir_initial_storage (float or dict, optional): initial</span>
<span class="sd">                storage of service reservoirs (see nodes.py/Tank for details).</span>
<span class="sd">                Defaults to 0.</span>
<span class="sd">            data_input_dict (dict, optional): Dictionary of data inputs relevant for</span>
<span class="sd">                the node (though I don&#39;t think it is used). Defaults to {}.</span>

<span class="sd">        Functions intended to call in orchestration:</span>
<span class="sd">            treat_water</span>

<span class="sd">        Key assumptions:</span>
<span class="sd">            - See `wtw.py/WTW` for treatment.</span>
<span class="sd">            - Stores treated water in a service reservoir tank, with a single tank</span>
<span class="sd">                per `FWTW` node.</span>
<span class="sd">            - Aims to satisfy a throughput that would top up the service reservoirs</span>
<span class="sd">                until full.</span>
<span class="sd">            - Currently, will not allow a deficit, thus introducing water from</span>
<span class="sd">                &#39;other measures&#39; if pulls cannot fulfil demand. Behaviour under a</span>
<span class="sd">                deficit should be determined and validated before introducing.</span>

<span class="sd">        Input data and parameter requirements:</span>
<span class="sd">            - See `wtw.py/WTW` for treatment.</span>
<span class="sd">            - Service reservoir tank `capacity`, `area`, and `datum`.</span>
<span class="sd">                _Units_: cubic metres, squared metres, metres</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Default parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">service_reservoir_storage_capacity</span> <span class="o">=</span> <span class="n">service_reservoir_storage_capacity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">service_reservoir_storage_area</span> <span class="o">=</span> <span class="n">service_reservoir_storage_area</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">service_reservoir_storage_elevation</span> <span class="o">=</span> <span class="n">service_reservoir_storage_elevation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">service_reservoir_initial_storage</span> <span class="o">=</span> <span class="n">service_reservoir_initial_storage</span>
        <span class="c1"># TODO don&#39;t think data_input_dict is used</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_input_dict</span> <span class="o">=</span> <span class="n">data_input_dict</span>

        <span class="c1"># Update args</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_timestep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_timestep_</span>

        <span class="c1"># Update handlers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pull_set_handler</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pull_set_fwtw</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pull_check_handler</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pull_check_fwtw</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">push_set_handler</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_set_deny</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push_check_handler</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_check_deny</span>

        <span class="c1"># Initialise parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_deficit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_pulled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">previous_pulled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unpushed_sludge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>

        <span class="c1"># Create tanks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">service_reservoir_tank</span> <span class="o">=</span> <span class="n">Tank</span><span class="p">(</span>
            <span class="n">capacity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">service_reservoir_storage_capacity</span><span class="p">,</span>
            <span class="n">area</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">service_reservoir_storage_area</span><span class="p">,</span>
            <span class="n">datum</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">service_reservoir_storage_elevation</span><span class="p">,</span>
            <span class="n">initial_storage</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">service_reservoir_initial_storage</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># self.service_reservoir_tank.storage[&#39;volume&#39;] =</span>
        <span class="c1"># self.service_reservoir_inital_storage</span>
        <span class="c1"># self.service_reservoir_tank.storage_[&#39;volume&#39;] =</span>
        <span class="c1"># self.service_reservoir_inital_storage</span>

        <span class="c1"># Mass balance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mass_balance_in</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_deficit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mass_balance_ds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">service_reservoir_tank</span><span class="o">.</span><span class="n">ds</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mass_balance_out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpushed_sludge</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">apply_overrides</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">overrides</span><span class="o">=</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Apply overrides to the service reservoir tank and FWTW.</span>

<span class="sd">        Enables a user to override any parameter of the service reservoir tank, and</span>
<span class="sd">        then calls any overrides in WTW.</span>

<span class="sd">        Args:</span>
<span class="sd">            overrides (Dict[str, Any]): Dict describing which parameters should</span>
<span class="sd">                be overridden (keys) and new values (values). Defaults to {}.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">service_reservoir_storage_capacity</span> <span class="o">=</span> <span class="n">overrides</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span>
            <span class="s2">&quot;service_reservoir_storage_capacity&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">service_reservoir_storage_capacity</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">service_reservoir_storage_area</span> <span class="o">=</span> <span class="n">overrides</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span>
            <span class="s2">&quot;service_reservoir_storage_area&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">service_reservoir_storage_area</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">service_reservoir_storage_elevation</span> <span class="o">=</span> <span class="n">overrides</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span>
            <span class="s2">&quot;service_reservoir_storage_elevation&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">service_reservoir_storage_elevation</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">service_reservoir_tank</span><span class="o">.</span><span class="n">capacity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">service_reservoir_storage_capacity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">service_reservoir_tank</span><span class="o">.</span><span class="n">area</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">service_reservoir_storage_area</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">service_reservoir_tank</span><span class="o">.</span><span class="n">datum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">service_reservoir_storage_elevation</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">apply_overrides</span><span class="p">(</span><span class="n">overrides</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">treat_water</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Pulls water, aiming to fill service reservoirs, calls WTW</span>
<span class="sd">        treat_current_input, avoids deficit, sends liquor and solids to sewers.&quot;&quot;&quot;</span>
        <span class="c1"># Calculate how much water is needed</span>
        <span class="n">target_throughput</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">service_reservoir_tank</span><span class="o">.</span><span class="n">get_excess</span><span class="p">()</span>
        <span class="n">target_throughput</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span>
            <span class="n">target_throughput</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">treatment_throughput_capacity</span>
        <span class="p">)</span>

        <span class="c1"># Pull water</span>
        <span class="n">throughput</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pull_distributed</span><span class="p">({</span><span class="s2">&quot;volume&quot;</span><span class="p">:</span> <span class="n">target_throughput</span><span class="p">})</span>

        <span class="c1"># Calculate deficit (assume is equal to difference between previous treated</span>
        <span class="c1"># throughput and current throughput)</span>
        <span class="c1"># TODO think about this a bit more</span>
        <span class="n">deficit</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">target_throughput</span> <span class="o">-</span> <span class="n">throughput</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
        <span class="c1"># deficit = max(self.previous_pulled[&#39;volume&#39;] - throughput[&#39;volume&#39;], 0)</span>
        <span class="n">deficit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_change_vqip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">previous_pulled</span><span class="p">,</span> <span class="n">deficit</span><span class="p">)</span>

        <span class="c1"># Introduce deficit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_input</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum_vqip</span><span class="p">(</span><span class="n">throughput</span><span class="p">,</span> <span class="n">deficit</span><span class="p">)</span>

        <span class="c1"># Track deficit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_deficit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum_vqip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total_deficit</span><span class="p">,</span> <span class="n">deficit</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_deficit</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">constants</span><span class="o">.</span><span class="n">FLOAT_ACCURACY</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;Service reservoirs not filled at </span><span class="si">{0}</span><span class="s2"> on </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="c1"># Run treatment processes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">treat_current_input</span><span class="p">()</span>

        <span class="c1"># Discharge liquor and solids to sewers</span>
        <span class="n">push_back</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum_vqip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">liquor</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">solids</span><span class="p">)</span>
        <span class="n">rejected</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_distributed</span><span class="p">(</span><span class="n">push_back</span><span class="p">,</span> <span class="n">of_type</span><span class="o">=</span><span class="s2">&quot;Sewer&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unpushed_sludge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum_vqip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unpushed_sludge</span><span class="p">,</span> <span class="n">rejected</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rejected</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">constants</span><span class="o">.</span><span class="n">FLOAT_ACCURACY</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;nowhere for sludge to go&quot;</span><span class="p">)</span>

        <span class="c1"># Send water to service reservoirs</span>
        <span class="n">excess</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">service_reservoir_tank</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">treated</span><span class="p">)</span>
        <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">service_reservoir_tank</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="n">excess</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">excess</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;excess treated water&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">pull_check_fwtw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vqip</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Pull checks query service reservoirs.</span>

<span class="sd">        Args:</span>
<span class="sd">            vqip (dict, optional): A VQIP that can be used to limit the volume in</span>
<span class="sd">                the return value (only volume key is used). Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (dict): A VQIP of availability in service reservoirs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">service_reservoir_tank</span><span class="o">.</span><span class="n">get_avail</span><span class="p">(</span><span class="n">vqip</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">pull_set_fwtw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vqip</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Pull treated water from service reservoirs.</span>

<span class="sd">        Args:</span>
<span class="sd">            vqip (dict): a VQIP amount to pull</span>

<span class="sd">        Returns:</span>
<span class="sd">            pulled (dict): A VQIP amount that was successfully pulled</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Pull</span>
        <span class="n">pulled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">service_reservoir_tank</span><span class="o">.</span><span class="n">pull_storage</span><span class="p">(</span><span class="n">vqip</span><span class="p">)</span>
        <span class="c1"># Update total_pulled this timestep</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_pulled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum_vqip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total_pulled</span><span class="p">,</span> <span class="n">pulled</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pulled</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">end_timestep_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update state variables.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">service_reservoir_tank</span><span class="o">.</span><span class="n">end_timestep</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_deficit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">previous_pulled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy_vqip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total_pulled</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_pulled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">treated</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unpushed_sludge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">reinit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call tank reinit.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">service_reservoir_tank</span><span class="o">.</span><span class="n">reinit</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="wsimod.nodes.wtw.FWTW.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">service_reservoir_storage_capacity</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">service_reservoir_storage_area</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">service_reservoir_storage_elevation</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">service_reservoir_initial_storage</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">data_input_dict</span><span class="o">=</span><span class="p">{},</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>A freshwater treatment works wrapper for WTW. Contains service reservoirs
that treated water is released to and pulled from. Cannot allow deficit (thus
any deficit is satisfied by water entering the model 'via other means'). Liquor
and solids are sent to sewers.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>service_reservoir_storage_capacity</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Capacity of service
reservoirs. Defaults to 10.</p>
              </div>
            </td>
            <td>
                  <code>10</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>service_reservoir_storage_area</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Area of service
reservoirs. Defaults to 1.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>service_reservoir_storage_elevation</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Datum of service
reservoirs. Defaults to 10.</p>
              </div>
            </td>
            <td>
                  <code>10</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>service_reservoir_initial_storage</code>
            </td>
            <td>
                  <code><span title="float">float</span> or <span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>initial
storage of service reservoirs (see nodes.py/Tank for details).
Defaults to 0.</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>data_input_dict</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary of data inputs relevant for
the node (though I don't think it is used). Defaults to {}.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="functions-intended-to-call-in-orchestration" open>
  <summary>Functions intended to call in orchestration</summary>
  <p>treat_water</p>
</details>

<details class="key-assumptions" open>
  <summary>Key assumptions</summary>
  <ul>
<li>See <code>wtw.py/WTW</code> for treatment.</li>
<li>Stores treated water in a service reservoir tank, with a single tank
    per <code>FWTW</code> node.</li>
<li>Aims to satisfy a throughput that would top up the service reservoirs
    until full.</li>
<li>Currently, will not allow a deficit, thus introducing water from
    'other measures' if pulls cannot fulfil demand. Behaviour under a
    deficit should be determined and validated before introducing.</li>
</ul>
</details>

<details class="input-data-and-parameter-requirements" open>
  <summary>Input data and parameter requirements</summary>
  <ul>
<li>See <code>wtw.py/WTW</code> for treatment.</li>
<li>Service reservoir tank <code>capacity</code>, <code>area</code>, and <code>datum</code>.
    <em>Units</em>: cubic metres, squared metres, metres</li>
</ul>
</details>
            <details class="quote">
              <summary>Source code in <code>wsimod/nodes/wtw.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">service_reservoir_storage_capacity</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">service_reservoir_storage_area</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">service_reservoir_storage_elevation</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">service_reservoir_initial_storage</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">data_input_dict</span><span class="o">=</span><span class="p">{},</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A freshwater treatment works wrapper for WTW. Contains service reservoirs</span>
<span class="sd">    that treated water is released to and pulled from. Cannot allow deficit (thus</span>
<span class="sd">    any deficit is satisfied by water entering the model &#39;via other means&#39;). Liquor</span>
<span class="sd">    and solids are sent to sewers.</span>

<span class="sd">    Args:</span>
<span class="sd">        service_reservoir_storage_capacity (float, optional): Capacity of service</span>
<span class="sd">            reservoirs. Defaults to 10.</span>
<span class="sd">        service_reservoir_storage_area (float, optional): Area of service</span>
<span class="sd">            reservoirs. Defaults to 1.</span>
<span class="sd">        service_reservoir_storage_elevation (float, optional): Datum of service</span>
<span class="sd">            reservoirs. Defaults to 10.</span>
<span class="sd">        service_reservoir_initial_storage (float or dict, optional): initial</span>
<span class="sd">            storage of service reservoirs (see nodes.py/Tank for details).</span>
<span class="sd">            Defaults to 0.</span>
<span class="sd">        data_input_dict (dict, optional): Dictionary of data inputs relevant for</span>
<span class="sd">            the node (though I don&#39;t think it is used). Defaults to {}.</span>

<span class="sd">    Functions intended to call in orchestration:</span>
<span class="sd">        treat_water</span>

<span class="sd">    Key assumptions:</span>
<span class="sd">        - See `wtw.py/WTW` for treatment.</span>
<span class="sd">        - Stores treated water in a service reservoir tank, with a single tank</span>
<span class="sd">            per `FWTW` node.</span>
<span class="sd">        - Aims to satisfy a throughput that would top up the service reservoirs</span>
<span class="sd">            until full.</span>
<span class="sd">        - Currently, will not allow a deficit, thus introducing water from</span>
<span class="sd">            &#39;other measures&#39; if pulls cannot fulfil demand. Behaviour under a</span>
<span class="sd">            deficit should be determined and validated before introducing.</span>

<span class="sd">    Input data and parameter requirements:</span>
<span class="sd">        - See `wtw.py/WTW` for treatment.</span>
<span class="sd">        - Service reservoir tank `capacity`, `area`, and `datum`.</span>
<span class="sd">            _Units_: cubic metres, squared metres, metres</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Default parameters</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">service_reservoir_storage_capacity</span> <span class="o">=</span> <span class="n">service_reservoir_storage_capacity</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">service_reservoir_storage_area</span> <span class="o">=</span> <span class="n">service_reservoir_storage_area</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">service_reservoir_storage_elevation</span> <span class="o">=</span> <span class="n">service_reservoir_storage_elevation</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">service_reservoir_initial_storage</span> <span class="o">=</span> <span class="n">service_reservoir_initial_storage</span>
    <span class="c1"># TODO don&#39;t think data_input_dict is used</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data_input_dict</span> <span class="o">=</span> <span class="n">data_input_dict</span>

    <span class="c1"># Update args</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">end_timestep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_timestep_</span>

    <span class="c1"># Update handlers</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pull_set_handler</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pull_set_fwtw</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pull_check_handler</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pull_check_fwtw</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">push_set_handler</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_set_deny</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">push_check_handler</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_check_deny</span>

    <span class="c1"># Initialise parameters</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">total_deficit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">total_pulled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">previous_pulled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">unpushed_sludge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>

    <span class="c1"># Create tanks</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">service_reservoir_tank</span> <span class="o">=</span> <span class="n">Tank</span><span class="p">(</span>
        <span class="n">capacity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">service_reservoir_storage_capacity</span><span class="p">,</span>
        <span class="n">area</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">service_reservoir_storage_area</span><span class="p">,</span>
        <span class="n">datum</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">service_reservoir_storage_elevation</span><span class="p">,</span>
        <span class="n">initial_storage</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">service_reservoir_initial_storage</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="c1"># self.service_reservoir_tank.storage[&#39;volume&#39;] =</span>
    <span class="c1"># self.service_reservoir_inital_storage</span>
    <span class="c1"># self.service_reservoir_tank.storage_[&#39;volume&#39;] =</span>
    <span class="c1"># self.service_reservoir_inital_storage</span>

    <span class="c1"># Mass balance</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mass_balance_in</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_deficit</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mass_balance_ds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">service_reservoir_tank</span><span class="o">.</span><span class="n">ds</span><span class="p">())</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mass_balance_out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpushed_sludge</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="wsimod.nodes.wtw.FWTW.apply_overrides" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">apply_overrides</span><span class="p">(</span><span class="n">overrides</span><span class="o">=</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Apply overrides to the service reservoir tank and FWTW.</p>
<p>Enables a user to override any parameter of the service reservoir tank, and
then calls any overrides in WTW.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>overrides</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dict describing which parameters should
be overridden (keys) and new values (values). Defaults to {}.</p>
              </div>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>wsimod/nodes/wtw.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">apply_overrides</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">overrides</span><span class="o">=</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Apply overrides to the service reservoir tank and FWTW.</span>

<span class="sd">    Enables a user to override any parameter of the service reservoir tank, and</span>
<span class="sd">    then calls any overrides in WTW.</span>

<span class="sd">    Args:</span>
<span class="sd">        overrides (Dict[str, Any]): Dict describing which parameters should</span>
<span class="sd">            be overridden (keys) and new values (values). Defaults to {}.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">service_reservoir_storage_capacity</span> <span class="o">=</span> <span class="n">overrides</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span>
        <span class="s2">&quot;service_reservoir_storage_capacity&quot;</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">service_reservoir_storage_capacity</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">service_reservoir_storage_area</span> <span class="o">=</span> <span class="n">overrides</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span>
        <span class="s2">&quot;service_reservoir_storage_area&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">service_reservoir_storage_area</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">service_reservoir_storage_elevation</span> <span class="o">=</span> <span class="n">overrides</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span>
        <span class="s2">&quot;service_reservoir_storage_elevation&quot;</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">service_reservoir_storage_elevation</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">service_reservoir_tank</span><span class="o">.</span><span class="n">capacity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">service_reservoir_storage_capacity</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">service_reservoir_tank</span><span class="o">.</span><span class="n">area</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">service_reservoir_storage_area</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">service_reservoir_tank</span><span class="o">.</span><span class="n">datum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">service_reservoir_storage_elevation</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">apply_overrides</span><span class="p">(</span><span class="n">overrides</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="wsimod.nodes.wtw.FWTW.end_timestep_" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">end_timestep_</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Update state variables.</p>

            <details class="quote">
              <summary>Source code in <code>wsimod/nodes/wtw.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">end_timestep_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update state variables.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">service_reservoir_tank</span><span class="o">.</span><span class="n">end_timestep</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">total_deficit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">previous_pulled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy_vqip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total_pulled</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">total_pulled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">treated</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">unpushed_sludge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="wsimod.nodes.wtw.FWTW.pull_check_fwtw" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pull_check_fwtw</span><span class="p">(</span><span class="n">vqip</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Pull checks query service reservoirs.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>vqip</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A VQIP that can be used to limit the volume in
the return value (only volume key is used). Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A VQIP of availability in service reservoirs</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>wsimod/nodes/wtw.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">pull_check_fwtw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vqip</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Pull checks query service reservoirs.</span>

<span class="sd">    Args:</span>
<span class="sd">        vqip (dict, optional): A VQIP that can be used to limit the volume in</span>
<span class="sd">            the return value (only volume key is used). Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (dict): A VQIP of availability in service reservoirs</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">service_reservoir_tank</span><span class="o">.</span><span class="n">get_avail</span><span class="p">(</span><span class="n">vqip</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="wsimod.nodes.wtw.FWTW.pull_set_fwtw" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pull_set_fwtw</span><span class="p">(</span><span class="n">vqip</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Pull treated water from service reservoirs.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>vqip</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a VQIP amount to pull</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>pulled</code></td>            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A VQIP amount that was successfully pulled</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>wsimod/nodes/wtw.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">pull_set_fwtw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vqip</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Pull treated water from service reservoirs.</span>

<span class="sd">    Args:</span>
<span class="sd">        vqip (dict): a VQIP amount to pull</span>

<span class="sd">    Returns:</span>
<span class="sd">        pulled (dict): A VQIP amount that was successfully pulled</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Pull</span>
    <span class="n">pulled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">service_reservoir_tank</span><span class="o">.</span><span class="n">pull_storage</span><span class="p">(</span><span class="n">vqip</span><span class="p">)</span>
    <span class="c1"># Update total_pulled this timestep</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">total_pulled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum_vqip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total_pulled</span><span class="p">,</span> <span class="n">pulled</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pulled</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="wsimod.nodes.wtw.FWTW.reinit" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">reinit</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Call tank reinit.</p>

            <details class="quote">
              <summary>Source code in <code>wsimod/nodes/wtw.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">reinit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Call tank reinit.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">service_reservoir_tank</span><span class="o">.</span><span class="n">reinit</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="wsimod.nodes.wtw.FWTW.treat_water" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">treat_water</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Pulls water, aiming to fill service reservoirs, calls WTW
treat_current_input, avoids deficit, sends liquor and solids to sewers.</p>

            <details class="quote">
              <summary>Source code in <code>wsimod/nodes/wtw.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">treat_water</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Pulls water, aiming to fill service reservoirs, calls WTW</span>
<span class="sd">    treat_current_input, avoids deficit, sends liquor and solids to sewers.&quot;&quot;&quot;</span>
    <span class="c1"># Calculate how much water is needed</span>
    <span class="n">target_throughput</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">service_reservoir_tank</span><span class="o">.</span><span class="n">get_excess</span><span class="p">()</span>
    <span class="n">target_throughput</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span>
        <span class="n">target_throughput</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">treatment_throughput_capacity</span>
    <span class="p">)</span>

    <span class="c1"># Pull water</span>
    <span class="n">throughput</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pull_distributed</span><span class="p">({</span><span class="s2">&quot;volume&quot;</span><span class="p">:</span> <span class="n">target_throughput</span><span class="p">})</span>

    <span class="c1"># Calculate deficit (assume is equal to difference between previous treated</span>
    <span class="c1"># throughput and current throughput)</span>
    <span class="c1"># TODO think about this a bit more</span>
    <span class="n">deficit</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">target_throughput</span> <span class="o">-</span> <span class="n">throughput</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
    <span class="c1"># deficit = max(self.previous_pulled[&#39;volume&#39;] - throughput[&#39;volume&#39;], 0)</span>
    <span class="n">deficit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_change_vqip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">previous_pulled</span><span class="p">,</span> <span class="n">deficit</span><span class="p">)</span>

    <span class="c1"># Introduce deficit</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">current_input</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum_vqip</span><span class="p">(</span><span class="n">throughput</span><span class="p">,</span> <span class="n">deficit</span><span class="p">)</span>

    <span class="c1"># Track deficit</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">total_deficit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum_vqip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total_deficit</span><span class="p">,</span> <span class="n">deficit</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_deficit</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">constants</span><span class="o">.</span><span class="n">FLOAT_ACCURACY</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;Service reservoirs not filled at </span><span class="si">{0}</span><span class="s2"> on </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="c1"># Run treatment processes</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">treat_current_input</span><span class="p">()</span>

    <span class="c1"># Discharge liquor and solids to sewers</span>
    <span class="n">push_back</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum_vqip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">liquor</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">solids</span><span class="p">)</span>
    <span class="n">rejected</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_distributed</span><span class="p">(</span><span class="n">push_back</span><span class="p">,</span> <span class="n">of_type</span><span class="o">=</span><span class="s2">&quot;Sewer&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">unpushed_sludge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum_vqip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unpushed_sludge</span><span class="p">,</span> <span class="n">rejected</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">rejected</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">constants</span><span class="o">.</span><span class="n">FLOAT_ACCURACY</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;nowhere for sludge to go&quot;</span><span class="p">)</span>

    <span class="c1"># Send water to service reservoirs</span>
    <span class="n">excess</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">service_reservoir_tank</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">treated</span><span class="p">)</span>
    <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">service_reservoir_tank</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="n">excess</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">excess</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;excess treated water&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="wsimod.nodes.wtw.WTW" class="doc doc-heading">
            <code>WTW</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="wsimod.nodes.nodes.Node" href="../reference-nodes/#wsimod.nodes.nodes.Node">Node</a></code></p>


        <p>A generic Water Treatment Works (WTW) node.</p>
<p>This class is a generic water treatment works node. It is intended to be
subclassed into freshwater and wastewater treatment works (FWTW and WWTW
respectively).</p>






              <details class="quote">
                <summary>Source code in <code>wsimod/nodes/wtw.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">WTW</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A generic Water Treatment Works (WTW) node.</span>

<span class="sd">    This class is a generic water treatment works node. It is intended to be</span>
<span class="sd">    subclassed into freshwater and wastewater treatment works (FWTW and WWTW</span>
<span class="sd">    respectively).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">,</span>
        <span class="n">treatment_throughput_capacity</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">process_parameters</span><span class="o">=</span><span class="p">{},</span>
        <span class="n">liquor_multiplier</span><span class="o">=</span><span class="p">{},</span>
        <span class="n">percent_solids</span><span class="o">=</span><span class="mf">0.0002</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generic treatment processes that apply temperature a sensitive transform of</span>
<span class="sd">        pollutants into liquor and solids (behaviour depends on subclass). Push requests</span>
<span class="sd">        are stored in the current_input state variable, but treatment must be triggered</span>
<span class="sd">        with treat_current_input. This treated water is stored in the discharge_holder</span>
<span class="sd">        state variable, which will be sent different depending on FWTW/WWTW.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): Node name</span>
<span class="sd">            treatment_throughput_capacity (float, optional): Amount of volume per</span>
<span class="sd">                timestep of water that can be treated. Defaults to 10.</span>
<span class="sd">            process_parameters (dict, optional): Dict of dicts for each pollutant.</span>
<span class="sd">                Top level key describes pollutant. Next level key describes the</span>
<span class="sd">                constant portion of the transform and the temperature sensitive</span>
<span class="sd">                exponent portion (see core.py/DecayObj for more detailed</span>
<span class="sd">                explanation). Defaults to {}.</span>
<span class="sd">            liquor_multiplier (dict, optional): Keys for each pollutant that</span>
<span class="sd">                describes how much influent becomes liquor. Defaults to {}.</span>
<span class="sd">            percent_solids (float, optional): Proportion of volume that becomes solids.</span>
<span class="sd">                All pollutants that do not become effluent or liquor become solids.</span>
<span class="sd">                Defaults to 0.0002.</span>

<span class="sd">        Functions intended to call in orchestration:</span>
<span class="sd">            None (use FWTW or WWTW subclass)</span>

<span class="sd">        Key assumptions:</span>
<span class="sd">            - Throughput can be modelled entirely with a set capacity.</span>
<span class="sd">            - Pollutant reduction for the entire treatment process can be modelled</span>
<span class="sd">                primarily with a single (temperature sensitive) transformation for</span>
<span class="sd">                each pollutant.</span>
<span class="sd">            - Liquor and solids are tracked and calculated with proportional</span>
<span class="sd">                multiplier parameters.</span>

<span class="sd">        Input data and parameter requirements:</span>
<span class="sd">            - `treatment_throughput_capacity`</span>
<span class="sd">                _Units_: cubic metres/timestep</span>
<span class="sd">            - `process_parameters` contains the constant (non temperature</span>
<span class="sd">                sensitive) and exponent (temperature sensitive) transformations</span>
<span class="sd">                applied to treated water for each pollutant.</span>
<span class="sd">                _Units_: -</span>
<span class="sd">            - `liquor_multiplier` and `percent_solids` describe the proportion of</span>
<span class="sd">                throughput that goes to liquor/solids.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Set/Default parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">treatment_throughput_capacity</span> <span class="o">=</span> <span class="n">treatment_throughput_capacity</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">process_parameters</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process_parameters</span> <span class="o">=</span> <span class="n">process_parameters</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process_parameters</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">x</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;constant&quot;</span><span class="p">:</span> <span class="mf">0.01</span><span class="p">,</span> <span class="s2">&quot;exponent&quot;</span><span class="p">:</span> <span class="mf">1.001</span><span class="p">}</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">ADDITIVE_POLLUTANTS</span>
            <span class="p">}</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">liquor_multiplier</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_liquor_multiplier</span> <span class="o">=</span> <span class="n">liquor_multiplier</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_liquor_multiplier</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span><span class="p">:</span> <span class="mf">0.7</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">ADDITIVE_POLLUTANTS</span><span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_liquor_multiplier</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.03</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_percent_solids</span> <span class="o">=</span> <span class="n">percent_solids</span>

        <span class="c1"># Update args</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">process_parameters</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;constant&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_volume</span><span class="p">()}</span>

        <span class="c1"># Update handlers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push_set_handler</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_set_deny</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push_check_handler</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_check_deny</span>

        <span class="c1"># Initialise parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_input</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">treated</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">liquor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">solids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">calculate_volume</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate the volume proportion of treated water.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (float): Volume of treated water</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_percent_solids</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_liquor_multiplier</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">percent_solids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_percent_solids</span>

    <span class="nd">@percent_solids</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">percent_solids</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_percent_solids</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_parameters</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">][</span><span class="s2">&quot;constant&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_volume</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">liquor_multiplier</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_liquor_multiplier</span>

    <span class="nd">@liquor_multiplier</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">liquor_multiplier</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_liquor_multiplier</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_parameters</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">][</span><span class="s2">&quot;constant&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_volume</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">apply_overrides</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">overrides</span><span class="o">=</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Override parameters.</span>

<span class="sd">        Enables a user to override any of the following parameters:</span>
<span class="sd">        percent_solids, treatment_throughput_capacity, process_parameters (the</span>
<span class="sd">        entire dict does not need to be redefined, only changed values need to</span>
<span class="sd">        be included), liquor_multiplier (as with process_parameters).</span>

<span class="sd">        Args:</span>
<span class="sd">            overrides (Dict[str, Any]): Dict describing which parameters should</span>
<span class="sd">                be overridden (keys) and new values (values). Defaults to {}.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">percent_solids</span> <span class="o">=</span> <span class="n">overrides</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;percent_solids&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_percent_solids</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">liquor_multiplier</span> <span class="o">=</span> <span class="n">overrides</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span>
            <span class="s2">&quot;liquor_multiplier&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_liquor_multiplier</span>
        <span class="p">)</span>
        <span class="n">process_parameters</span> <span class="o">=</span> <span class="n">overrides</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;process_parameters&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">process_parameters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process_parameters</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">treatment_throughput_capacity</span> <span class="o">=</span> <span class="n">overrides</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span>
            <span class="s2">&quot;treatment_throughput_capacity&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">treatment_throughput_capacity</span>
        <span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">apply_overrides</span><span class="p">(</span><span class="n">overrides</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_excess_throughput</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;How much excess treatment capacity is there.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (float): Amount of volume that can still be treated this timestep</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">treatment_throughput_capacity</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_input</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">treat_current_input</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run treatment processes this timestep, including temperature sensitive</span>
<span class="sd">        transforms, liquoring, solids.&quot;&quot;&quot;</span>
        <span class="c1"># Treat current input</span>
        <span class="n">influent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy_vqip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_input</span><span class="p">)</span>

        <span class="c1"># Calculate effluent, liquor and solids</span>
        <span class="n">discharge_holder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>

        <span class="c1"># Assume non-additive pollutants are unchanged in discharge and are</span>
        <span class="c1"># proportionately mixed in liquor</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">NON_ADDITIVE_POLLUTANTS</span><span class="p">:</span>
            <span class="n">discharge_holder</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">influent</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">liquor</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">liquor</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">liquor</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span>
                <span class="o">+</span> <span class="n">influent</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">*</span> <span class="n">influent</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">liquor_multiplier</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span>
            <span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">liquor</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span>
                <span class="o">+</span> <span class="n">influent</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">liquor_multiplier</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span>
            <span class="p">)</span>

        <span class="c1"># TODO this should probably just be for process_parameters.keys() to avoid</span>
        <span class="c1"># having to declare non changing parameters</span>
        <span class="c1"># TODO should the liquoring be temperature sensitive too? As it is the solids</span>
        <span class="c1"># will take the brunt of the temperature variability which maybe isn&#39;t sensible</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">ADDITIVE_POLLUTANTS</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">!=</span> <span class="s2">&quot;volume&quot;</span><span class="p">:</span>
                <span class="c1"># Temperature sensitive transform</span>
                <span class="n">temp_factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_parameters</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;exponent&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="p">(</span>
                    <span class="n">constants</span><span class="o">.</span><span class="n">DECAY_REFERENCE_TEMPERATURE</span> <span class="o">-</span> <span class="n">influent</span><span class="p">[</span><span class="s2">&quot;temperature&quot;</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">temp_factor</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="c1"># Calculate discharge</span>
            <span class="n">discharge_holder</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">influent</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_parameters</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;constant&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">temp_factor</span>
            <span class="p">)</span>
            <span class="c1"># Calculate liquor</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">liquor</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">influent</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">liquor_multiplier</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

        <span class="c1"># Calculate solids volume</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">solids</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">influent</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">percent_solids</span>

        <span class="c1"># All remaining pollutants go to solids</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">ADDITIVE_POLLUTANTS</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">solids</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">influent</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">-</span> <span class="n">discharge_holder</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">liquor</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

        <span class="c1"># Blend with any existing discharge</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">treated</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum_vqip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">treated</span><span class="p">,</span> <span class="n">discharge_holder</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">treated</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_input</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;more treated than input&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">end_timestep</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
        <span class="c1"># Reset state variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_input</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">treated</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="wsimod.nodes.wtw.WTW.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">treatment_throughput_capacity</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">process_parameters</span><span class="o">=</span><span class="p">{},</span> <span class="n">liquor_multiplier</span><span class="o">=</span><span class="p">{},</span> <span class="n">percent_solids</span><span class="o">=</span><span class="mf">0.0002</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Generic treatment processes that apply temperature a sensitive transform of
pollutants into liquor and solids (behaviour depends on subclass). Push requests
are stored in the current_input state variable, but treatment must be triggered
with treat_current_input. This treated water is stored in the discharge_holder
state variable, which will be sent different depending on FWTW/WWTW.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Node name</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>treatment_throughput_capacity</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Amount of volume per
timestep of water that can be treated. Defaults to 10.</p>
              </div>
            </td>
            <td>
                  <code>10</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>process_parameters</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dict of dicts for each pollutant.
Top level key describes pollutant. Next level key describes the
constant portion of the transform and the temperature sensitive
exponent portion (see core.py/DecayObj for more detailed
explanation). Defaults to {}.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>liquor_multiplier</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Keys for each pollutant that
describes how much influent becomes liquor. Defaults to {}.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>percent_solids</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Proportion of volume that becomes solids.
All pollutants that do not become effluent or liquor become solids.
Defaults to 0.0002.</p>
              </div>
            </td>
            <td>
                  <code>0.0002</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="functions-intended-to-call-in-orchestration" open>
  <summary>Functions intended to call in orchestration</summary>
  <p>None (use FWTW or WWTW subclass)</p>
</details>

<details class="key-assumptions" open>
  <summary>Key assumptions</summary>
  <ul>
<li>Throughput can be modelled entirely with a set capacity.</li>
<li>Pollutant reduction for the entire treatment process can be modelled
    primarily with a single (temperature sensitive) transformation for
    each pollutant.</li>
<li>Liquor and solids are tracked and calculated with proportional
    multiplier parameters.</li>
</ul>
</details>

<details class="input-data-and-parameter-requirements" open>
  <summary>Input data and parameter requirements</summary>
  <ul>
<li><code>treatment_throughput_capacity</code>
    <em>Units</em>: cubic metres/timestep</li>
<li><code>process_parameters</code> contains the constant (non temperature
    sensitive) and exponent (temperature sensitive) transformations
    applied to treated water for each pollutant.
    <em>Units</em>: -</li>
<li><code>liquor_multiplier</code> and <code>percent_solids</code> describe the proportion of
    throughput that goes to liquor/solids.</li>
</ul>
</details>
            <details class="quote">
              <summary>Source code in <code>wsimod/nodes/wtw.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">name</span><span class="p">,</span>
    <span class="n">treatment_throughput_capacity</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">process_parameters</span><span class="o">=</span><span class="p">{},</span>
    <span class="n">liquor_multiplier</span><span class="o">=</span><span class="p">{},</span>
    <span class="n">percent_solids</span><span class="o">=</span><span class="mf">0.0002</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generic treatment processes that apply temperature a sensitive transform of</span>
<span class="sd">    pollutants into liquor and solids (behaviour depends on subclass). Push requests</span>
<span class="sd">    are stored in the current_input state variable, but treatment must be triggered</span>
<span class="sd">    with treat_current_input. This treated water is stored in the discharge_holder</span>
<span class="sd">    state variable, which will be sent different depending on FWTW/WWTW.</span>

<span class="sd">    Args:</span>
<span class="sd">        name (str): Node name</span>
<span class="sd">        treatment_throughput_capacity (float, optional): Amount of volume per</span>
<span class="sd">            timestep of water that can be treated. Defaults to 10.</span>
<span class="sd">        process_parameters (dict, optional): Dict of dicts for each pollutant.</span>
<span class="sd">            Top level key describes pollutant. Next level key describes the</span>
<span class="sd">            constant portion of the transform and the temperature sensitive</span>
<span class="sd">            exponent portion (see core.py/DecayObj for more detailed</span>
<span class="sd">            explanation). Defaults to {}.</span>
<span class="sd">        liquor_multiplier (dict, optional): Keys for each pollutant that</span>
<span class="sd">            describes how much influent becomes liquor. Defaults to {}.</span>
<span class="sd">        percent_solids (float, optional): Proportion of volume that becomes solids.</span>
<span class="sd">            All pollutants that do not become effluent or liquor become solids.</span>
<span class="sd">            Defaults to 0.0002.</span>

<span class="sd">    Functions intended to call in orchestration:</span>
<span class="sd">        None (use FWTW or WWTW subclass)</span>

<span class="sd">    Key assumptions:</span>
<span class="sd">        - Throughput can be modelled entirely with a set capacity.</span>
<span class="sd">        - Pollutant reduction for the entire treatment process can be modelled</span>
<span class="sd">            primarily with a single (temperature sensitive) transformation for</span>
<span class="sd">            each pollutant.</span>
<span class="sd">        - Liquor and solids are tracked and calculated with proportional</span>
<span class="sd">            multiplier parameters.</span>

<span class="sd">    Input data and parameter requirements:</span>
<span class="sd">        - `treatment_throughput_capacity`</span>
<span class="sd">            _Units_: cubic metres/timestep</span>
<span class="sd">        - `process_parameters` contains the constant (non temperature</span>
<span class="sd">            sensitive) and exponent (temperature sensitive) transformations</span>
<span class="sd">            applied to treated water for each pollutant.</span>
<span class="sd">            _Units_: -</span>
<span class="sd">        - `liquor_multiplier` and `percent_solids` describe the proportion of</span>
<span class="sd">            throughput that goes to liquor/solids.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Set/Default parameters</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">treatment_throughput_capacity</span> <span class="o">=</span> <span class="n">treatment_throughput_capacity</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">process_parameters</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_parameters</span> <span class="o">=</span> <span class="n">process_parameters</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_parameters</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">x</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;constant&quot;</span><span class="p">:</span> <span class="mf">0.01</span><span class="p">,</span> <span class="s2">&quot;exponent&quot;</span><span class="p">:</span> <span class="mf">1.001</span><span class="p">}</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">ADDITIVE_POLLUTANTS</span>
        <span class="p">}</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">liquor_multiplier</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_liquor_multiplier</span> <span class="o">=</span> <span class="n">liquor_multiplier</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_liquor_multiplier</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span><span class="p">:</span> <span class="mf">0.7</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">ADDITIVE_POLLUTANTS</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_liquor_multiplier</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.03</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_percent_solids</span> <span class="o">=</span> <span class="n">percent_solids</span>

    <span class="c1"># Update args</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">process_parameters</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;constant&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_volume</span><span class="p">()}</span>

    <span class="c1"># Update handlers</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">push_set_handler</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_set_deny</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">push_check_handler</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_check_deny</span>

    <span class="c1"># Initialise parameters</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">current_input</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">treated</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">liquor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">solids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="wsimod.nodes.wtw.WTW.apply_overrides" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">apply_overrides</span><span class="p">(</span><span class="n">overrides</span><span class="o">=</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Override parameters.</p>
<p>Enables a user to override any of the following parameters:
percent_solids, treatment_throughput_capacity, process_parameters (the
entire dict does not need to be redefined, only changed values need to
be included), liquor_multiplier (as with process_parameters).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>overrides</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dict describing which parameters should
be overridden (keys) and new values (values). Defaults to {}.</p>
              </div>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>wsimod/nodes/wtw.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">apply_overrides</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">overrides</span><span class="o">=</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Override parameters.</span>

<span class="sd">    Enables a user to override any of the following parameters:</span>
<span class="sd">    percent_solids, treatment_throughput_capacity, process_parameters (the</span>
<span class="sd">    entire dict does not need to be redefined, only changed values need to</span>
<span class="sd">    be included), liquor_multiplier (as with process_parameters).</span>

<span class="sd">    Args:</span>
<span class="sd">        overrides (Dict[str, Any]): Dict describing which parameters should</span>
<span class="sd">            be overridden (keys) and new values (values). Defaults to {}.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">percent_solids</span> <span class="o">=</span> <span class="n">overrides</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;percent_solids&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_percent_solids</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">liquor_multiplier</span> <span class="o">=</span> <span class="n">overrides</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span>
        <span class="s2">&quot;liquor_multiplier&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_liquor_multiplier</span>
    <span class="p">)</span>
    <span class="n">process_parameters</span> <span class="o">=</span> <span class="n">overrides</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;process_parameters&quot;</span><span class="p">,</span> <span class="p">{})</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">process_parameters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_parameters</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">treatment_throughput_capacity</span> <span class="o">=</span> <span class="n">overrides</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span>
        <span class="s2">&quot;treatment_throughput_capacity&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">treatment_throughput_capacity</span>
    <span class="p">)</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">apply_overrides</span><span class="p">(</span><span class="n">overrides</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="wsimod.nodes.wtw.WTW.calculate_volume" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_volume</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Calculate the volume proportion of treated water.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Volume of treated water</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>wsimod/nodes/wtw.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_volume</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the volume proportion of treated water.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (float): Volume of treated water</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_percent_solids</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_liquor_multiplier</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="wsimod.nodes.wtw.WTW.end_timestep" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">end_timestep</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        

            <details class="quote">
              <summary>Source code in <code>wsimod/nodes/wtw.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">end_timestep</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
    <span class="c1"># Reset state variables</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">current_input</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">treated</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="wsimod.nodes.wtw.WTW.get_excess_throughput" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_excess_throughput</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>How much excess treatment capacity is there.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Amount of volume that can still be treated this timestep</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>wsimod/nodes/wtw.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_excess_throughput</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;How much excess treatment capacity is there.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (float): Amount of volume that can still be treated this timestep</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">treatment_throughput_capacity</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_input</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="wsimod.nodes.wtw.WTW.treat_current_input" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">treat_current_input</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Run treatment processes this timestep, including temperature sensitive
transforms, liquoring, solids.</p>

            <details class="quote">
              <summary>Source code in <code>wsimod/nodes/wtw.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">treat_current_input</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run treatment processes this timestep, including temperature sensitive</span>
<span class="sd">    transforms, liquoring, solids.&quot;&quot;&quot;</span>
    <span class="c1"># Treat current input</span>
    <span class="n">influent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy_vqip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_input</span><span class="p">)</span>

    <span class="c1"># Calculate effluent, liquor and solids</span>
    <span class="n">discharge_holder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>

    <span class="c1"># Assume non-additive pollutants are unchanged in discharge and are</span>
    <span class="c1"># proportionately mixed in liquor</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">NON_ADDITIVE_POLLUTANTS</span><span class="p">:</span>
        <span class="n">discharge_holder</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">influent</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">liquor</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">liquor</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">liquor</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span>
            <span class="o">+</span> <span class="n">influent</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">*</span> <span class="n">influent</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">liquor_multiplier</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span>
        <span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">liquor</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span>
            <span class="o">+</span> <span class="n">influent</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">liquor_multiplier</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span>
        <span class="p">)</span>

    <span class="c1"># TODO this should probably just be for process_parameters.keys() to avoid</span>
    <span class="c1"># having to declare non changing parameters</span>
    <span class="c1"># TODO should the liquoring be temperature sensitive too? As it is the solids</span>
    <span class="c1"># will take the brunt of the temperature variability which maybe isn&#39;t sensible</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">ADDITIVE_POLLUTANTS</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">!=</span> <span class="s2">&quot;volume&quot;</span><span class="p">:</span>
            <span class="c1"># Temperature sensitive transform</span>
            <span class="n">temp_factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_parameters</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;exponent&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="p">(</span>
                <span class="n">constants</span><span class="o">.</span><span class="n">DECAY_REFERENCE_TEMPERATURE</span> <span class="o">-</span> <span class="n">influent</span><span class="p">[</span><span class="s2">&quot;temperature&quot;</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">temp_factor</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="c1"># Calculate discharge</span>
        <span class="n">discharge_holder</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">influent</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_parameters</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;constant&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">temp_factor</span>
        <span class="p">)</span>
        <span class="c1"># Calculate liquor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">liquor</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">influent</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">liquor_multiplier</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="c1"># Calculate solids volume</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">solids</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">influent</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">percent_solids</span>

    <span class="c1"># All remaining pollutants go to solids</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">ADDITIVE_POLLUTANTS</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">solids</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">influent</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">-</span> <span class="n">discharge_holder</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">liquor</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="c1"># Blend with any existing discharge</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">treated</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum_vqip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">treated</span><span class="p">,</span> <span class="n">discharge_holder</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">treated</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_input</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;more treated than input&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="wsimod.nodes.wtw.WWTW" class="doc doc-heading">
            <code>WWTW</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="wsimod.nodes.wtw.WTW" href="#wsimod.nodes.wtw.WTW">WTW</a></code></p>


        <p>Wastewater Treatment Works (WWTW) node.</p>






              <details class="quote">
                <summary>Source code in <code>wsimod/nodes/wtw.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">WWTW</span><span class="p">(</span><span class="n">WTW</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Wastewater Treatment Works (WWTW) node.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">stormwater_storage_capacity</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">stormwater_storage_area</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">stormwater_storage_elevation</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A wastewater treatment works wrapper for WTW. Contains a temporary stormwater</span>
<span class="sd">        storage tank. Liquor is combined with current_effluent and re- treated while</span>
<span class="sd">        solids leave the model.</span>

<span class="sd">        Args:</span>
<span class="sd">            stormwater_storage_capacity (float, optional): Capacity of stormwater tank.</span>
<span class="sd">                Defaults to 10.</span>
<span class="sd">            stormwater_storage_area (float, optional): Area of stormwater tank.</span>
<span class="sd">                Defaults to 1.</span>
<span class="sd">            stormwater_storage_elevation (float, optional): Datum of stormwater tank.</span>
<span class="sd">                Defaults to 10.</span>

<span class="sd">        Functions intended to call in orchestration:</span>
<span class="sd">            calculate_discharge</span>

<span class="sd">            make_discharge</span>

<span class="sd">        Key assumptions:</span>
<span class="sd">            - See `wtw.py/WTW` for treatment.</span>
<span class="sd">            - When `treatment_throughput_capacity` is exceeded, water is first sent</span>
<span class="sd">                to a stormwater storage tank before denying pushes. Leftover water</span>
<span class="sd">                in this tank aims to be treated in subsequent timesteps.</span>
<span class="sd">            - Can be pulled from to simulate active wastewater effluent use.</span>

<span class="sd">        Input data and parameter requirements:</span>
<span class="sd">            - See `wtw.py/WTW` for treatment.</span>
<span class="sd">            - Stormwater tank `capacity`, `area`, and `datum`.</span>
<span class="sd">                _Units_: cubic metres, squared metres, metres</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Set parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stormwater_storage_capacity</span> <span class="o">=</span> <span class="n">stormwater_storage_capacity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stormwater_storage_area</span> <span class="o">=</span> <span class="n">stormwater_storage_area</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stormwater_storage_elevation</span> <span class="o">=</span> <span class="n">stormwater_storage_elevation</span>

        <span class="c1"># Update args</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">end_timestep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_timestep_</span>

        <span class="c1"># Update handlers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pull_set_handler</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pull_set_reuse</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pull_check_handler</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pull_check_reuse</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push_set_handler</span><span class="p">[</span><span class="s2">&quot;Sewer&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_set_sewer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push_check_handler</span><span class="p">[</span><span class="s2">&quot;Sewer&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_check_sewer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push_check_handler</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_check_sewer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push_set_handler</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_set_sewer</span>

        <span class="c1"># Create tank</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stormwater_tank</span> <span class="o">=</span> <span class="n">Tank</span><span class="p">(</span>
            <span class="n">capacity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stormwater_storage_capacity</span><span class="p">,</span>
            <span class="n">area</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stormwater_storage_area</span><span class="p">,</span>
            <span class="n">datum</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stormwater_storage_elevation</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Initialise states</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">liquor_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">previous_input</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_input</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>  <span class="c1"># TODO is this not done in WTW?</span>

        <span class="c1"># Mass balance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mass_balance_out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">solids</span><span class="p">)</span>  <span class="c1"># Assume these go to landfill</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mass_balance_ds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">stormwater_tank</span><span class="o">.</span><span class="n">ds</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mass_balance_ds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds_vqip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">liquor</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">liquor_</span><span class="p">)</span>
        <span class="p">)</span>  <span class="c1"># Change in liquor</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">apply_overrides</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">overrides</span><span class="o">=</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Apply overrides to the stormwater tank and WWTW.</span>

<span class="sd">        Enables a user to override any parameter of the stormwater tank, and</span>
<span class="sd">        then calls any overrides in WTW.</span>

<span class="sd">        Args:</span>
<span class="sd">            overrides (Dict[str, Any]): Dict describing which parameters should</span>
<span class="sd">                be overridden (keys) and new values (values). Defaults to {}.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stormwater_storage_capacity</span> <span class="o">=</span> <span class="n">overrides</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span>
            <span class="s2">&quot;stormwater_storage_capacity&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stormwater_storage_capacity</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stormwater_storage_area</span> <span class="o">=</span> <span class="n">overrides</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span>
            <span class="s2">&quot;stormwater_storage_area&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stormwater_storage_area</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stormwater_storage_elevation</span> <span class="o">=</span> <span class="n">overrides</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span>
            <span class="s2">&quot;stormwater_storage_elevation&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stormwater_storage_elevation</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stormwater_tank</span><span class="o">.</span><span class="n">area</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stormwater_storage_area</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stormwater_tank</span><span class="o">.</span><span class="n">capacity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stormwater_storage_capacity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stormwater_tank</span><span class="o">.</span><span class="n">datum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stormwater_storage_elevation</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">apply_overrides</span><span class="p">(</span><span class="n">overrides</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">calculate_discharge</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Clear stormwater tank if possible, and call treat_current_input.&quot;&quot;&quot;</span>
        <span class="c1"># Run WWTW model</span>

        <span class="c1"># Try to clear stormwater</span>
        <span class="c1"># TODO (probably more tidy to use push_set_sewer? though maybe less</span>
        <span class="c1"># computationally efficient)</span>
        <span class="n">excess</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_excess_throughput</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stormwater_tank</span><span class="o">.</span><span class="n">get_avail</span><span class="p">()[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">constants</span><span class="o">.</span><span class="n">FLOAT_ACCURACY</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span>
            <span class="n">excess</span> <span class="o">&gt;</span> <span class="n">constants</span><span class="o">.</span><span class="n">FLOAT_ACCURACY</span>
        <span class="p">):</span>
            <span class="n">to_pull</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">excess</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stormwater_tank</span><span class="o">.</span><span class="n">get_avail</span><span class="p">()[</span><span class="s2">&quot;volume&quot;</span><span class="p">])</span>
            <span class="n">to_pull</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_change_vqip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stormwater_tank</span><span class="o">.</span><span class="n">storage</span><span class="p">,</span> <span class="n">to_pull</span><span class="p">)</span>
            <span class="n">cleared_stormwater</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stormwater_tank</span><span class="o">.</span><span class="n">pull_storage</span><span class="p">(</span><span class="n">to_pull</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_input</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum_vqip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_input</span><span class="p">,</span> <span class="n">cleared_stormwater</span><span class="p">)</span>

        <span class="c1"># Run processes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_input</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum_vqip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_input</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">liquor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">treat_current_input</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">make_discharge</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Discharge treated effluent.&quot;&quot;&quot;</span>
        <span class="n">reply</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_distributed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">treated</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">treated</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">constants</span><span class="o">.</span><span class="n">FLOAT_ACCURACY</span><span class="p">:</span>
            <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stormwater_tank</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="n">reply</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WWTW couldnt push&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">push_check_sewer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vqip</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check throughput and stormwater tank capacity.</span>

<span class="sd">        Args:</span>
<span class="sd">            vqip (dict, optional): A VQIP that can be used to limit the volume in</span>
<span class="sd">                the return value (only volume key is used). Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (dict): excess</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Get excess</span>
        <span class="n">excess_throughput</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_excess_throughput</span><span class="p">()</span>
        <span class="n">excess_tank</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stormwater_tank</span><span class="o">.</span><span class="n">get_excess</span><span class="p">()</span>
        <span class="c1"># Combine tank and throughput</span>
        <span class="n">vol</span> <span class="o">=</span> <span class="n">excess_tank</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">excess_throughput</span>
        <span class="c1"># Update volume</span>
        <span class="k">if</span> <span class="n">vqip</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">vqip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">vol</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">vol</span><span class="p">,</span> <span class="n">vqip</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">])</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_change_vqip</span><span class="p">(</span><span class="n">vqip</span><span class="p">,</span> <span class="n">vol</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">push_set_sewer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vqip</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Receive water, first try to update current_input, and then stormwater tank.</span>

<span class="sd">        Args:</span>
<span class="sd">            vqip (dict): A VQIP amount to be treated and then stored</span>

<span class="sd">        Returns:</span>
<span class="sd">            (dict): A VQIP amount of water that was not treated</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Receive water from sewers</span>
        <span class="n">vqip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy_vqip</span><span class="p">(</span><span class="n">vqip</span><span class="p">)</span>
        <span class="c1"># Check if can directly be treated</span>
        <span class="n">sent_direct</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_excess_throughput</span><span class="p">()</span>

        <span class="n">sent_direct</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">sent_direct</span><span class="p">,</span> <span class="n">vqip</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">])</span>

        <span class="n">sent_direct</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_change_vqip</span><span class="p">(</span><span class="n">vqip</span><span class="p">,</span> <span class="n">sent_direct</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">current_input</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum_vqip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_input</span><span class="p">,</span> <span class="n">sent_direct</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">sent_direct</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">vqip</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]:</span>
            <span class="c1"># If all added to input, no problem</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>

        <span class="c1"># Next try temporary storage</span>
        <span class="n">vqip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_change_vqip</span><span class="p">(</span><span class="n">vqip</span><span class="p">,</span> <span class="n">vqip</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">sent_direct</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">])</span>

        <span class="n">vqip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stormwater_tank</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="n">vqip</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">vqip</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">constants</span><span class="o">.</span><span class="n">FLOAT_ACCURACY</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># TODO what to do here ???</span>
            <span class="k">return</span> <span class="n">vqip</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">pull_set_reuse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vqip</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Enables WWTW to receive pulls of the treated water (i.e., for wastewater</span>
<span class="sd">        reuse or satisfaction of environmental flows). Intended to be called in between</span>
<span class="sd">        calculate_discharge and make_discharge.</span>

<span class="sd">        Args:</span>
<span class="sd">            vqip (dict): A VQIP amount to be pulled (only &#39;volume&#39; key is used)</span>

<span class="sd">        Returns:</span>
<span class="sd">            reply (dict): Amount of water that has been pulled</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Satisfy request with treated (volume)</span>
        <span class="n">reply_vol</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">vqip</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">treated</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">])</span>
        <span class="c1"># Update pollutants</span>
        <span class="n">reply</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_change_vqip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">treated</span><span class="p">,</span> <span class="n">reply_vol</span><span class="p">)</span>
        <span class="c1"># Update treated</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">treated</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_change_vqip</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">treated</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">treated</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">reply_vol</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">reply</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">pull_check_reuse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vqip</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Pull check available water. Simply returns the previous timestep&#39;s treated</span>
<span class="sd">        throughput. This is of course inaccurate (which may lead to slightly longer</span>
<span class="sd">        calulcations), but it is much more flexible. This hasn&#39;t been recently tested so</span>
<span class="sd">        it might be that returning treated would be fine (and more accurate!).</span>

<span class="sd">        Args:</span>
<span class="sd">            vqip (dict, optional): A VQIP that can be used to limit the volume in</span>
<span class="sd">                the return value (only volume key is used). Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (dict): A VQIP amount of water available. Currently just the previous</span>
<span class="sd">                timestep&#39;s treated throughput</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Respond to request of water for reuse/MRF</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy_vqip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">treated</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">end_timestep_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;End timestep function to update state variables.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">liquor_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy_vqip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">liquor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">previous_input</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy_vqip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_input</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_input</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">solids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stormwater_tank</span><span class="o">.</span><span class="n">end_timestep</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="wsimod.nodes.wtw.WWTW.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">stormwater_storage_capacity</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">stormwater_storage_area</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">stormwater_storage_elevation</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>A wastewater treatment works wrapper for WTW. Contains a temporary stormwater
storage tank. Liquor is combined with current_effluent and re- treated while
solids leave the model.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>stormwater_storage_capacity</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Capacity of stormwater tank.
Defaults to 10.</p>
              </div>
            </td>
            <td>
                  <code>10</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>stormwater_storage_area</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Area of stormwater tank.
Defaults to 1.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>stormwater_storage_elevation</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Datum of stormwater tank.
Defaults to 10.</p>
              </div>
            </td>
            <td>
                  <code>10</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="functions-intended-to-call-in-orchestration" open>
  <summary>Functions intended to call in orchestration</summary>
  <p>calculate_discharge</p>
<p>make_discharge</p>
</details>

<details class="key-assumptions" open>
  <summary>Key assumptions</summary>
  <ul>
<li>See <code>wtw.py/WTW</code> for treatment.</li>
<li>When <code>treatment_throughput_capacity</code> is exceeded, water is first sent
    to a stormwater storage tank before denying pushes. Leftover water
    in this tank aims to be treated in subsequent timesteps.</li>
<li>Can be pulled from to simulate active wastewater effluent use.</li>
</ul>
</details>

<details class="input-data-and-parameter-requirements" open>
  <summary>Input data and parameter requirements</summary>
  <ul>
<li>See <code>wtw.py/WTW</code> for treatment.</li>
<li>Stormwater tank <code>capacity</code>, <code>area</code>, and <code>datum</code>.
    <em>Units</em>: cubic metres, squared metres, metres</li>
</ul>
</details>
            <details class="quote">
              <summary>Source code in <code>wsimod/nodes/wtw.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">stormwater_storage_capacity</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">stormwater_storage_area</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">stormwater_storage_elevation</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A wastewater treatment works wrapper for WTW. Contains a temporary stormwater</span>
<span class="sd">    storage tank. Liquor is combined with current_effluent and re- treated while</span>
<span class="sd">    solids leave the model.</span>

<span class="sd">    Args:</span>
<span class="sd">        stormwater_storage_capacity (float, optional): Capacity of stormwater tank.</span>
<span class="sd">            Defaults to 10.</span>
<span class="sd">        stormwater_storage_area (float, optional): Area of stormwater tank.</span>
<span class="sd">            Defaults to 1.</span>
<span class="sd">        stormwater_storage_elevation (float, optional): Datum of stormwater tank.</span>
<span class="sd">            Defaults to 10.</span>

<span class="sd">    Functions intended to call in orchestration:</span>
<span class="sd">        calculate_discharge</span>

<span class="sd">        make_discharge</span>

<span class="sd">    Key assumptions:</span>
<span class="sd">        - See `wtw.py/WTW` for treatment.</span>
<span class="sd">        - When `treatment_throughput_capacity` is exceeded, water is first sent</span>
<span class="sd">            to a stormwater storage tank before denying pushes. Leftover water</span>
<span class="sd">            in this tank aims to be treated in subsequent timesteps.</span>
<span class="sd">        - Can be pulled from to simulate active wastewater effluent use.</span>

<span class="sd">    Input data and parameter requirements:</span>
<span class="sd">        - See `wtw.py/WTW` for treatment.</span>
<span class="sd">        - Stormwater tank `capacity`, `area`, and `datum`.</span>
<span class="sd">            _Units_: cubic metres, squared metres, metres</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Set parameters</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">stormwater_storage_capacity</span> <span class="o">=</span> <span class="n">stormwater_storage_capacity</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">stormwater_storage_area</span> <span class="o">=</span> <span class="n">stormwater_storage_area</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">stormwater_storage_elevation</span> <span class="o">=</span> <span class="n">stormwater_storage_elevation</span>

    <span class="c1"># Update args</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">end_timestep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_timestep_</span>

    <span class="c1"># Update handlers</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pull_set_handler</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pull_set_reuse</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pull_check_handler</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pull_check_reuse</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">push_set_handler</span><span class="p">[</span><span class="s2">&quot;Sewer&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_set_sewer</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">push_check_handler</span><span class="p">[</span><span class="s2">&quot;Sewer&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_check_sewer</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">push_check_handler</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_check_sewer</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">push_set_handler</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_set_sewer</span>

    <span class="c1"># Create tank</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">stormwater_tank</span> <span class="o">=</span> <span class="n">Tank</span><span class="p">(</span>
        <span class="n">capacity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stormwater_storage_capacity</span><span class="p">,</span>
        <span class="n">area</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stormwater_storage_area</span><span class="p">,</span>
        <span class="n">datum</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stormwater_storage_elevation</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Initialise states</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">liquor_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">previous_input</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">current_input</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>  <span class="c1"># TODO is this not done in WTW?</span>

    <span class="c1"># Mass balance</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mass_balance_out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">solids</span><span class="p">)</span>  <span class="c1"># Assume these go to landfill</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mass_balance_ds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">stormwater_tank</span><span class="o">.</span><span class="n">ds</span><span class="p">())</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mass_balance_ds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds_vqip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">liquor</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">liquor_</span><span class="p">)</span>
    <span class="p">)</span>  <span class="c1"># Change in liquor</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="wsimod.nodes.wtw.WWTW.apply_overrides" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">apply_overrides</span><span class="p">(</span><span class="n">overrides</span><span class="o">=</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Apply overrides to the stormwater tank and WWTW.</p>
<p>Enables a user to override any parameter of the stormwater tank, and
then calls any overrides in WTW.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>overrides</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dict describing which parameters should
be overridden (keys) and new values (values). Defaults to {}.</p>
              </div>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>wsimod/nodes/wtw.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">apply_overrides</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">overrides</span><span class="o">=</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Apply overrides to the stormwater tank and WWTW.</span>

<span class="sd">    Enables a user to override any parameter of the stormwater tank, and</span>
<span class="sd">    then calls any overrides in WTW.</span>

<span class="sd">    Args:</span>
<span class="sd">        overrides (Dict[str, Any]): Dict describing which parameters should</span>
<span class="sd">            be overridden (keys) and new values (values). Defaults to {}.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">stormwater_storage_capacity</span> <span class="o">=</span> <span class="n">overrides</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span>
        <span class="s2">&quot;stormwater_storage_capacity&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stormwater_storage_capacity</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">stormwater_storage_area</span> <span class="o">=</span> <span class="n">overrides</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span>
        <span class="s2">&quot;stormwater_storage_area&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stormwater_storage_area</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">stormwater_storage_elevation</span> <span class="o">=</span> <span class="n">overrides</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span>
        <span class="s2">&quot;stormwater_storage_elevation&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stormwater_storage_elevation</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">stormwater_tank</span><span class="o">.</span><span class="n">area</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stormwater_storage_area</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">stormwater_tank</span><span class="o">.</span><span class="n">capacity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stormwater_storage_capacity</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">stormwater_tank</span><span class="o">.</span><span class="n">datum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stormwater_storage_elevation</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">apply_overrides</span><span class="p">(</span><span class="n">overrides</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="wsimod.nodes.wtw.WWTW.calculate_discharge" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_discharge</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Clear stormwater tank if possible, and call treat_current_input.</p>

            <details class="quote">
              <summary>Source code in <code>wsimod/nodes/wtw.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_discharge</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Clear stormwater tank if possible, and call treat_current_input.&quot;&quot;&quot;</span>
    <span class="c1"># Run WWTW model</span>

    <span class="c1"># Try to clear stormwater</span>
    <span class="c1"># TODO (probably more tidy to use push_set_sewer? though maybe less</span>
    <span class="c1"># computationally efficient)</span>
    <span class="n">excess</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_excess_throughput</span><span class="p">()</span>
    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stormwater_tank</span><span class="o">.</span><span class="n">get_avail</span><span class="p">()[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">constants</span><span class="o">.</span><span class="n">FLOAT_ACCURACY</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span>
        <span class="n">excess</span> <span class="o">&gt;</span> <span class="n">constants</span><span class="o">.</span><span class="n">FLOAT_ACCURACY</span>
    <span class="p">):</span>
        <span class="n">to_pull</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">excess</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stormwater_tank</span><span class="o">.</span><span class="n">get_avail</span><span class="p">()[</span><span class="s2">&quot;volume&quot;</span><span class="p">])</span>
        <span class="n">to_pull</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_change_vqip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stormwater_tank</span><span class="o">.</span><span class="n">storage</span><span class="p">,</span> <span class="n">to_pull</span><span class="p">)</span>
        <span class="n">cleared_stormwater</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stormwater_tank</span><span class="o">.</span><span class="n">pull_storage</span><span class="p">(</span><span class="n">to_pull</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_input</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum_vqip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_input</span><span class="p">,</span> <span class="n">cleared_stormwater</span><span class="p">)</span>

    <span class="c1"># Run processes</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">current_input</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum_vqip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_input</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">liquor</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">treat_current_input</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="wsimod.nodes.wtw.WWTW.end_timestep_" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">end_timestep_</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>End timestep function to update state variables.</p>

            <details class="quote">
              <summary>Source code in <code>wsimod/nodes/wtw.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">end_timestep_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;End timestep function to update state variables.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">liquor_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy_vqip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">liquor</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">previous_input</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy_vqip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_input</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">current_input</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">solids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">stormwater_tank</span><span class="o">.</span><span class="n">end_timestep</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="wsimod.nodes.wtw.WWTW.make_discharge" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_discharge</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Discharge treated effluent.</p>

            <details class="quote">
              <summary>Source code in <code>wsimod/nodes/wtw.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">make_discharge</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Discharge treated effluent.&quot;&quot;&quot;</span>
    <span class="n">reply</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_distributed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">treated</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">treated</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">constants</span><span class="o">.</span><span class="n">FLOAT_ACCURACY</span><span class="p">:</span>
        <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stormwater_tank</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="n">reply</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WWTW couldnt push&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="wsimod.nodes.wtw.WWTW.pull_check_reuse" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pull_check_reuse</span><span class="p">(</span><span class="n">vqip</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Pull check available water. Simply returns the previous timestep's treated
throughput. This is of course inaccurate (which may lead to slightly longer
calulcations), but it is much more flexible. This hasn't been recently tested so
it might be that returning treated would be fine (and more accurate!).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>vqip</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A VQIP that can be used to limit the volume in
the return value (only volume key is used). Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A VQIP amount of water available. Currently just the previous
timestep's treated throughput</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>wsimod/nodes/wtw.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">pull_check_reuse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vqip</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Pull check available water. Simply returns the previous timestep&#39;s treated</span>
<span class="sd">    throughput. This is of course inaccurate (which may lead to slightly longer</span>
<span class="sd">    calulcations), but it is much more flexible. This hasn&#39;t been recently tested so</span>
<span class="sd">    it might be that returning treated would be fine (and more accurate!).</span>

<span class="sd">    Args:</span>
<span class="sd">        vqip (dict, optional): A VQIP that can be used to limit the volume in</span>
<span class="sd">            the return value (only volume key is used). Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (dict): A VQIP amount of water available. Currently just the previous</span>
<span class="sd">            timestep&#39;s treated throughput</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Respond to request of water for reuse/MRF</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy_vqip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">treated</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="wsimod.nodes.wtw.WWTW.pull_set_reuse" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pull_set_reuse</span><span class="p">(</span><span class="n">vqip</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Enables WWTW to receive pulls of the treated water (i.e., for wastewater
reuse or satisfaction of environmental flows). Intended to be called in between
calculate_discharge and make_discharge.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>vqip</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A VQIP amount to be pulled (only 'volume' key is used)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>reply</code></td>            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Amount of water that has been pulled</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>wsimod/nodes/wtw.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">pull_set_reuse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vqip</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Enables WWTW to receive pulls of the treated water (i.e., for wastewater</span>
<span class="sd">    reuse or satisfaction of environmental flows). Intended to be called in between</span>
<span class="sd">    calculate_discharge and make_discharge.</span>

<span class="sd">    Args:</span>
<span class="sd">        vqip (dict): A VQIP amount to be pulled (only &#39;volume&#39; key is used)</span>

<span class="sd">    Returns:</span>
<span class="sd">        reply (dict): Amount of water that has been pulled</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Satisfy request with treated (volume)</span>
    <span class="n">reply_vol</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">vqip</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">treated</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">])</span>
    <span class="c1"># Update pollutants</span>
    <span class="n">reply</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_change_vqip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">treated</span><span class="p">,</span> <span class="n">reply_vol</span><span class="p">)</span>
    <span class="c1"># Update treated</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">treated</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_change_vqip</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">treated</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">treated</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">reply_vol</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">reply</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="wsimod.nodes.wtw.WWTW.push_check_sewer" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">push_check_sewer</span><span class="p">(</span><span class="n">vqip</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Check throughput and stormwater tank capacity.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>vqip</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A VQIP that can be used to limit the volume in
the return value (only volume key is used). Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>excess</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>wsimod/nodes/wtw.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">push_check_sewer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vqip</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check throughput and stormwater tank capacity.</span>

<span class="sd">    Args:</span>
<span class="sd">        vqip (dict, optional): A VQIP that can be used to limit the volume in</span>
<span class="sd">            the return value (only volume key is used). Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (dict): excess</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get excess</span>
    <span class="n">excess_throughput</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_excess_throughput</span><span class="p">()</span>
    <span class="n">excess_tank</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stormwater_tank</span><span class="o">.</span><span class="n">get_excess</span><span class="p">()</span>
    <span class="c1"># Combine tank and throughput</span>
    <span class="n">vol</span> <span class="o">=</span> <span class="n">excess_tank</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">excess_throughput</span>
    <span class="c1"># Update volume</span>
    <span class="k">if</span> <span class="n">vqip</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">vqip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">vol</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">vol</span><span class="p">,</span> <span class="n">vqip</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">])</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_change_vqip</span><span class="p">(</span><span class="n">vqip</span><span class="p">,</span> <span class="n">vol</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="wsimod.nodes.wtw.WWTW.push_set_sewer" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">push_set_sewer</span><span class="p">(</span><span class="n">vqip</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Receive water, first try to update current_input, and then stormwater tank.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>vqip</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A VQIP amount to be treated and then stored</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A VQIP amount of water that was not treated</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>wsimod/nodes/wtw.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">push_set_sewer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vqip</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Receive water, first try to update current_input, and then stormwater tank.</span>

<span class="sd">    Args:</span>
<span class="sd">        vqip (dict): A VQIP amount to be treated and then stored</span>

<span class="sd">    Returns:</span>
<span class="sd">        (dict): A VQIP amount of water that was not treated</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Receive water from sewers</span>
    <span class="n">vqip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy_vqip</span><span class="p">(</span><span class="n">vqip</span><span class="p">)</span>
    <span class="c1"># Check if can directly be treated</span>
    <span class="n">sent_direct</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_excess_throughput</span><span class="p">()</span>

    <span class="n">sent_direct</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">sent_direct</span><span class="p">,</span> <span class="n">vqip</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">])</span>

    <span class="n">sent_direct</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_change_vqip</span><span class="p">(</span><span class="n">vqip</span><span class="p">,</span> <span class="n">sent_direct</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">current_input</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum_vqip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_input</span><span class="p">,</span> <span class="n">sent_direct</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">sent_direct</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">vqip</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]:</span>
        <span class="c1"># If all added to input, no problem</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>

    <span class="c1"># Next try temporary storage</span>
    <span class="n">vqip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_change_vqip</span><span class="p">(</span><span class="n">vqip</span><span class="p">,</span> <span class="n">vqip</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">sent_direct</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">])</span>

    <span class="n">vqip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stormwater_tank</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="n">vqip</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">vqip</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">constants</span><span class="o">.</span><span class="n">FLOAT_ACCURACY</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># TODO what to do here ???</span>
        <span class="k">return</span> <span class="n">vqip</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["content.code.copy"], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>