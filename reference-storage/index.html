
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://imperialcollegelondon.github.io/wsi/reference-storage/">
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.7">
    
    
      
        <title>API Reference - Storage (reservoir, river, groundwater) - WSIMOD docs</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.8608ea7d.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#api-reference-storage-reservoir-river-groundwater" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="WSIMOD docs" class="md-header__button md-logo" aria-label="WSIMOD docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            WSIMOD docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              API Reference - Storage (reservoir, river, groundwater)
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/ImperialCollegeLondon/wsi" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="WSIMOD docs" class="md-nav__button md-logo" aria-label="WSIMOD docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    WSIMOD docs
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ImperialCollegeLondon/wsi" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../paper/paper/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorials/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tutorials
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../how-to/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to guide
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../component-library/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Component library
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../wsimod-cli/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Command line interface
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../dafni/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Run WSIMOD in DAFNI
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API reference
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../demo/scripts/quickstart_demo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quickstart (.py)
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../coverage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Coverage report
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/barneydobson/wsi" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    WSIMOD repository
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#wsimod.nodes.storage" class="md-nav__link">
    <span class="md-ellipsis">
      storage
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wsimod.nodes.storage.Groundwater" class="md-nav__link">
    <span class="md-ellipsis">
      Groundwater
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Groundwater">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.storage.Groundwater.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.storage.Groundwater.apply_overrides" class="md-nav__link">
    <span class="md-ellipsis">
      apply_overrides
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.storage.Groundwater.distribute" class="md-nav__link">
    <span class="md-ellipsis">
      distribute
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.storage.Groundwater.infiltrate" class="md-nav__link">
    <span class="md-ellipsis">
      infiltrate
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wsimod.nodes.storage.QueueGroundwater" class="md-nav__link">
    <span class="md-ellipsis">
      QueueGroundwater
    </span>
  </a>
  
    <nav class="md-nav" aria-label="QueueGroundwater">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.storage.QueueGroundwater.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.storage.QueueGroundwater.apply_overrides" class="md-nav__link">
    <span class="md-ellipsis">
      apply_overrides
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.storage.QueueGroundwater.distribute" class="md-nav__link">
    <span class="md-ellipsis">
      distribute
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.storage.QueueGroundwater.infiltrate" class="md-nav__link">
    <span class="md-ellipsis">
      infiltrate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.storage.QueueGroundwater.pull_check_active" class="md-nav__link">
    <span class="md-ellipsis">
      pull_check_active
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.storage.QueueGroundwater.pull_set_active" class="md-nav__link">
    <span class="md-ellipsis">
      pull_set_active
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.storage.QueueGroundwater.push_set_timearea" class="md-nav__link">
    <span class="md-ellipsis">
      push_set_timearea
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wsimod.nodes.storage.Reservoir" class="md-nav__link">
    <span class="md-ellipsis">
      Reservoir
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Reservoir">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.storage.Reservoir.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.storage.Reservoir.make_abstractions" class="md-nav__link">
    <span class="md-ellipsis">
      make_abstractions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wsimod.nodes.storage.River" class="md-nav__link">
    <span class="md-ellipsis">
      River
    </span>
  </a>
  
    <nav class="md-nav" aria-label="River">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.storage.River.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.storage.River.apply_overrides" class="md-nav__link">
    <span class="md-ellipsis">
      apply_overrides
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.storage.River.biochemical_processes" class="md-nav__link">
    <span class="md-ellipsis">
      biochemical_processes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.storage.River.calculate_discharge" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_discharge
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.storage.River.distribute" class="md-nav__link">
    <span class="md-ellipsis">
      distribute
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.storage.River.end_timestep_" class="md-nav__link">
    <span class="md-ellipsis">
      end_timestep_
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.storage.River.get_din_pool" class="md-nav__link">
    <span class="md-ellipsis">
      get_din_pool
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.storage.River.get_riverrc" class="md-nav__link">
    <span class="md-ellipsis">
      get_riverrc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.storage.River.pull_check_fp" class="md-nav__link">
    <span class="md-ellipsis">
      pull_check_fp
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.storage.River.pull_check_river" class="md-nav__link">
    <span class="md-ellipsis">
      pull_check_river
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.storage.River.pull_set_river" class="md-nav__link">
    <span class="md-ellipsis">
      pull_set_river
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.storage.River.push_set_river" class="md-nav__link">
    <span class="md-ellipsis">
      push_set_river
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.storage.River.update_depth" class="md-nav__link">
    <span class="md-ellipsis">
      update_depth
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wsimod.nodes.storage.RiverReservoir" class="md-nav__link">
    <span class="md-ellipsis">
      RiverReservoir
    </span>
  </a>
  
    <nav class="md-nav" aria-label="RiverReservoir">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.storage.RiverReservoir.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.storage.RiverReservoir.apply_overrides" class="md-nav__link">
    <span class="md-ellipsis">
      apply_overrides
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.storage.RiverReservoir.end_timestep_" class="md-nav__link">
    <span class="md-ellipsis">
      end_timestep_
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.storage.RiverReservoir.push_check_river_reservoir" class="md-nav__link">
    <span class="md-ellipsis">
      push_check_river_reservoir
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.storage.RiverReservoir.push_set_river_reservoir" class="md-nav__link">
    <span class="md-ellipsis">
      push_set_river_reservoir
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.storage.RiverReservoir.satisfy_environmental" class="md-nav__link">
    <span class="md-ellipsis">
      satisfy_environmental
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wsimod.nodes.storage.Storage" class="md-nav__link">
    <span class="md-ellipsis">
      Storage
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Storage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.storage.Storage.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.storage.Storage.apply_overrides" class="md-nav__link">
    <span class="md-ellipsis">
      apply_overrides
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.storage.Storage.distribute" class="md-nav__link">
    <span class="md-ellipsis">
      distribute
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.storage.Storage.end_timestep" class="md-nav__link">
    <span class="md-ellipsis">
      end_timestep
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.storage.Storage.get_percent" class="md-nav__link">
    <span class="md-ellipsis">
      get_percent
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.storage.Storage.push_set_storage" class="md-nav__link">
    <span class="md-ellipsis">
      push_set_storage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.storage.Storage.reinit" class="md-nav__link">
    <span class="md-ellipsis">
      reinit
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="api-reference-storage-reservoir-river-groundwater">API Reference - Storage (reservoir, river, groundwater)</h1>
<p>This section of the documentation provides a reference for the API of the nodes.storage module.</p>


<div class="doc doc-object doc-module">



<a id="wsimod.nodes.storage"></a>
    <div class="doc doc-contents first">

        <p>Created on Mon Nov 15 14:20:36 2021.</p>
<p>@author: bdobson Converted to totals on 2022-05-03</p>








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="wsimod.nodes.storage.Groundwater" class="doc doc-heading">
            <code>Groundwater</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="wsimod.nodes.storage.Storage" href="#wsimod.nodes.storage.Storage">Storage</a></code></p>


        






              <details class="quote">
                <summary>Source code in <code>wsimod/nodes/storage.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Groundwater</span><span class="p">(</span><span class="n">Storage</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">residence_time</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
        <span class="n">infiltration_threshold</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">infiltration_pct</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">data_input_dict</span><span class="o">=</span><span class="p">{},</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="c1"># TODO why isn&#39;t this using a ResidenceTank?</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A storage with a residence time for groundwater. Can also infiltrate to</span>
<span class="sd">        sewers.</span>

<span class="sd">        Args:</span>
<span class="sd">            residence_time (float, optional): Residence time (see nodes.py/</span>
<span class="sd">                ResidenceTank). Defaults to 200.</span>
<span class="sd">            infiltration_threshold (float, optional): Proportion of storage capacity</span>
<span class="sd">                that must be exceeded to generate infiltration. Defaults to 1.</span>
<span class="sd">            infiltration_pct (float, optional): Proportion of storage above the</span>
<span class="sd">                threshold that is square rooted and infiltrated. Defaults to 0.</span>
<span class="sd">            data_input_dict (dict, optional): Dictionary of data inputs relevant for</span>
<span class="sd">                the node (though I don&#39;t think it is used). Defaults to {}.</span>

<span class="sd">        Functions intended to call in orchestration:</span>
<span class="sd">            infiltrate (before sewers are discharged)</span>

<span class="sd">            distribute</span>

<span class="sd">        Key assumptions:</span>
<span class="sd">            - Conceptualises groundwater as a tank.</span>
<span class="sd">            - Baseflow is generated following a residence-time method.</span>
<span class="sd">            - Baseflow is sent to `storage.py/River`, `nodes.py/Node` or</span>
<span class="sd">                `waste.py/Waste` nodes.</span>
<span class="sd">            - Infiltration to `sewer.py/Sewer` nodes occurs when the storage</span>
<span class="sd">                in the tank is greater than a specified threshold, at a rate</span>
<span class="sd">                proportional to the sqrt of volume above the threshold. (Note, this</span>
<span class="sd">                behaviour is __not validated__ and a high uncertainty process in</span>
<span class="sd">                general)</span>
<span class="sd">            - If `decays` are provided to model water quality transformations,</span>
<span class="sd">                see `core.py/DecayObj`.</span>

<span class="sd">        Input data and parameter requirements:</span>
<span class="sd">            - Groundwater tank `capacity`, `area`, and `datum`.</span>
<span class="sd">                _Units_: cubic metres, squared metres, metres</span>
<span class="sd">            - Infiltration behaviour determined by an `infiltration_threshold`</span>
<span class="sd">                and `infiltration_pct`. _Units_: proportion of capacity</span>
<span class="sd">            - Optional dictionary of decays with pollutants as keys and decay</span>
<span class="sd">                parameters (a constant and a temperature sensitivity exponent) as</span>
<span class="sd">                values. _Units_: -</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">residence_time</span> <span class="o">=</span> <span class="n">residence_time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">infiltration_threshold</span> <span class="o">=</span> <span class="n">infiltration_threshold</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">infiltration_pct</span> <span class="o">=</span> <span class="n">infiltration_pct</span>
        <span class="c1"># TODO not used data_input</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_input_dict</span> <span class="o">=</span> <span class="n">data_input_dict</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">apply_overrides</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">overrides</span><span class="o">=</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Override parameters.</span>

<span class="sd">        Enables a user to override any of the following parameters:</span>
<span class="sd">        residence_time, infiltration_threshold, infiltration_pct.</span>

<span class="sd">        Args:</span>
<span class="sd">            overrides (Dict[str, Any]): Dict describing which parameters should</span>
<span class="sd">                be overridden (keys) and new values (values). Defaults to {}.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">residence_time</span> <span class="o">=</span> <span class="n">overrides</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;residence_time&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">residence_time</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">infiltration_threshold</span> <span class="o">=</span> <span class="n">overrides</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span>
            <span class="s2">&quot;infiltration_threshold&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">infiltration_threshold</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">infiltration_pct</span> <span class="o">=</span> <span class="n">overrides</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;infiltration_pct&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">infiltration_pct</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">apply_overrides</span><span class="p">(</span><span class="n">overrides</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">distribute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate outflow with residence time and send to Nodes or Rivers.&quot;&quot;&quot;</span>
        <span class="n">avail</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">get_avail</span><span class="p">()[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">residence_time</span>
        <span class="n">to_send</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">pull_storage</span><span class="p">({</span><span class="s2">&quot;volume&quot;</span><span class="p">:</span> <span class="n">avail</span><span class="p">})</span>
        <span class="n">retained</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_distributed</span><span class="p">(</span><span class="n">to_send</span><span class="p">,</span> <span class="n">of_type</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Node&quot;</span><span class="p">,</span> <span class="s2">&quot;River&quot;</span><span class="p">,</span> <span class="s2">&quot;Waste&quot;</span><span class="p">])</span>
        <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="n">retained</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">retained</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">constants</span><span class="o">.</span><span class="n">FLOAT_ACCURACY</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Storage unable to push&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">infiltrate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate amount of water available for infiltration and send to sewers.&quot;&quot;&quot;</span>
        <span class="c1"># Calculate infiltration</span>
        <span class="n">avail</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">get_avail</span><span class="p">()[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span>
        <span class="n">avail</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">avail</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">capacity</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">infiltration_threshold</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">avail</span> <span class="o">=</span> <span class="p">(</span><span class="n">avail</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">infiltration_pct</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span>

        <span class="c1"># Push to sewers</span>
        <span class="n">to_send</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">pull_storage</span><span class="p">({</span><span class="s2">&quot;volume&quot;</span><span class="p">:</span> <span class="n">avail</span><span class="p">})</span>
        <span class="n">retained</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_distributed</span><span class="p">(</span><span class="n">to_send</span><span class="p">,</span> <span class="n">of_type</span><span class="o">=</span><span class="s2">&quot;Sewer&quot;</span><span class="p">)</span>
        <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="n">retained</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># Any not sent is left in tank</span>
        <span class="k">if</span> <span class="n">retained</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">constants</span><span class="o">.</span><span class="n">FLOAT_ACCURACY</span><span class="p">:</span>
            <span class="c1"># print(&#39;unable to infiltrate&#39;)</span>
            <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="wsimod.nodes.storage.Groundwater.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">residence_time</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">infiltration_threshold</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">infiltration_pct</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">data_input_dict</span><span class="o">=</span><span class="p">{},</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>A storage with a residence time for groundwater. Can also infiltrate to
sewers.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>residence_time</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Residence time (see nodes.py/
ResidenceTank). Defaults to 200.</p>
              </div>
            </td>
            <td>
                  <code>200</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>infiltration_threshold</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Proportion of storage capacity
that must be exceeded to generate infiltration. Defaults to 1.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>infiltration_pct</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Proportion of storage above the
threshold that is square rooted and infiltrated. Defaults to 0.</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>data_input_dict</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary of data inputs relevant for
the node (though I don't think it is used). Defaults to {}.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="functions-intended-to-call-in-orchestration" open>
  <summary>Functions intended to call in orchestration</summary>
  <p>infiltrate (before sewers are discharged)</p>
<p>distribute</p>
</details>

<details class="key-assumptions" open>
  <summary>Key assumptions</summary>
  <ul>
<li>Conceptualises groundwater as a tank.</li>
<li>Baseflow is generated following a residence-time method.</li>
<li>Baseflow is sent to <code>storage.py/River</code>, <code>nodes.py/Node</code> or
    <code>waste.py/Waste</code> nodes.</li>
<li>Infiltration to <code>sewer.py/Sewer</code> nodes occurs when the storage
    in the tank is greater than a specified threshold, at a rate
    proportional to the sqrt of volume above the threshold. (Note, this
    behaviour is <strong>not validated</strong> and a high uncertainty process in
    general)</li>
<li>If <code>decays</code> are provided to model water quality transformations,
    see <code>core.py/DecayObj</code>.</li>
</ul>
</details>

<details class="input-data-and-parameter-requirements" open>
  <summary>Input data and parameter requirements</summary>
  <ul>
<li>Groundwater tank <code>capacity</code>, <code>area</code>, and <code>datum</code>.
    <em>Units</em>: cubic metres, squared metres, metres</li>
<li>Infiltration behaviour determined by an <code>infiltration_threshold</code>
    and <code>infiltration_pct</code>. <em>Units</em>: proportion of capacity</li>
<li>Optional dictionary of decays with pollutants as keys and decay
    parameters (a constant and a temperature sensitivity exponent) as
    values. <em>Units</em>: -</li>
</ul>
</details>
            <details class="quote">
              <summary>Source code in <code>wsimod/nodes/storage.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">residence_time</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
    <span class="n">infiltration_threshold</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">infiltration_pct</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">data_input_dict</span><span class="o">=</span><span class="p">{},</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
    <span class="c1"># TODO why isn&#39;t this using a ResidenceTank?</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A storage with a residence time for groundwater. Can also infiltrate to</span>
<span class="sd">    sewers.</span>

<span class="sd">    Args:</span>
<span class="sd">        residence_time (float, optional): Residence time (see nodes.py/</span>
<span class="sd">            ResidenceTank). Defaults to 200.</span>
<span class="sd">        infiltration_threshold (float, optional): Proportion of storage capacity</span>
<span class="sd">            that must be exceeded to generate infiltration. Defaults to 1.</span>
<span class="sd">        infiltration_pct (float, optional): Proportion of storage above the</span>
<span class="sd">            threshold that is square rooted and infiltrated. Defaults to 0.</span>
<span class="sd">        data_input_dict (dict, optional): Dictionary of data inputs relevant for</span>
<span class="sd">            the node (though I don&#39;t think it is used). Defaults to {}.</span>

<span class="sd">    Functions intended to call in orchestration:</span>
<span class="sd">        infiltrate (before sewers are discharged)</span>

<span class="sd">        distribute</span>

<span class="sd">    Key assumptions:</span>
<span class="sd">        - Conceptualises groundwater as a tank.</span>
<span class="sd">        - Baseflow is generated following a residence-time method.</span>
<span class="sd">        - Baseflow is sent to `storage.py/River`, `nodes.py/Node` or</span>
<span class="sd">            `waste.py/Waste` nodes.</span>
<span class="sd">        - Infiltration to `sewer.py/Sewer` nodes occurs when the storage</span>
<span class="sd">            in the tank is greater than a specified threshold, at a rate</span>
<span class="sd">            proportional to the sqrt of volume above the threshold. (Note, this</span>
<span class="sd">            behaviour is __not validated__ and a high uncertainty process in</span>
<span class="sd">            general)</span>
<span class="sd">        - If `decays` are provided to model water quality transformations,</span>
<span class="sd">            see `core.py/DecayObj`.</span>

<span class="sd">    Input data and parameter requirements:</span>
<span class="sd">        - Groundwater tank `capacity`, `area`, and `datum`.</span>
<span class="sd">            _Units_: cubic metres, squared metres, metres</span>
<span class="sd">        - Infiltration behaviour determined by an `infiltration_threshold`</span>
<span class="sd">            and `infiltration_pct`. _Units_: proportion of capacity</span>
<span class="sd">        - Optional dictionary of decays with pollutants as keys and decay</span>
<span class="sd">            parameters (a constant and a temperature sensitivity exponent) as</span>
<span class="sd">            values. _Units_: -</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">residence_time</span> <span class="o">=</span> <span class="n">residence_time</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">infiltration_threshold</span> <span class="o">=</span> <span class="n">infiltration_threshold</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">infiltration_pct</span> <span class="o">=</span> <span class="n">infiltration_pct</span>
    <span class="c1"># TODO not used data_input</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data_input_dict</span> <span class="o">=</span> <span class="n">data_input_dict</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="wsimod.nodes.storage.Groundwater.apply_overrides" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">apply_overrides</span><span class="p">(</span><span class="n">overrides</span><span class="o">=</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Override parameters.</p>
<p>Enables a user to override any of the following parameters:
residence_time, infiltration_threshold, infiltration_pct.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>overrides</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dict describing which parameters should
be overridden (keys) and new values (values). Defaults to {}.</p>
              </div>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>wsimod/nodes/storage.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">apply_overrides</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">overrides</span><span class="o">=</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Override parameters.</span>

<span class="sd">    Enables a user to override any of the following parameters:</span>
<span class="sd">    residence_time, infiltration_threshold, infiltration_pct.</span>

<span class="sd">    Args:</span>
<span class="sd">        overrides (Dict[str, Any]): Dict describing which parameters should</span>
<span class="sd">            be overridden (keys) and new values (values). Defaults to {}.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">residence_time</span> <span class="o">=</span> <span class="n">overrides</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;residence_time&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">residence_time</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">infiltration_threshold</span> <span class="o">=</span> <span class="n">overrides</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span>
        <span class="s2">&quot;infiltration_threshold&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">infiltration_threshold</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">infiltration_pct</span> <span class="o">=</span> <span class="n">overrides</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;infiltration_pct&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">infiltration_pct</span><span class="p">)</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">apply_overrides</span><span class="p">(</span><span class="n">overrides</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="wsimod.nodes.storage.Groundwater.distribute" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">distribute</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Calculate outflow with residence time and send to Nodes or Rivers.</p>

            <details class="quote">
              <summary>Source code in <code>wsimod/nodes/storage.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">distribute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate outflow with residence time and send to Nodes or Rivers.&quot;&quot;&quot;</span>
    <span class="n">avail</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">get_avail</span><span class="p">()[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">residence_time</span>
    <span class="n">to_send</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">pull_storage</span><span class="p">({</span><span class="s2">&quot;volume&quot;</span><span class="p">:</span> <span class="n">avail</span><span class="p">})</span>
    <span class="n">retained</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_distributed</span><span class="p">(</span><span class="n">to_send</span><span class="p">,</span> <span class="n">of_type</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Node&quot;</span><span class="p">,</span> <span class="s2">&quot;River&quot;</span><span class="p">,</span> <span class="s2">&quot;Waste&quot;</span><span class="p">])</span>
    <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="n">retained</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">retained</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">constants</span><span class="o">.</span><span class="n">FLOAT_ACCURACY</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Storage unable to push&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="wsimod.nodes.storage.Groundwater.infiltrate" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">infiltrate</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Calculate amount of water available for infiltration and send to sewers.</p>

            <details class="quote">
              <summary>Source code in <code>wsimod/nodes/storage.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">infiltrate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate amount of water available for infiltration and send to sewers.&quot;&quot;&quot;</span>
    <span class="c1"># Calculate infiltration</span>
    <span class="n">avail</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">get_avail</span><span class="p">()[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span>
    <span class="n">avail</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">avail</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">capacity</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">infiltration_threshold</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">avail</span> <span class="o">=</span> <span class="p">(</span><span class="n">avail</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">infiltration_pct</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span>

    <span class="c1"># Push to sewers</span>
    <span class="n">to_send</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">pull_storage</span><span class="p">({</span><span class="s2">&quot;volume&quot;</span><span class="p">:</span> <span class="n">avail</span><span class="p">})</span>
    <span class="n">retained</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_distributed</span><span class="p">(</span><span class="n">to_send</span><span class="p">,</span> <span class="n">of_type</span><span class="o">=</span><span class="s2">&quot;Sewer&quot;</span><span class="p">)</span>
    <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="n">retained</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># Any not sent is left in tank</span>
    <span class="k">if</span> <span class="n">retained</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">constants</span><span class="o">.</span><span class="n">FLOAT_ACCURACY</span><span class="p">:</span>
        <span class="c1"># print(&#39;unable to infiltrate&#39;)</span>
        <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="wsimod.nodes.storage.QueueGroundwater" class="doc doc-heading">
            <code>QueueGroundwater</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="wsimod.nodes.storage.Storage" href="#wsimod.nodes.storage.Storage">Storage</a></code></p>


        






              <details class="quote">
                <summary>Source code in <code>wsimod/nodes/storage.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">QueueGroundwater</span><span class="p">(</span><span class="n">Storage</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>

    <span class="c1"># TODO - no infiltration as yet</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timearea</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span> <span class="n">data_input_dict</span><span class="o">=</span><span class="p">{},</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Alternate formulation of Groundwater that uses a timearea property to enable</span>
<span class="sd">        more nonlinear time behaviour of baseflow routing. Uses the QueueTank or</span>
<span class="sd">        DecayQueueTank (see nodes.py/Tank subclassses).</span>

<span class="sd">        NOTE: abstraction behaviour from this kind of node need careful checking</span>

<span class="sd">        Args:</span>
<span class="sd">            timearea (dict, optional): Time area diagram that enables flows to</span>
<span class="sd">                take a range of different durations to &#39;traverse&#39; the tank. The keys of</span>
<span class="sd">                the dict are the number of timesteps while the values are the proportion</span>
<span class="sd">                of flow. E.g., {0 : 0.7, 1 : 0.3} means 70% of flow takes 0 timesteps</span>
<span class="sd">                and 30% takes 1 timesteps. Defaults to {0 : 1}.</span>
<span class="sd">            data_input_dict (dict, optional): Dictionary of data inputs relevant for</span>
<span class="sd">                the node (though I don&#39;t think it is used). Defaults to {}.</span>

<span class="sd">        Functions intended to call in orchestration:</span>
<span class="sd">            distribute</span>

<span class="sd">        Key assumptions:</span>
<span class="sd">            - Conceptualises groundwater as a tank.</span>
<span class="sd">            - Baseflow is generated following a timearea method.</span>
<span class="sd">            - Baseflow is sent to `storage.py/River`, `nodes.py/Node` or</span>
<span class="sd">                `waste.py/Waste` nodes.</span>
<span class="sd">            - No infiltration to sewers is modelled.</span>
<span class="sd">            - If `decays` are provided to model water quality transformations,</span>
<span class="sd">                see `core.py/DecayObj`.</span>

<span class="sd">        Input data and parameter requirements:</span>
<span class="sd">            - Groundwater tank `capacity`, `area`, and `datum`.</span>
<span class="sd">                _Units_: cubic metres, squared metres, metres</span>
<span class="sd">            - `timearea` is a dictionary containing the timearea diagram.</span>
<span class="sd">                _Units_: duration of flow (in timesteps) and proportion of flow</span>
<span class="sd">            - Optional dictionary of decays with pollutants as keys and decay</span>
<span class="sd">                parameters (a constant and a temperature sensitivity exponent) as</span>
<span class="sd">                values. _Units_: -</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timearea</span> <span class="o">=</span> <span class="n">timearea</span>
        <span class="c1"># TODO not used</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_input_dict</span> <span class="o">=</span> <span class="n">data_input_dict</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># Label as Groundwater class so that other nodes treat it the same</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="s2">&quot;Groundwater&quot;</span>
        <span class="c1"># Update handlers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push_set_handler</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_set_timearea</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pull_set_handler</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pull_set_active</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pull_check_handler</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pull_check_active</span>
        <span class="c1"># Enable decay</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">decays</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tank</span> <span class="o">=</span> <span class="n">QueueTank</span><span class="p">(</span>
                <span class="n">capacity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">capacity</span><span class="p">,</span>
                <span class="n">area</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">area</span><span class="p">,</span>
                <span class="n">datum</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">datum</span><span class="p">,</span>
                <span class="n">initial_storage</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_storage</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tank</span> <span class="o">=</span> <span class="n">DecayQueueTank</span><span class="p">(</span>
                <span class="n">capacity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">capacity</span><span class="p">,</span>
                <span class="n">area</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">area</span><span class="p">,</span>
                <span class="n">datum</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">datum</span><span class="p">,</span>
                <span class="n">decays</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">decays</span><span class="p">,</span>
                <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                <span class="n">initial_storage</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_storage</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">apply_overrides</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">overrides</span><span class="o">=</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Override parameters.</span>

<span class="sd">        Enables a user to override any of the following parameters:</span>
<span class="sd">        timearea.</span>

<span class="sd">        Args:</span>
<span class="sd">            overrides (Dict[str, Any]): Dict describing which parameters should</span>
<span class="sd">                be overridden (keys) and new values (values). Defaults to {}.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timearea</span> <span class="o">=</span> <span class="n">overrides</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;timearea&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">timearea</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">apply_overrides</span><span class="p">(</span><span class="n">overrides</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">push_set_timearea</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vqip</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Push setting that enables timearea behaviour, (see __init__ for</span>
<span class="sd">        description).Used to receive flow that is assumed to occur widely across some</span>
<span class="sd">        kind of catchment.</span>

<span class="sd">        Args:</span>
<span class="sd">            vqip (dict): A VQIP that has been pushed</span>

<span class="sd">        Returns:</span>
<span class="sd">            reply (dict): A VQIP amount that was not successfuly receivesd</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">reply</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
        <span class="c1"># Iterate over timearea diagram TODO timearea diagram behaviour be generalised</span>
        <span class="c1"># across nodes</span>
        <span class="k">for</span> <span class="n">time</span><span class="p">,</span> <span class="n">normalised</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">timearea</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">vqip_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_change_vqip</span><span class="p">(</span><span class="n">vqip</span><span class="p">,</span> <span class="n">vqip</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">normalised</span><span class="p">)</span>
            <span class="n">reply_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="n">vqip_</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">)</span>
            <span class="n">reply</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum_vqip</span><span class="p">(</span><span class="n">reply</span><span class="p">,</span> <span class="n">reply_</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">reply</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">distribute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update internal arc, push active_storage onwards, update tank.&quot;&quot;&quot;</span>
        <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">internal_arc</span><span class="o">.</span><span class="n">update_queue</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="s2">&quot;push&quot;</span><span class="p">)</span>

        <span class="n">remaining</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_distributed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">active_storage</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">remaining</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">constants</span><span class="o">.</span><span class="n">FLOAT_ACCURACY</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Groundwater couldnt push all&quot;</span><span class="p">)</span>

        <span class="c1"># Update tank</span>
        <span class="n">sent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">active_storage</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">remaining</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span>
        <span class="n">sent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_change_vqip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">active_storage</span><span class="p">,</span> <span class="n">sent</span><span class="p">)</span>
        <span class="n">reply</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">pull_storage</span><span class="p">(</span><span class="n">sent</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">sent</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">constants</span><span class="o">.</span><span class="n">FLOAT_ACCURACY</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Miscalculated tank storage in discharge&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">infiltrate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">pull_check_active</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vqip</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A pull check that returns the active storage.</span>

<span class="sd">        Args:</span>
<span class="sd">            vqip (dict, optional): A VQIP that can be used to limit the volume in</span>
<span class="sd">                the return value (only volume key is used). Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (dict): A VQIP amount that is available to pull</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">vqip</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">active_storage</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">reply</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">vqip</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">active_storage</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">])</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_change_vqip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">active_storage</span><span class="p">,</span> <span class="n">reply</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">pull_set_active</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vqip</span><span class="p">):</span>
        <span class="c1"># TODO - this is quite weird behaviour, and inconsistent with pull_check_active</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Pull proportionately from both the active storage and the queue. Adjudging</span>
<span class="sd">        groundwater abstractions to not be particularly sensitive to the within</span>
<span class="sd">        catchment travel time.</span>

<span class="sd">        Args:</span>
<span class="sd">            vqip (dict): A VQIP amount to be pulled (only volume key is used)</span>

<span class="sd">        Returns:</span>
<span class="sd">            pulled (dict): A VQIP amount that was successfully pulled</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Calculate actual pull</span>
        <span class="n">total_storage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span>
        <span class="n">total_pull</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">],</span> <span class="n">vqip</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">total_pull</span> <span class="o">&lt;</span> <span class="n">constants</span><span class="o">.</span><span class="n">FLOAT_ACCURACY</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Track total pull in pulled</span>
            <span class="n">pulled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
            <span class="c1"># Iterate over queue</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">internal_arc</span><span class="o">.</span><span class="n">queue</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">internal_arc</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="c1"># Pull proportionately</span>
                    <span class="n">t_pulled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_change_vqip</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">internal_arc</span><span class="o">.</span><span class="n">queue</span><span class="p">[</span><span class="n">t</span><span class="p">],</span>
                        <span class="n">v</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">total_pull</span> <span class="o">/</span> <span class="n">total_storage</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="c1"># Reduce queue VQIPs</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">internal_arc</span><span class="o">.</span><span class="n">queue</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_vqip</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">internal_arc</span><span class="o">.</span><span class="n">queue</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="n">t_pulled</span>
                    <span class="p">)</span>
                    <span class="c1"># Track pull</span>
                    <span class="n">pulled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum_vqip</span><span class="p">(</span><span class="n">pulled</span><span class="p">,</span> <span class="n">t_pulled</span><span class="p">)</span>
                <span class="c1"># Pull also from active storage</span>
                <span class="n">a_pulled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_change_vqip</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">active_storage</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">active_storage</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">total_pull</span> <span class="o">/</span> <span class="n">total_storage</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">active_storage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_vqip</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">active_storage</span><span class="p">,</span> <span class="n">a_pulled</span>
                <span class="p">)</span>
                <span class="n">pulled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum_vqip</span><span class="p">(</span><span class="n">pulled</span><span class="p">,</span> <span class="n">a_pulled</span><span class="p">)</span>

                <span class="c1"># Recalculate storage</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_vqip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">,</span> <span class="n">pulled</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">pulled</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="wsimod.nodes.storage.QueueGroundwater.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">timearea</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span> <span class="n">data_input_dict</span><span class="o">=</span><span class="p">{},</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Alternate formulation of Groundwater that uses a timearea property to enable
more nonlinear time behaviour of baseflow routing. Uses the QueueTank or
DecayQueueTank (see nodes.py/Tank subclassses).</p>
<p>NOTE: abstraction behaviour from this kind of node need careful checking</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>timearea</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Time area diagram that enables flows to
take a range of different durations to 'traverse' the tank. The keys of
the dict are the number of timesteps while the values are the proportion
of flow. E.g., {0 : 0.7, 1 : 0.3} means 70% of flow takes 0 timesteps
and 30% takes 1 timesteps. Defaults to {0 : 1}.</p>
              </div>
            </td>
            <td>
                  <code>{0: 1}</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>data_input_dict</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary of data inputs relevant for
the node (though I don't think it is used). Defaults to {}.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="functions-intended-to-call-in-orchestration" open>
  <summary>Functions intended to call in orchestration</summary>
  <p>distribute</p>
</details>

<details class="key-assumptions" open>
  <summary>Key assumptions</summary>
  <ul>
<li>Conceptualises groundwater as a tank.</li>
<li>Baseflow is generated following a timearea method.</li>
<li>Baseflow is sent to <code>storage.py/River</code>, <code>nodes.py/Node</code> or
    <code>waste.py/Waste</code> nodes.</li>
<li>No infiltration to sewers is modelled.</li>
<li>If <code>decays</code> are provided to model water quality transformations,
    see <code>core.py/DecayObj</code>.</li>
</ul>
</details>

<details class="input-data-and-parameter-requirements" open>
  <summary>Input data and parameter requirements</summary>
  <ul>
<li>Groundwater tank <code>capacity</code>, <code>area</code>, and <code>datum</code>.
    <em>Units</em>: cubic metres, squared metres, metres</li>
<li><code>timearea</code> is a dictionary containing the timearea diagram.
    <em>Units</em>: duration of flow (in timesteps) and proportion of flow</li>
<li>Optional dictionary of decays with pollutants as keys and decay
    parameters (a constant and a temperature sensitivity exponent) as
    values. <em>Units</em>: -</li>
</ul>
</details>
            <details class="quote">
              <summary>Source code in <code>wsimod/nodes/storage.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timearea</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span> <span class="n">data_input_dict</span><span class="o">=</span><span class="p">{},</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Alternate formulation of Groundwater that uses a timearea property to enable</span>
<span class="sd">    more nonlinear time behaviour of baseflow routing. Uses the QueueTank or</span>
<span class="sd">    DecayQueueTank (see nodes.py/Tank subclassses).</span>

<span class="sd">    NOTE: abstraction behaviour from this kind of node need careful checking</span>

<span class="sd">    Args:</span>
<span class="sd">        timearea (dict, optional): Time area diagram that enables flows to</span>
<span class="sd">            take a range of different durations to &#39;traverse&#39; the tank. The keys of</span>
<span class="sd">            the dict are the number of timesteps while the values are the proportion</span>
<span class="sd">            of flow. E.g., {0 : 0.7, 1 : 0.3} means 70% of flow takes 0 timesteps</span>
<span class="sd">            and 30% takes 1 timesteps. Defaults to {0 : 1}.</span>
<span class="sd">        data_input_dict (dict, optional): Dictionary of data inputs relevant for</span>
<span class="sd">            the node (though I don&#39;t think it is used). Defaults to {}.</span>

<span class="sd">    Functions intended to call in orchestration:</span>
<span class="sd">        distribute</span>

<span class="sd">    Key assumptions:</span>
<span class="sd">        - Conceptualises groundwater as a tank.</span>
<span class="sd">        - Baseflow is generated following a timearea method.</span>
<span class="sd">        - Baseflow is sent to `storage.py/River`, `nodes.py/Node` or</span>
<span class="sd">            `waste.py/Waste` nodes.</span>
<span class="sd">        - No infiltration to sewers is modelled.</span>
<span class="sd">        - If `decays` are provided to model water quality transformations,</span>
<span class="sd">            see `core.py/DecayObj`.</span>

<span class="sd">    Input data and parameter requirements:</span>
<span class="sd">        - Groundwater tank `capacity`, `area`, and `datum`.</span>
<span class="sd">            _Units_: cubic metres, squared metres, metres</span>
<span class="sd">        - `timearea` is a dictionary containing the timearea diagram.</span>
<span class="sd">            _Units_: duration of flow (in timesteps) and proportion of flow</span>
<span class="sd">        - Optional dictionary of decays with pollutants as keys and decay</span>
<span class="sd">            parameters (a constant and a temperature sensitivity exponent) as</span>
<span class="sd">            values. _Units_: -</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">timearea</span> <span class="o">=</span> <span class="n">timearea</span>
    <span class="c1"># TODO not used</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data_input_dict</span> <span class="o">=</span> <span class="n">data_input_dict</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="c1"># Label as Groundwater class so that other nodes treat it the same</span>
    <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="s2">&quot;Groundwater&quot;</span>
    <span class="c1"># Update handlers</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">push_set_handler</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_set_timearea</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pull_set_handler</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pull_set_active</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pull_check_handler</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pull_check_active</span>
    <span class="c1"># Enable decay</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">decays</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tank</span> <span class="o">=</span> <span class="n">QueueTank</span><span class="p">(</span>
            <span class="n">capacity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">capacity</span><span class="p">,</span>
            <span class="n">area</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">area</span><span class="p">,</span>
            <span class="n">datum</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">datum</span><span class="p">,</span>
            <span class="n">initial_storage</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_storage</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tank</span> <span class="o">=</span> <span class="n">DecayQueueTank</span><span class="p">(</span>
            <span class="n">capacity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">capacity</span><span class="p">,</span>
            <span class="n">area</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">area</span><span class="p">,</span>
            <span class="n">datum</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">datum</span><span class="p">,</span>
            <span class="n">decays</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">decays</span><span class="p">,</span>
            <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">initial_storage</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_storage</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="wsimod.nodes.storage.QueueGroundwater.apply_overrides" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">apply_overrides</span><span class="p">(</span><span class="n">overrides</span><span class="o">=</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Override parameters.</p>
<p>Enables a user to override any of the following parameters:
timearea.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>overrides</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dict describing which parameters should
be overridden (keys) and new values (values). Defaults to {}.</p>
              </div>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>wsimod/nodes/storage.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">apply_overrides</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">overrides</span><span class="o">=</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Override parameters.</span>

<span class="sd">    Enables a user to override any of the following parameters:</span>
<span class="sd">    timearea.</span>

<span class="sd">    Args:</span>
<span class="sd">        overrides (Dict[str, Any]): Dict describing which parameters should</span>
<span class="sd">            be overridden (keys) and new values (values). Defaults to {}.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">timearea</span> <span class="o">=</span> <span class="n">overrides</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;timearea&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">timearea</span><span class="p">)</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">apply_overrides</span><span class="p">(</span><span class="n">overrides</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="wsimod.nodes.storage.QueueGroundwater.distribute" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">distribute</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Update internal arc, push active_storage onwards, update tank.</p>

            <details class="quote">
              <summary>Source code in <code>wsimod/nodes/storage.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">distribute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update internal arc, push active_storage onwards, update tank.&quot;&quot;&quot;</span>
    <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">internal_arc</span><span class="o">.</span><span class="n">update_queue</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="s2">&quot;push&quot;</span><span class="p">)</span>

    <span class="n">remaining</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_distributed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">active_storage</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">remaining</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">constants</span><span class="o">.</span><span class="n">FLOAT_ACCURACY</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Groundwater couldnt push all&quot;</span><span class="p">)</span>

    <span class="c1"># Update tank</span>
    <span class="n">sent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">active_storage</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">remaining</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span>
    <span class="n">sent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_change_vqip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">active_storage</span><span class="p">,</span> <span class="n">sent</span><span class="p">)</span>
    <span class="n">reply</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">pull_storage</span><span class="p">(</span><span class="n">sent</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">sent</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">constants</span><span class="o">.</span><span class="n">FLOAT_ACCURACY</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Miscalculated tank storage in discharge&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="wsimod.nodes.storage.QueueGroundwater.infiltrate" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">infiltrate</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        

            <details class="quote">
              <summary>Source code in <code>wsimod/nodes/storage.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">infiltrate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="wsimod.nodes.storage.QueueGroundwater.pull_check_active" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pull_check_active</span><span class="p">(</span><span class="n">vqip</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>A pull check that returns the active storage.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>vqip</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A VQIP that can be used to limit the volume in
the return value (only volume key is used). Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A VQIP amount that is available to pull</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>wsimod/nodes/storage.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">pull_check_active</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vqip</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A pull check that returns the active storage.</span>

<span class="sd">    Args:</span>
<span class="sd">        vqip (dict, optional): A VQIP that can be used to limit the volume in</span>
<span class="sd">            the return value (only volume key is used). Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (dict): A VQIP amount that is available to pull</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">vqip</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">active_storage</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">reply</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">vqip</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">active_storage</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_change_vqip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">active_storage</span><span class="p">,</span> <span class="n">reply</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="wsimod.nodes.storage.QueueGroundwater.pull_set_active" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pull_set_active</span><span class="p">(</span><span class="n">vqip</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Pull proportionately from both the active storage and the queue. Adjudging
groundwater abstractions to not be particularly sensitive to the within
catchment travel time.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>vqip</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A VQIP amount to be pulled (only volume key is used)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>pulled</code></td>            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A VQIP amount that was successfully pulled</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>wsimod/nodes/storage.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">pull_set_active</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vqip</span><span class="p">):</span>
    <span class="c1"># TODO - this is quite weird behaviour, and inconsistent with pull_check_active</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Pull proportionately from both the active storage and the queue. Adjudging</span>
<span class="sd">    groundwater abstractions to not be particularly sensitive to the within</span>
<span class="sd">    catchment travel time.</span>

<span class="sd">    Args:</span>
<span class="sd">        vqip (dict): A VQIP amount to be pulled (only volume key is used)</span>

<span class="sd">    Returns:</span>
<span class="sd">        pulled (dict): A VQIP amount that was successfully pulled</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Calculate actual pull</span>
    <span class="n">total_storage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span>
    <span class="n">total_pull</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">],</span> <span class="n">vqip</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">total_pull</span> <span class="o">&lt;</span> <span class="n">constants</span><span class="o">.</span><span class="n">FLOAT_ACCURACY</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Track total pull in pulled</span>
        <span class="n">pulled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
        <span class="c1"># Iterate over queue</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">internal_arc</span><span class="o">.</span><span class="n">queue</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">internal_arc</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="c1"># Pull proportionately</span>
                <span class="n">t_pulled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_change_vqip</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">internal_arc</span><span class="o">.</span><span class="n">queue</span><span class="p">[</span><span class="n">t</span><span class="p">],</span>
                    <span class="n">v</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">total_pull</span> <span class="o">/</span> <span class="n">total_storage</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="c1"># Reduce queue VQIPs</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">internal_arc</span><span class="o">.</span><span class="n">queue</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_vqip</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">internal_arc</span><span class="o">.</span><span class="n">queue</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="n">t_pulled</span>
                <span class="p">)</span>
                <span class="c1"># Track pull</span>
                <span class="n">pulled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum_vqip</span><span class="p">(</span><span class="n">pulled</span><span class="p">,</span> <span class="n">t_pulled</span><span class="p">)</span>
            <span class="c1"># Pull also from active storage</span>
            <span class="n">a_pulled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_change_vqip</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">active_storage</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">active_storage</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">total_pull</span> <span class="o">/</span> <span class="n">total_storage</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">active_storage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_vqip</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">active_storage</span><span class="p">,</span> <span class="n">a_pulled</span>
            <span class="p">)</span>
            <span class="n">pulled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum_vqip</span><span class="p">(</span><span class="n">pulled</span><span class="p">,</span> <span class="n">a_pulled</span><span class="p">)</span>

            <span class="c1"># Recalculate storage</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_vqip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">,</span> <span class="n">pulled</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">pulled</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="wsimod.nodes.storage.QueueGroundwater.push_set_timearea" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">push_set_timearea</span><span class="p">(</span><span class="n">vqip</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Push setting that enables timearea behaviour, (see <strong>init</strong> for
description).Used to receive flow that is assumed to occur widely across some
kind of catchment.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>vqip</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A VQIP that has been pushed</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>reply</code></td>            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A VQIP amount that was not successfuly receivesd</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>wsimod/nodes/storage.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">push_set_timearea</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vqip</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Push setting that enables timearea behaviour, (see __init__ for</span>
<span class="sd">    description).Used to receive flow that is assumed to occur widely across some</span>
<span class="sd">    kind of catchment.</span>

<span class="sd">    Args:</span>
<span class="sd">        vqip (dict): A VQIP that has been pushed</span>

<span class="sd">    Returns:</span>
<span class="sd">        reply (dict): A VQIP amount that was not successfuly receivesd</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">reply</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
    <span class="c1"># Iterate over timearea diagram TODO timearea diagram behaviour be generalised</span>
    <span class="c1"># across nodes</span>
    <span class="k">for</span> <span class="n">time</span><span class="p">,</span> <span class="n">normalised</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">timearea</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">vqip_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_change_vqip</span><span class="p">(</span><span class="n">vqip</span><span class="p">,</span> <span class="n">vqip</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">normalised</span><span class="p">)</span>
        <span class="n">reply_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="n">vqip_</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">)</span>
        <span class="n">reply</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum_vqip</span><span class="p">(</span><span class="n">reply</span><span class="p">,</span> <span class="n">reply_</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">reply</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="wsimod.nodes.storage.Reservoir" class="doc doc-heading">
            <code>Reservoir</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="wsimod.nodes.storage.Storage" href="#wsimod.nodes.storage.Storage">Storage</a></code></p>


        






              <details class="quote">
                <summary>Source code in <code>wsimod/nodes/storage.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">958</span>
<span class="normal">959</span>
<span class="normal">960</span>
<span class="normal">961</span>
<span class="normal">962</span>
<span class="normal">963</span>
<span class="normal">964</span>
<span class="normal">965</span>
<span class="normal">966</span>
<span class="normal">967</span>
<span class="normal">968</span>
<span class="normal">969</span>
<span class="normal">970</span>
<span class="normal">971</span>
<span class="normal">972</span>
<span class="normal">973</span>
<span class="normal">974</span>
<span class="normal">975</span>
<span class="normal">976</span>
<span class="normal">977</span>
<span class="normal">978</span>
<span class="normal">979</span>
<span class="normal">980</span>
<span class="normal">981</span>
<span class="normal">982</span>
<span class="normal">983</span>
<span class="normal">984</span>
<span class="normal">985</span>
<span class="normal">986</span>
<span class="normal">987</span>
<span class="normal">988</span>
<span class="normal">989</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Reservoir</span><span class="p">(</span><span class="n">Storage</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Storage node that makes abstractions by calling pull_distributed.</span>

<span class="sd">        Functions intended to call in orchestration:</span>
<span class="sd">            make_abstractions (before any river routing)</span>

<span class="sd">        Key assumptions:</span>
<span class="sd">            - Conceptualised as a `Tank`.</span>
<span class="sd">            - Recharged only via pumped abstractions.</span>
<span class="sd">            - Evaporation/precipitation onto surface area currently ignored.</span>
<span class="sd">            - If `decays` are provided to model water quality transformations,</span>
<span class="sd">                see `core.py/DecayObj`.</span>

<span class="sd">        Input data and parameter requirements:</span>
<span class="sd">            - Tank `capacity`, `area`, and `datum`.</span>
<span class="sd">                _Units_: cubic metres, squared metres, metres</span>
<span class="sd">            - Optional dictionary of decays with pollutants as keys and decay</span>
<span class="sd">                parameters (a constant and a temperature sensitivity exponent) as</span>
<span class="sd">                values. _Units_: -</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">make_abstractions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Pulls water and updates tanks.&quot;&quot;&quot;</span>
        <span class="n">reply</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pull_distributed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">get_excess</span><span class="p">())</span>
        <span class="n">spill</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="n">reply</span><span class="p">)</span>
        <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="n">spill</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">spill</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">constants</span><span class="o">.</span><span class="n">FLOAT_ACCURACY</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Spill at reservoir by </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">spill</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]))</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="wsimod.nodes.storage.Reservoir.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Storage node that makes abstractions by calling pull_distributed.</p>


<details class="functions-intended-to-call-in-orchestration" open>
  <summary>Functions intended to call in orchestration</summary>
  <p>make_abstractions (before any river routing)</p>
</details>

<details class="key-assumptions" open>
  <summary>Key assumptions</summary>
  <ul>
<li>Conceptualised as a <code>Tank</code>.</li>
<li>Recharged only via pumped abstractions.</li>
<li>Evaporation/precipitation onto surface area currently ignored.</li>
<li>If <code>decays</code> are provided to model water quality transformations,
    see <code>core.py/DecayObj</code>.</li>
</ul>
</details>

<details class="input-data-and-parameter-requirements" open>
  <summary>Input data and parameter requirements</summary>
  <ul>
<li>Tank <code>capacity</code>, <code>area</code>, and <code>datum</code>.
    <em>Units</em>: cubic metres, squared metres, metres</li>
<li>Optional dictionary of decays with pollutants as keys and decay
    parameters (a constant and a temperature sensitivity exponent) as
    values. <em>Units</em>: -</li>
</ul>
</details>
            <details class="quote">
              <summary>Source code in <code>wsimod/nodes/storage.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">961</span>
<span class="normal">962</span>
<span class="normal">963</span>
<span class="normal">964</span>
<span class="normal">965</span>
<span class="normal">966</span>
<span class="normal">967</span>
<span class="normal">968</span>
<span class="normal">969</span>
<span class="normal">970</span>
<span class="normal">971</span>
<span class="normal">972</span>
<span class="normal">973</span>
<span class="normal">974</span>
<span class="normal">975</span>
<span class="normal">976</span>
<span class="normal">977</span>
<span class="normal">978</span>
<span class="normal">979</span>
<span class="normal">980</span>
<span class="normal">981</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Storage node that makes abstractions by calling pull_distributed.</span>

<span class="sd">    Functions intended to call in orchestration:</span>
<span class="sd">        make_abstractions (before any river routing)</span>

<span class="sd">    Key assumptions:</span>
<span class="sd">        - Conceptualised as a `Tank`.</span>
<span class="sd">        - Recharged only via pumped abstractions.</span>
<span class="sd">        - Evaporation/precipitation onto surface area currently ignored.</span>
<span class="sd">        - If `decays` are provided to model water quality transformations,</span>
<span class="sd">            see `core.py/DecayObj`.</span>

<span class="sd">    Input data and parameter requirements:</span>
<span class="sd">        - Tank `capacity`, `area`, and `datum`.</span>
<span class="sd">            _Units_: cubic metres, squared metres, metres</span>
<span class="sd">        - Optional dictionary of decays with pollutants as keys and decay</span>
<span class="sd">            parameters (a constant and a temperature sensitivity exponent) as</span>
<span class="sd">            values. _Units_: -</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="wsimod.nodes.storage.Reservoir.make_abstractions" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_abstractions</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Pulls water and updates tanks.</p>

            <details class="quote">
              <summary>Source code in <code>wsimod/nodes/storage.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">983</span>
<span class="normal">984</span>
<span class="normal">985</span>
<span class="normal">986</span>
<span class="normal">987</span>
<span class="normal">988</span>
<span class="normal">989</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">make_abstractions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Pulls water and updates tanks.&quot;&quot;&quot;</span>
    <span class="n">reply</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pull_distributed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">get_excess</span><span class="p">())</span>
    <span class="n">spill</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="n">reply</span><span class="p">)</span>
    <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="n">spill</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">spill</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">constants</span><span class="o">.</span><span class="n">FLOAT_ACCURACY</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Spill at reservoir by </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">spill</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="wsimod.nodes.storage.River" class="doc doc-heading">
            <code>River</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="wsimod.nodes.storage.Storage" href="#wsimod.nodes.storage.Storage">Storage</a></code></p>


        






              <details class="quote">
                <summary>Source code in <code>wsimod/nodes/storage.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span>
<span class="normal">954</span>
<span class="normal">955</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">River</span><span class="p">(</span><span class="n">Storage</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>

    <span class="c1"># TODO non-day timestep</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">depth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">length</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
        <span class="n">width</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
        <span class="n">velocity</span><span class="o">=</span><span class="mf">0.2</span> <span class="o">*</span> <span class="n">constants</span><span class="o">.</span><span class="n">M_S_TO_M_DT</span><span class="p">,</span>
        <span class="n">damp</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
        <span class="n">mrf</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Node that contains extensive in-river biochemical processes.</span>

<span class="sd">        Args:</span>
<span class="sd">            depth (float, optional): River tank depth. Defaults to 2. length (float,</span>
<span class="sd">            optional): River tank length. Defaults to 200. width (float, optional):</span>
<span class="sd">            River tank width. Defaults to 20. velocity (float, optional): River velocity</span>
<span class="sd">            (if someone wants to calculate</span>
<span class="sd">                this on the fly that would also work). Defaults to</span>
<span class="sd">                0.2*constants.M_S_TO_M_DT.</span>
<span class="sd">            damp (float, optional): Flow delay and attentuation parameter. Defaults</span>
<span class="sd">                to 0.1.</span>
<span class="sd">            mrf (float, optional): Minimum required flow in river (volume per timestep),</span>
<span class="sd">                can limit pulls made to the river. Defaults to 0.</span>

<span class="sd">        Functions intended to call in orchestration:</span>
<span class="sd">            distribute</span>

<span class="sd">        Key assumptions:</span>
<span class="sd">             - River is conceptualised as a water tank that receives flows from various</span>
<span class="sd">                sources (e.g., runoffs from urban and rural land, baseflow from</span>
<span class="sd">                groundwater), interacts with water infrastructure (e.g., abstraction for</span>
<span class="sd">                irrigation and domestic supply, sewage and treated effluent discharge),</span>
<span class="sd">                and discharges flows downstream. It has length and width as shape</span>
<span class="sd">                parameters, average velocity to indicate flow speed and capacity to</span>
<span class="sd">                indicate the maximum storage limit.</span>
<span class="sd">             - Flows from different sources into rivers will fully mix. River tank is</span>
<span class="sd">               assumed to</span>
<span class="sd">                have delay and attenuation effects when generate outflows. These effects</span>
<span class="sd">                are simulated based on the average velocity.</span>
<span class="sd">             - In-river biochemical processes are simulated as sources/sinks of</span>
<span class="sd">               nutrients</span>
<span class="sd">                in the river tank, including - denitrification (for nitrogen) -</span>
<span class="sd">                phytoplankton absorption/release (for nitrogen and phosphorus) -</span>
<span class="sd">                macrophyte uptake (for nitrogen and phosphorus) These processes are</span>
<span class="sd">                affected by river temperature.</span>

<span class="sd">        Input data and parameter requirements:</span>
<span class="sd">             - depth, length, width</span>
<span class="sd">                _Units_: m</span>
<span class="sd">             - velocity</span>
<span class="sd">                _Units_: m/day</span>
<span class="sd">             - damping coefficient</span>
<span class="sd">                _Units_: -</span>
<span class="sd">             - minimum required flow</span>
<span class="sd">                _Units_: m3/day</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Set parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">=</span> <span class="n">depth</span>
        <span class="k">if</span> <span class="n">depth</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;warning: the depth parameter is unused by River nodes because it is </span><span class="se">\</span>
<span class="s2">		intended for capacity to be unbounded. It may be removed in a future version.&quot;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="n">length</span>  <span class="c1"># [m]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">width</span>  <span class="c1"># [m]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">velocity</span> <span class="o">=</span> <span class="n">velocity</span>  <span class="c1"># [m/dt]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">damp</span> <span class="o">=</span> <span class="n">damp</span>  <span class="c1"># [&gt;=0] flow delay and attenuation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mrf</span> <span class="o">=</span> <span class="n">mrf</span>
        <span class="n">area</span> <span class="o">=</span> <span class="n">length</span> <span class="o">*</span> <span class="n">width</span>  <span class="c1"># [m2]</span>

        <span class="n">capacity</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">constants</span><span class="o">.</span><span class="n">UNBOUNDED_CAPACITY</span>
        <span class="p">)</span>  <span class="c1"># TODO might be depth * area if flood indunation is going to be simulated</span>

        <span class="c1"># Required in cases where &#39;area&#39; conflicts with length*width</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;area&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">area</span>
        <span class="c1"># Required in cases where &#39;capacity&#39; conflicts with depth*area</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;capacity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">capacity</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># TODO check units TODO Will a user want to change any of these? Wide variety of</span>
        <span class="c1"># river parameters (from HYPE)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uptake_PNratio</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="mf">7.2</span>  <span class="c1"># [-] P:N during crop uptake</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bulk_density</span> <span class="o">=</span> <span class="mi">1300</span>  <span class="c1"># [kg/m3] soil density</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">denpar_w</span> <span class="o">=</span> <span class="mf">0.0015</span>  <span class="c1"># 0.001, # [kg/m2/day] reference denitrification rate</span>
        <span class="c1"># in water course</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">T_wdays</span> <span class="o">=</span> <span class="mi">5</span>  <span class="c1"># [days] weighting constant for river temperature calculation</span>
        <span class="c1"># (similar to moving average period)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">halfsatINwater</span> <span class="o">=</span> <span class="p">(</span>
            <span class="mf">1.5</span> <span class="o">*</span> <span class="n">constants</span><span class="o">.</span><span class="n">MG_L_TO_KG_M3</span>
        <span class="p">)</span>  <span class="c1"># [kg/m3] half saturation parameter for denitrification in river</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">T_10_days</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># [degree C] average water temperature of 10 days</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">T_20_days</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># [degree C] average water temperature of 20 days</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TP_365_days</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># [degree C] average water temperature of 20 days</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hsatTP</span> <span class="o">=</span> <span class="mf">0.05</span> <span class="o">*</span> <span class="n">constants</span><span class="o">.</span><span class="n">MG_L_TO_KG_M3</span>  <span class="c1"># [kg/m3]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">limpppar</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">constants</span><span class="o">.</span><span class="n">MG_L_TO_KG_M3</span>  <span class="c1"># [kg/m3]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prodNpar</span> <span class="o">=</span> <span class="mf">0.001</span>  <span class="c1"># [kg N/m3/day] nitrogen production/mineralisation rate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prodPpar</span> <span class="o">=</span> <span class="p">(</span>
            <span class="mf">0.0001</span>  <span class="c1"># [kg N/m3/day] phosphorus production/mineralisation rate</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muptNpar</span> <span class="o">=</span> <span class="mf">0.001</span>  <span class="c1"># [kg/m2/day] nitrogen macrophyte uptake rate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muptPpar</span> <span class="o">=</span> <span class="mf">0.0001</span>  <span class="c1"># 0.01, # [kg/m2/day] phosphorus macrophyte uptake rate</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">max_temp_lag</span> <span class="o">=</span> <span class="mi">20</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lagged_temperatures</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">max_phosphorus_lag</span> <span class="o">=</span> <span class="mi">365</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lagged_total_phosphorus</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">din_components</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ammonia&quot;</span><span class="p">,</span> <span class="s2">&quot;nitrate&quot;</span><span class="p">]</span>
        <span class="c1"># TODO need a cleaner way to do this depending on whether e.g., nitrite is</span>
        <span class="c1"># included</span>

        <span class="c1"># Initialise paramters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_depth</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># [m]</span>
        <span class="c1"># self.river_temperature = 0 # [degree C] self.river_denitrification = 0 #</span>
        <span class="c1"># [kg/day] self.macrophyte_uptake_N = 0 # [kg/day] self.macrophyte_uptake_P = 0</span>
        <span class="c1"># # [kg/day] self.sediment_particulate_phosphorus_pool = 60000 # [kg]</span>
        <span class="c1"># self.sediment_pool = 1000000 # [kg] self.benthos_source_sink = 0 # [kg/day]</span>
        <span class="c1"># self.t_res = 0 # [day] self.outflow = self.empty_vqip()</span>

        <span class="c1"># Update end_teimstep</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_timestep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_timestep_</span>

        <span class="c1"># Update handlers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push_set_handler</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_set_river</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push_check_handler</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_check_accept</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pull_check_handler</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pull_check_river</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pull_set_handler</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pull_set_river</span>

        <span class="c1"># TODO - RiparianBuffer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pull_check_handler</span><span class="p">[(</span><span class="s2">&quot;RiparianBuffer&quot;</span><span class="p">,</span> <span class="s2">&quot;volume&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pull_check_fp</span>

        <span class="c1"># Update mass balance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bio_in</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bio_out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mass_balance_in</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">bio_in</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mass_balance_out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">bio_out</span><span class="p">)</span>

    <span class="c1"># TODO something like this might be needed if you want sewers backing up from river</span>
    <span class="c1"># height... would need to incorporate expected river outflow def get_dt_excess(self,</span>
    <span class="c1">#     vqip = None): reply = self.empty_vqip() reply[&#39;volume&#39;] =</span>
    <span class="c1">#     self.tank.get_excess()[&#39;volume&#39;] + self.tank.get_avail()[&#39;volume&#39;] *</span>
    <span class="c1">#     self.get_riverrc() if vqip is not None: reply[&#39;volume&#39;] = min(vqip[&#39;volume&#39;],</span>
    <span class="c1">#         reply[&#39;volume&#39;]) return reply</span>

    <span class="c1"># def push_set_river(self, vqip): vqip_ = vqip.copy() vqip_ =</span>
    <span class="c1">#     self.v_change_vqip(vqip_, min(vqip_[&#39;volume&#39;],</span>
    <span class="c1">#     self.get_dt_excess()[&#39;volume&#39;])) _ = self.tank.push_storage(vqip_, force=True)</span>
    <span class="c1">#     return self.extract_vqip(vqip, vqip_)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">apply_overrides</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">overrides</span><span class="o">=</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Override parameters.</span>

<span class="sd">        Enables a user to override any of the following parameters:</span>
<span class="sd">        timearea.</span>

<span class="sd">        Args:</span>
<span class="sd">            overrides (Dict[str, Any]): Dict describing which parameters should</span>
<span class="sd">                be overridden (keys) and new values (values). Defaults to {}.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">overwrite_params</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="s2">&quot;length&quot;</span><span class="p">,</span>
                <span class="s2">&quot;width&quot;</span><span class="p">,</span>
                <span class="s2">&quot;velocity&quot;</span><span class="p">,</span>
                <span class="s2">&quot;damp&quot;</span><span class="p">,</span>
                <span class="s2">&quot;mrf&quot;</span><span class="p">,</span>
                <span class="s2">&quot;uptake_PNratio&quot;</span><span class="p">,</span>
                <span class="s2">&quot;bulk_density&quot;</span><span class="p">,</span>
                <span class="s2">&quot;denpar_w&quot;</span><span class="p">,</span>
                <span class="s2">&quot;T_wdays&quot;</span><span class="p">,</span>
                <span class="s2">&quot;halfsatINwater&quot;</span><span class="p">,</span>
                <span class="s2">&quot;hsatTP&quot;</span><span class="p">,</span>
                <span class="s2">&quot;limpppar&quot;</span><span class="p">,</span>
                <span class="s2">&quot;prodNpar&quot;</span><span class="p">,</span>
                <span class="s2">&quot;prodPpar&quot;</span><span class="p">,</span>
                <span class="s2">&quot;muptNpar&quot;</span><span class="p">,</span>
                <span class="s2">&quot;muptPpar&quot;</span><span class="p">,</span>
                <span class="s2">&quot;max_temp_lag&quot;</span><span class="p">,</span>
                <span class="s2">&quot;max_phosphorus_lag&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">overwrite_params</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">overrides</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">overrides</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">param</span><span class="p">))</span>

        <span class="k">if</span> <span class="s2">&quot;area&quot;</span> <span class="ow">in</span> <span class="n">overrides</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;WARNING: specifying area is depreciated in overrides </span><span class="se">\</span>
<span class="s2">		for river, please specify length and width instead&quot;</span>
            <span class="p">)</span>
        <span class="n">overrides</span><span class="p">[</span><span class="s2">&quot;area&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span>
        <span class="k">if</span> <span class="s2">&quot;capacity&quot;</span> <span class="ow">in</span> <span class="n">overrides</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;ERROR: specifying capacity is depreciated in overrides </span><span class="se">\</span>
<span class="s2">		for river, it is always set as unbounded capacity&quot;</span>
            <span class="p">)</span>
        <span class="n">overrides</span><span class="p">[</span><span class="s2">&quot;capacity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">constants</span><span class="o">.</span><span class="n">UNBOUNDED_CAPACITY</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">apply_overrides</span><span class="p">(</span><span class="n">overrides</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">pull_check_river</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vqip</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check amount of water that can be pulled from river tank and upstream.</span>

<span class="sd">        Args:</span>
<span class="sd">            vqip (dict, optional): Maximum water required (only &#39;volume&#39; is used)</span>

<span class="sd">        Returns:</span>
<span class="sd">            avail (dict): A VQIP amount that can be pulled</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Get storage</span>
        <span class="n">avail</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">get_avail</span><span class="p">()</span>

        <span class="c1"># Check incoming</span>
        <span class="n">upstream</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_connected</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="s2">&quot;pull&quot;</span><span class="p">,</span> <span class="n">of_type</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;River&quot;</span><span class="p">,</span> <span class="s2">&quot;Node&quot;</span><span class="p">])</span>
        <span class="n">avail</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">upstream</span><span class="p">[</span><span class="s2">&quot;avail&quot;</span><span class="p">]</span>

        <span class="c1"># convert mrf from volume/timestep to discrete value</span>
        <span class="n">mrf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mrf</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_riverrc</span><span class="p">()</span>

        <span class="c1"># Apply mrf</span>
        <span class="n">avail_vol</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">avail</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">mrf</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">vqip</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">avail</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_change_vqip</span><span class="p">(</span><span class="n">avail</span><span class="p">,</span> <span class="n">avail_vol</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">avail</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_change_vqip</span><span class="p">(</span><span class="n">avail</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">avail_vol</span><span class="p">,</span> <span class="n">vqip</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]))</span>

        <span class="k">return</span> <span class="n">avail</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">pull_set_river</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vqip</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Pull from river tank and upstream, acknowledging MRF with pull_check.</span>

<span class="sd">        Args:</span>
<span class="sd">            vqip (dict): A VQIP amount to pull (only volume key used)</span>

<span class="sd">        Returns:</span>
<span class="sd">            (dict): A VQIP amount that was pulled</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Calculate available pull</span>
        <span class="n">avail</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pull_check_river</span><span class="p">(</span><span class="n">vqip</span><span class="p">)</span>

        <span class="c1"># Take first from tank</span>
        <span class="n">pulled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">pull_storage</span><span class="p">(</span><span class="n">avail</span><span class="p">)</span>

        <span class="c1"># Take remaining from upstream</span>
        <span class="n">to_pull</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;volume&quot;</span><span class="p">:</span> <span class="n">avail</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">pulled</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]}</span>
        <span class="n">pulled_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pull_distributed</span><span class="p">(</span><span class="n">to_pull</span><span class="p">,</span> <span class="n">of_type</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;River&quot;</span><span class="p">,</span> <span class="s2">&quot;Node&quot;</span><span class="p">])</span>

        <span class="n">reply</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum_vqip</span><span class="p">(</span><span class="n">pulled</span><span class="p">,</span> <span class="n">pulled_</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">reply</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">push_set_river</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vqip</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Push to river tank, currently forced.</span>

<span class="sd">        Args:</span>
<span class="sd">            vqip (dict): A VQIP amount to push</span>

<span class="sd">        Returns:</span>
<span class="sd">            (dict): A VQIP amount that was not successfully received</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="n">vqip</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">update_depth</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Recalculate depth.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_depth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_din_pool</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get total dissolved inorganic nitrogen from tank storage.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (float): total din</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">din_components</span><span class="p">]</span>
        <span class="p">)</span>  <span class="c1"># TODO + self.tank.storage[&#39;nitrite&#39;] but nitrite might not be modelled...</span>
        <span class="c1"># need some ways to address this</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">biochemical_processes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Runs all biochemical processes and updates pollutant amounts.</span>

<span class="sd">        Returns:</span>
<span class="sd">            in_ (dict): A VQIP amount that represents total gain in pollutant amounts</span>
<span class="sd">            out_ (dict): A VQIP amount that represents total loss in pollutant amounts</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO make more modular</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_depth</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s2">&quot;temperature&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_wdays</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span>
            <span class="s2">&quot;temperature&quot;</span>
        <span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_wdays</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data_input</span><span class="p">(</span><span class="s2">&quot;temperature&quot;</span><span class="p">)</span>

        <span class="c1"># Update lagged temperatures</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lagged_temperatures</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_temp_lag</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">lagged_temperatures</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lagged_temperatures</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s2">&quot;temperature&quot;</span><span class="p">])</span>

        <span class="c1"># Update lagged total phosphorus</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lagged_total_phosphorus</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_phosphorus_lag</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">lagged_total_phosphorus</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">total_phosphorus</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s2">&quot;phosphate&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s2">&quot;org-phosphorus&quot;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lagged_total_phosphorus</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">total_phosphorus</span><span class="p">)</span>

        <span class="c1"># Check if any water</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">constants</span><span class="o">.</span><span class="n">FLOAT_ACCURACY</span><span class="p">:</span>
            <span class="c1"># Assume these only do something when there is water</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">())</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s2">&quot;temperature&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># Seems that these things are only active when above freezing</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">())</span>

        <span class="c1"># Denitrification</span>
        <span class="n">tempfcn</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">**</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s2">&quot;temperature&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">20</span><span class="p">)</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s2">&quot;temperature&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">tempfcn</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s2">&quot;temperature&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">5</span>

        <span class="n">din</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_din_pool</span><span class="p">()</span>
        <span class="n">din_concentration</span> <span class="o">=</span> <span class="n">din</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span>
        <span class="n">confcn</span> <span class="o">=</span> <span class="n">din_concentration</span> <span class="o">/</span> <span class="p">(</span>
            <span class="n">din_concentration</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">halfsatINwater</span>
        <span class="p">)</span>  <span class="c1"># [kg/m3]</span>
        <span class="n">denitri_water</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">denpar_w</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span> <span class="o">*</span> <span class="n">tempfcn</span> <span class="o">*</span> <span class="n">confcn</span>
        <span class="p">)</span>  <span class="c1"># [kg/day] #TODO convert to per DT</span>

        <span class="n">river_denitrification</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span>
            <span class="n">denitri_water</span><span class="p">,</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">din</span>
        <span class="p">)</span>  <span class="c1"># [kg/day] max 50% kan be denitrified</span>
        <span class="n">din_</span> <span class="o">=</span> <span class="n">din</span> <span class="o">-</span> <span class="n">river_denitrification</span>  <span class="c1"># [kg]</span>

        <span class="c1"># Update mass balance</span>
        <span class="n">in_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
        <span class="n">out_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">din</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">pol</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">din_components</span><span class="p">:</span>
                <span class="c1"># denitrification</span>
                <span class="n">loss</span> <span class="o">=</span> <span class="p">(</span><span class="n">din</span> <span class="o">-</span> <span class="n">din_</span><span class="p">)</span> <span class="o">/</span> <span class="n">din</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="n">pol</span><span class="p">]</span>
                <span class="n">out_</span><span class="p">[</span><span class="n">pol</span><span class="p">]</span> <span class="o">+=</span> <span class="n">loss</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="n">pol</span><span class="p">]</span> <span class="o">-=</span> <span class="n">loss</span>

        <span class="n">din</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_din_pool</span><span class="p">()</span>

        <span class="c1"># Calculate moving averages TODO generalise</span>
        <span class="n">temp_10_day</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lagged_temperatures</span><span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">:])</span> <span class="o">/</span> <span class="mi">10</span>
        <span class="n">temp_20_day</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lagged_temperatures</span><span class="p">[</span><span class="o">-</span><span class="mi">20</span><span class="p">:])</span> <span class="o">/</span> <span class="mi">20</span>
        <span class="n">total_phos_365_day</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lagged_total_phosphorus</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_phosphorus_lag</span>

        <span class="c1"># Calculate coefficients</span>
        <span class="n">tempfcn</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s2">&quot;temperature&quot;</span><span class="p">])</span> <span class="o">/</span> <span class="mi">20</span> <span class="o">*</span> <span class="p">(</span><span class="n">temp_10_day</span> <span class="o">-</span> <span class="n">temp_20_day</span><span class="p">)</span> <span class="o">/</span> <span class="mi">5</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">total_phos_365_day</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">limpppar</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsatTP</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">totalphosfcn</span> <span class="o">=</span> <span class="p">(</span><span class="n">total_phos_365_day</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">limpppar</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
                <span class="n">total_phos_365_day</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">limpppar</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsatTP</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">totalphosfcn</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Mineralisation/production TODO this feels like it could be much tidier</span>
        <span class="n">minprodN</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prodNpar</span> <span class="o">*</span> <span class="n">totalphosfcn</span> <span class="o">*</span> <span class="n">tempfcn</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_depth</span>
        <span class="p">)</span>  <span class="c1"># [kg N/day]</span>
        <span class="n">minprodP</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prodPpar</span>
            <span class="o">*</span> <span class="n">totalphosfcn</span>
            <span class="o">*</span> <span class="n">tempfcn</span>
            <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span>
            <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_depth</span>
            <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">uptake_PNratio</span>
        <span class="p">)</span>  <span class="c1"># [kg N/day]</span>
        <span class="k">if</span> <span class="n">minprodN</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># production (inorg -&gt; org)</span>
            <span class="n">minprodN</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span>
                <span class="mf">0.5</span> <span class="o">*</span> <span class="n">din</span><span class="p">,</span> <span class="n">minprodN</span>
            <span class="p">)</span>  <span class="c1"># only half pool can be used for production</span>
            <span class="n">minprodP</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span>
                <span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s2">&quot;phosphate&quot;</span><span class="p">],</span> <span class="n">minprodP</span>
            <span class="p">)</span>  <span class="c1"># only half pool can be used for production</span>

            <span class="c1"># Update mass balance</span>
            <span class="n">out_</span><span class="p">[</span><span class="s2">&quot;phosphate&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">minprodP</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s2">&quot;phosphate&quot;</span><span class="p">]</span> <span class="o">-=</span> <span class="n">minprodP</span>
            <span class="n">in_</span><span class="p">[</span><span class="s2">&quot;org-phosphorus&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">minprodP</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s2">&quot;org-phosphorus&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">minprodP</span>
            <span class="k">if</span> <span class="n">din</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">pol</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">din_components</span><span class="p">:</span>
                    <span class="n">loss</span> <span class="o">=</span> <span class="n">minprodN</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="n">pol</span><span class="p">]</span> <span class="o">/</span> <span class="n">din</span>
                    <span class="n">out_</span><span class="p">[</span><span class="n">pol</span><span class="p">]</span> <span class="o">+=</span> <span class="n">loss</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="n">pol</span><span class="p">]</span> <span class="o">-=</span> <span class="n">loss</span>

            <span class="n">in_</span><span class="p">[</span><span class="s2">&quot;org-nitrogen&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">minprodN</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s2">&quot;org-nitrogen&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">minprodN</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># mineralisation (org -&gt; inorg)</span>
            <span class="n">minprodN</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s2">&quot;org-nitrogen&quot;</span><span class="p">],</span> <span class="o">-</span><span class="n">minprodN</span><span class="p">)</span>
            <span class="n">minprodP</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s2">&quot;org-phosphorus&quot;</span><span class="p">],</span> <span class="o">-</span><span class="n">minprodP</span><span class="p">)</span>

            <span class="c1"># Update mass balance</span>
            <span class="n">in_</span><span class="p">[</span><span class="s2">&quot;phosphate&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">minprodP</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s2">&quot;phosphate&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">minprodP</span>
            <span class="n">out_</span><span class="p">[</span><span class="s2">&quot;org-phosphorus&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">minprodP</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s2">&quot;org-phosphorus&quot;</span><span class="p">]</span> <span class="o">-=</span> <span class="n">minprodP</span>
            <span class="k">if</span> <span class="n">din</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">pol</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">din_components</span><span class="p">:</span>
                    <span class="n">gain</span> <span class="o">=</span> <span class="n">minprodN</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="n">pol</span><span class="p">]</span> <span class="o">/</span> <span class="n">din</span>
                    <span class="n">in_</span><span class="p">[</span><span class="n">pol</span><span class="p">]</span> <span class="o">+=</span> <span class="n">gain</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="n">pol</span><span class="p">]</span> <span class="o">+=</span> <span class="n">gain</span>

            <span class="n">out_</span><span class="p">[</span><span class="s2">&quot;org-nitrogen&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">minprodN</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s2">&quot;org-nitrogen&quot;</span><span class="p">]</span> <span class="o">-=</span> <span class="n">minprodN</span>

        <span class="n">din</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_din_pool</span><span class="p">()</span>

        <span class="c1"># macrophyte uptake temperature dependence factor</span>
        <span class="n">tempfcn1</span> <span class="o">=</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s2">&quot;temperature&quot;</span><span class="p">])</span> <span class="o">/</span> <span class="mi">20</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.3</span>
        <span class="n">tempfcn2</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s2">&quot;temperature&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">temp_20_day</span><span class="p">)</span> <span class="o">/</span> <span class="mi">5</span>
        <span class="n">tempfcn</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">tempfcn1</span> <span class="o">*</span> <span class="n">tempfcn2</span><span class="p">)</span>

        <span class="n">macrouptN</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">muptNpar</span> <span class="o">*</span> <span class="n">tempfcn</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span>  <span class="c1"># [kg/day]</span>
        <span class="n">macrophyte_uptake_N</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">din</span><span class="p">,</span> <span class="n">macrouptN</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">din</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">pol</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">din_components</span><span class="p">:</span>
                <span class="n">loss</span> <span class="o">=</span> <span class="n">macrophyte_uptake_N</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="n">pol</span><span class="p">]</span> <span class="o">/</span> <span class="n">din</span>
                <span class="n">out_</span><span class="p">[</span><span class="n">pol</span><span class="p">]</span> <span class="o">+=</span> <span class="n">loss</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="n">pol</span><span class="p">]</span> <span class="o">-=</span> <span class="n">loss</span>

        <span class="n">macrouptP</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">muptPpar</span> <span class="o">*</span> <span class="n">tempfcn</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">totalphosfcn</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span>
        <span class="p">)</span>  <span class="c1"># [kg/day]</span>
        <span class="n">macrophyte_uptake_P</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s2">&quot;phosphate&quot;</span><span class="p">],</span> <span class="n">macrouptP</span><span class="p">)</span>
        <span class="n">out_</span><span class="p">[</span><span class="s2">&quot;phosphate&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">macrophyte_uptake_P</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s2">&quot;phosphate&quot;</span><span class="p">]</span> <span class="o">-=</span> <span class="n">macrophyte_uptake_P</span>

        <span class="c1"># TODO source/sink for benthos sediment P suspension/resuspension</span>
        <span class="k">return</span> <span class="n">in_</span><span class="p">,</span> <span class="n">out_</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_riverrc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get river outflow coefficient (i.e., how much water leaves the tank in this</span>
<span class="sd">        timestep).</span>

<span class="sd">        Returns:</span>
<span class="sd">            riverrc (float): outflow coeffficient</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Calculate travel time</span>
        <span class="n">total_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">velocity</span>
        <span class="c1"># Apply damp</span>
        <span class="n">kt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">damp</span> <span class="o">*</span> <span class="n">total_time</span>  <span class="c1"># [day]</span>
        <span class="k">if</span> <span class="n">kt</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">riverrc</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">kt</span> <span class="o">+</span> <span class="n">kt</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">/</span> <span class="n">kt</span><span class="p">)</span>  <span class="c1"># [-]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">riverrc</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">riverrc</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">calculate_discharge</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;nitrate&quot;</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">POLLUTANTS</span><span class="p">:</span>
            <span class="c1"># TODO clumsy Run biochemical processes</span>
            <span class="n">in_</span><span class="p">,</span> <span class="n">out_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">biochemical_processes</span><span class="p">()</span>
            <span class="c1"># Mass balance</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bio_in</span> <span class="o">=</span> <span class="n">in_</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bio_out</span> <span class="o">=</span> <span class="n">out_</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">distribute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run biochemical processes, track mass balance, and distribute water.&quot;&quot;&quot;</span>
        <span class="c1"># self.calculate_discharge() Get outflow</span>
        <span class="n">outflow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">pull_storage</span><span class="p">(</span>
            <span class="p">{</span><span class="s2">&quot;volume&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_riverrc</span><span class="p">()}</span>
        <span class="p">)</span>
        <span class="c1"># Distribute outflow</span>
        <span class="n">reply</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_distributed</span><span class="p">(</span><span class="n">outflow</span><span class="p">,</span> <span class="n">of_type</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;River&quot;</span><span class="p">,</span> <span class="s2">&quot;Node&quot;</span><span class="p">,</span> <span class="s2">&quot;Waste&quot;</span><span class="p">])</span>
        <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="n">reply</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">constants</span><span class="o">.</span><span class="n">FLOAT_ACCURACY</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;river cant push: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">pull_check_fp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vqip</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Args:</span>
<span class="sd">            vqip:</span>

<span class="sd">        Returns:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO Pull checking for riparian buffer, needs updating update river depth</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_depth</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_depth</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_tank</span><span class="o">.</span><span class="n">storage</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">end_timestep_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update state variables.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">end_timestep</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bio_in</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bio_out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="wsimod.nodes.storage.River.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">depth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">velocity</span><span class="o">=</span><span class="mf">0.2</span> <span class="o">*</span> <span class="n">constants</span><span class="o">.</span><span class="n">M_S_TO_M_DT</span><span class="p">,</span> <span class="n">damp</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">mrf</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Node that contains extensive in-river biochemical processes.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>depth</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>River tank depth. Defaults to 2. length (float,</p>
              </div>
            </td>
            <td>
                  <code>2</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>optional)</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>River tank length. Defaults to 200. width (float, optional):</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>River</code>
            </td>
            <td>
                  <code>tank width. Defaults to 20. velocity (float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>River velocity</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>damp</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Flow delay and attentuation parameter. Defaults
to 0.1.</p>
              </div>
            </td>
            <td>
                  <code>0.1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mrf</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum required flow in river (volume per timestep),
can limit pulls made to the river. Defaults to 0.</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="functions-intended-to-call-in-orchestration" open>
  <summary>Functions intended to call in orchestration</summary>
  <p>distribute</p>
</details>

<details class="key-assumptions" open>
  <summary>Key assumptions</summary>
  <ul>
<li>River is conceptualised as a water tank that receives flows from various
   sources (e.g., runoffs from urban and rural land, baseflow from
   groundwater), interacts with water infrastructure (e.g., abstraction for
   irrigation and domestic supply, sewage and treated effluent discharge),
   and discharges flows downstream. It has length and width as shape
   parameters, average velocity to indicate flow speed and capacity to
   indicate the maximum storage limit.</li>
<li>Flows from different sources into rivers will fully mix. River tank is
  assumed to
   have delay and attenuation effects when generate outflows. These effects
   are simulated based on the average velocity.</li>
<li>In-river biochemical processes are simulated as sources/sinks of
  nutrients
   in the river tank, including - denitrification (for nitrogen) -
   phytoplankton absorption/release (for nitrogen and phosphorus) -
   macrophyte uptake (for nitrogen and phosphorus) These processes are
   affected by river temperature.</li>
</ul>
</details>

<details class="input-data-and-parameter-requirements" open>
  <summary>Input data and parameter requirements</summary>
  <ul>
<li>depth, length, width
   <em>Units</em>: m</li>
<li>velocity
   <em>Units</em>: m/day</li>
<li>damping coefficient
   <em>Units</em>: -</li>
<li>minimum required flow
   <em>Units</em>: m3/day</li>
</ul>
</details>
            <details class="quote">
              <summary>Source code in <code>wsimod/nodes/storage.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span></pre></div></td><td class="code"><div><pre><span></span><code>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">depth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">length</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
        <span class="n">width</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
        <span class="n">velocity</span><span class="o">=</span><span class="mf">0.2</span> <span class="o">*</span> <span class="n">constants</span><span class="o">.</span><span class="n">M_S_TO_M_DT</span><span class="p">,</span>
        <span class="n">damp</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
        <span class="n">mrf</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Node that contains extensive in-river biochemical processes.</span>

<span class="sd">        Args:</span>
<span class="sd">            depth (float, optional): River tank depth. Defaults to 2. length (float,</span>
<span class="sd">            optional): River tank length. Defaults to 200. width (float, optional):</span>
<span class="sd">            River tank width. Defaults to 20. velocity (float, optional): River velocity</span>
<span class="sd">            (if someone wants to calculate</span>
<span class="sd">                this on the fly that would also work). Defaults to</span>
<span class="sd">                0.2*constants.M_S_TO_M_DT.</span>
<span class="sd">            damp (float, optional): Flow delay and attentuation parameter. Defaults</span>
<span class="sd">                to 0.1.</span>
<span class="sd">            mrf (float, optional): Minimum required flow in river (volume per timestep),</span>
<span class="sd">                can limit pulls made to the river. Defaults to 0.</span>

<span class="sd">        Functions intended to call in orchestration:</span>
<span class="sd">            distribute</span>

<span class="sd">        Key assumptions:</span>
<span class="sd">             - River is conceptualised as a water tank that receives flows from various</span>
<span class="sd">                sources (e.g., runoffs from urban and rural land, baseflow from</span>
<span class="sd">                groundwater), interacts with water infrastructure (e.g., abstraction for</span>
<span class="sd">                irrigation and domestic supply, sewage and treated effluent discharge),</span>
<span class="sd">                and discharges flows downstream. It has length and width as shape</span>
<span class="sd">                parameters, average velocity to indicate flow speed and capacity to</span>
<span class="sd">                indicate the maximum storage limit.</span>
<span class="sd">             - Flows from different sources into rivers will fully mix. River tank is</span>
<span class="sd">               assumed to</span>
<span class="sd">                have delay and attenuation effects when generate outflows. These effects</span>
<span class="sd">                are simulated based on the average velocity.</span>
<span class="sd">             - In-river biochemical processes are simulated as sources/sinks of</span>
<span class="sd">               nutrients</span>
<span class="sd">                in the river tank, including - denitrification (for nitrogen) -</span>
<span class="sd">                phytoplankton absorption/release (for nitrogen and phosphorus) -</span>
<span class="sd">                macrophyte uptake (for nitrogen and phosphorus) These processes are</span>
<span class="sd">                affected by river temperature.</span>

<span class="sd">        Input data and parameter requirements:</span>
<span class="sd">             - depth, length, width</span>
<span class="sd">                _Units_: m</span>
<span class="sd">             - velocity</span>
<span class="sd">                _Units_: m/day</span>
<span class="sd">             - damping coefficient</span>
<span class="sd">                _Units_: -</span>
<span class="sd">             - minimum required flow</span>
<span class="sd">                _Units_: m3/day</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Set parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">=</span> <span class="n">depth</span>
        <span class="k">if</span> <span class="n">depth</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;warning: the depth parameter is unused by River nodes because it is </span><span class="se">\</span>
<span class="s2">		intended for capacity to be unbounded. It may be removed in a future version.&quot;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="n">length</span>  <span class="c1"># [m]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">width</span>  <span class="c1"># [m]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">velocity</span> <span class="o">=</span> <span class="n">velocity</span>  <span class="c1"># [m/dt]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">damp</span> <span class="o">=</span> <span class="n">damp</span>  <span class="c1"># [&gt;=0] flow delay and attenuation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mrf</span> <span class="o">=</span> <span class="n">mrf</span>
        <span class="n">area</span> <span class="o">=</span> <span class="n">length</span> <span class="o">*</span> <span class="n">width</span>  <span class="c1"># [m2]</span>

        <span class="n">capacity</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">constants</span><span class="o">.</span><span class="n">UNBOUNDED_CAPACITY</span>
        <span class="p">)</span>  <span class="c1"># TODO might be depth * area if flood indunation is going to be simulated</span>

        <span class="c1"># Required in cases where &#39;area&#39; conflicts with length*width</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;area&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">area</span>
        <span class="c1"># Required in cases where &#39;capacity&#39; conflicts with depth*area</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;capacity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">capacity</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># TODO check units TODO Will a user want to change any of these? Wide variety of</span>
        <span class="c1"># river parameters (from HYPE)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uptake_PNratio</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="mf">7.2</span>  <span class="c1"># [-] P:N during crop uptake</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bulk_density</span> <span class="o">=</span> <span class="mi">1300</span>  <span class="c1"># [kg/m3] soil density</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">denpar_w</span> <span class="o">=</span> <span class="mf">0.0015</span>  <span class="c1"># 0.001, # [kg/m2/day] reference denitrification rate</span>
        <span class="c1"># in water course</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">T_wdays</span> <span class="o">=</span> <span class="mi">5</span>  <span class="c1"># [days] weighting constant for river temperature calculation</span>
        <span class="c1"># (similar to moving average period)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">halfsatINwater</span> <span class="o">=</span> <span class="p">(</span>
            <span class="mf">1.5</span> <span class="o">*</span> <span class="n">constants</span><span class="o">.</span><span class="n">MG_L_TO_KG_M3</span>
        <span class="p">)</span>  <span class="c1"># [kg/m3] half saturation parameter for denitrification in river</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">T_10_days</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># [degree C] average water temperature of 10 days</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">T_20_days</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># [degree C] average water temperature of 20 days</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TP_365_days</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># [degree C] average water temperature of 20 days</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hsatTP</span> <span class="o">=</span> <span class="mf">0.05</span> <span class="o">*</span> <span class="n">constants</span><span class="o">.</span><span class="n">MG_L_TO_KG_M3</span>  <span class="c1"># [kg/m3]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">limpppar</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">constants</span><span class="o">.</span><span class="n">MG_L_TO_KG_M3</span>  <span class="c1"># [kg/m3]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prodNpar</span> <span class="o">=</span> <span class="mf">0.001</span>  <span class="c1"># [kg N/m3/day] nitrogen production/mineralisation rate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prodPpar</span> <span class="o">=</span> <span class="p">(</span>
            <span class="mf">0.0001</span>  <span class="c1"># [kg N/m3/day] phosphorus production/mineralisation rate</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muptNpar</span> <span class="o">=</span> <span class="mf">0.001</span>  <span class="c1"># [kg/m2/day] nitrogen macrophyte uptake rate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muptPpar</span> <span class="o">=</span> <span class="mf">0.0001</span>  <span class="c1"># 0.01, # [kg/m2/day] phosphorus macrophyte uptake rate</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">max_temp_lag</span> <span class="o">=</span> <span class="mi">20</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lagged_temperatures</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">max_phosphorus_lag</span> <span class="o">=</span> <span class="mi">365</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lagged_total_phosphorus</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">din_components</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ammonia&quot;</span><span class="p">,</span> <span class="s2">&quot;nitrate&quot;</span><span class="p">]</span>
        <span class="c1"># TODO need a cleaner way to do this depending on whether e.g., nitrite is</span>
        <span class="c1"># included</span>

        <span class="c1"># Initialise paramters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_depth</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># [m]</span>
        <span class="c1"># self.river_temperature = 0 # [degree C] self.river_denitrification = 0 #</span>
        <span class="c1"># [kg/day] self.macrophyte_uptake_N = 0 # [kg/day] self.macrophyte_uptake_P = 0</span>
        <span class="c1"># # [kg/day] self.sediment_particulate_phosphorus_pool = 60000 # [kg]</span>
        <span class="c1"># self.sediment_pool = 1000000 # [kg] self.benthos_source_sink = 0 # [kg/day]</span>
        <span class="c1"># self.t_res = 0 # [day] self.outflow = self.empty_vqip()</span>

        <span class="c1"># Update end_teimstep</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_timestep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_timestep_</span>

        <span class="c1"># Update handlers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push_set_handler</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_set_river</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push_check_handler</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_check_accept</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pull_check_handler</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pull_check_river</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pull_set_handler</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pull_set_river</span>

        <span class="c1"># TODO - RiparianBuffer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pull_check_handler</span><span class="p">[(</span><span class="s2">&quot;RiparianBuffer&quot;</span><span class="p">,</span> <span class="s2">&quot;volume&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pull_check_fp</span>

        <span class="c1"># Update mass balance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bio_in</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bio_out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mass_balance_in</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">bio_in</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mass_balance_out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">bio_out</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="wsimod.nodes.storage.River.apply_overrides" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">apply_overrides</span><span class="p">(</span><span class="n">overrides</span><span class="o">=</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Override parameters.</p>
<p>Enables a user to override any of the following parameters:
timearea.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>overrides</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dict describing which parameters should
be overridden (keys) and new values (values). Defaults to {}.</p>
              </div>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>wsimod/nodes/storage.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span></pre></div></td><td class="code"><div><pre><span></span><code>    <span class="k">def</span><span class="w"> </span><span class="nf">apply_overrides</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">overrides</span><span class="o">=</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Override parameters.</span>

<span class="sd">        Enables a user to override any of the following parameters:</span>
<span class="sd">        timearea.</span>

<span class="sd">        Args:</span>
<span class="sd">            overrides (Dict[str, Any]): Dict describing which parameters should</span>
<span class="sd">                be overridden (keys) and new values (values). Defaults to {}.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">overwrite_params</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="s2">&quot;length&quot;</span><span class="p">,</span>
                <span class="s2">&quot;width&quot;</span><span class="p">,</span>
                <span class="s2">&quot;velocity&quot;</span><span class="p">,</span>
                <span class="s2">&quot;damp&quot;</span><span class="p">,</span>
                <span class="s2">&quot;mrf&quot;</span><span class="p">,</span>
                <span class="s2">&quot;uptake_PNratio&quot;</span><span class="p">,</span>
                <span class="s2">&quot;bulk_density&quot;</span><span class="p">,</span>
                <span class="s2">&quot;denpar_w&quot;</span><span class="p">,</span>
                <span class="s2">&quot;T_wdays&quot;</span><span class="p">,</span>
                <span class="s2">&quot;halfsatINwater&quot;</span><span class="p">,</span>
                <span class="s2">&quot;hsatTP&quot;</span><span class="p">,</span>
                <span class="s2">&quot;limpppar&quot;</span><span class="p">,</span>
                <span class="s2">&quot;prodNpar&quot;</span><span class="p">,</span>
                <span class="s2">&quot;prodPpar&quot;</span><span class="p">,</span>
                <span class="s2">&quot;muptNpar&quot;</span><span class="p">,</span>
                <span class="s2">&quot;muptPpar&quot;</span><span class="p">,</span>
                <span class="s2">&quot;max_temp_lag&quot;</span><span class="p">,</span>
                <span class="s2">&quot;max_phosphorus_lag&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">overwrite_params</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">overrides</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">overrides</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">param</span><span class="p">))</span>

        <span class="k">if</span> <span class="s2">&quot;area&quot;</span> <span class="ow">in</span> <span class="n">overrides</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;WARNING: specifying area is depreciated in overrides </span><span class="se">\</span>
<span class="s2">		for river, please specify length and width instead&quot;</span>
            <span class="p">)</span>
        <span class="n">overrides</span><span class="p">[</span><span class="s2">&quot;area&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span>
        <span class="k">if</span> <span class="s2">&quot;capacity&quot;</span> <span class="ow">in</span> <span class="n">overrides</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;ERROR: specifying capacity is depreciated in overrides </span><span class="se">\</span>
<span class="s2">		for river, it is always set as unbounded capacity&quot;</span>
            <span class="p">)</span>
        <span class="n">overrides</span><span class="p">[</span><span class="s2">&quot;capacity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">constants</span><span class="o">.</span><span class="n">UNBOUNDED_CAPACITY</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">apply_overrides</span><span class="p">(</span><span class="n">overrides</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="wsimod.nodes.storage.River.biochemical_processes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">biochemical_processes</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Runs all biochemical processes and updates pollutant amounts.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>in_</code></td>            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A VQIP amount that represents total gain in pollutant amounts</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>out_</code></td>            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A VQIP amount that represents total loss in pollutant amounts</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>wsimod/nodes/storage.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">biochemical_processes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Runs all biochemical processes and updates pollutant amounts.</span>

<span class="sd">    Returns:</span>
<span class="sd">        in_ (dict): A VQIP amount that represents total gain in pollutant amounts</span>
<span class="sd">        out_ (dict): A VQIP amount that represents total loss in pollutant amounts</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO make more modular</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">update_depth</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s2">&quot;temperature&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_wdays</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span>
        <span class="s2">&quot;temperature&quot;</span>
    <span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_wdays</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data_input</span><span class="p">(</span><span class="s2">&quot;temperature&quot;</span><span class="p">)</span>

    <span class="c1"># Update lagged temperatures</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lagged_temperatures</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_temp_lag</span><span class="p">:</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">lagged_temperatures</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lagged_temperatures</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s2">&quot;temperature&quot;</span><span class="p">])</span>

    <span class="c1"># Update lagged total phosphorus</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lagged_total_phosphorus</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_phosphorus_lag</span><span class="p">:</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">lagged_total_phosphorus</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">total_phosphorus</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s2">&quot;phosphate&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s2">&quot;org-phosphorus&quot;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lagged_total_phosphorus</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">total_phosphorus</span><span class="p">)</span>

    <span class="c1"># Check if any water</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">constants</span><span class="o">.</span><span class="n">FLOAT_ACCURACY</span><span class="p">:</span>
        <span class="c1"># Assume these only do something when there is water</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">())</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s2">&quot;temperature&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># Seems that these things are only active when above freezing</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">())</span>

    <span class="c1"># Denitrification</span>
    <span class="n">tempfcn</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">**</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s2">&quot;temperature&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">20</span><span class="p">)</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s2">&quot;temperature&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
        <span class="n">tempfcn</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s2">&quot;temperature&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">5</span>

    <span class="n">din</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_din_pool</span><span class="p">()</span>
    <span class="n">din_concentration</span> <span class="o">=</span> <span class="n">din</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span>
    <span class="n">confcn</span> <span class="o">=</span> <span class="n">din_concentration</span> <span class="o">/</span> <span class="p">(</span>
        <span class="n">din_concentration</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">halfsatINwater</span>
    <span class="p">)</span>  <span class="c1"># [kg/m3]</span>
    <span class="n">denitri_water</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">denpar_w</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span> <span class="o">*</span> <span class="n">tempfcn</span> <span class="o">*</span> <span class="n">confcn</span>
    <span class="p">)</span>  <span class="c1"># [kg/day] #TODO convert to per DT</span>

    <span class="n">river_denitrification</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span>
        <span class="n">denitri_water</span><span class="p">,</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">din</span>
    <span class="p">)</span>  <span class="c1"># [kg/day] max 50% kan be denitrified</span>
    <span class="n">din_</span> <span class="o">=</span> <span class="n">din</span> <span class="o">-</span> <span class="n">river_denitrification</span>  <span class="c1"># [kg]</span>

    <span class="c1"># Update mass balance</span>
    <span class="n">in_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
    <span class="n">out_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">din</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">pol</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">din_components</span><span class="p">:</span>
            <span class="c1"># denitrification</span>
            <span class="n">loss</span> <span class="o">=</span> <span class="p">(</span><span class="n">din</span> <span class="o">-</span> <span class="n">din_</span><span class="p">)</span> <span class="o">/</span> <span class="n">din</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="n">pol</span><span class="p">]</span>
            <span class="n">out_</span><span class="p">[</span><span class="n">pol</span><span class="p">]</span> <span class="o">+=</span> <span class="n">loss</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="n">pol</span><span class="p">]</span> <span class="o">-=</span> <span class="n">loss</span>

    <span class="n">din</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_din_pool</span><span class="p">()</span>

    <span class="c1"># Calculate moving averages TODO generalise</span>
    <span class="n">temp_10_day</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lagged_temperatures</span><span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">:])</span> <span class="o">/</span> <span class="mi">10</span>
    <span class="n">temp_20_day</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lagged_temperatures</span><span class="p">[</span><span class="o">-</span><span class="mi">20</span><span class="p">:])</span> <span class="o">/</span> <span class="mi">20</span>
    <span class="n">total_phos_365_day</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lagged_total_phosphorus</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_phosphorus_lag</span>

    <span class="c1"># Calculate coefficients</span>
    <span class="n">tempfcn</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s2">&quot;temperature&quot;</span><span class="p">])</span> <span class="o">/</span> <span class="mi">20</span> <span class="o">*</span> <span class="p">(</span><span class="n">temp_10_day</span> <span class="o">-</span> <span class="n">temp_20_day</span><span class="p">)</span> <span class="o">/</span> <span class="mi">5</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">total_phos_365_day</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">limpppar</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsatTP</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">totalphosfcn</span> <span class="o">=</span> <span class="p">(</span><span class="n">total_phos_365_day</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">limpppar</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
            <span class="n">total_phos_365_day</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">limpppar</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsatTP</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">totalphosfcn</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># Mineralisation/production TODO this feels like it could be much tidier</span>
    <span class="n">minprodN</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prodNpar</span> <span class="o">*</span> <span class="n">totalphosfcn</span> <span class="o">*</span> <span class="n">tempfcn</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_depth</span>
    <span class="p">)</span>  <span class="c1"># [kg N/day]</span>
    <span class="n">minprodP</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prodPpar</span>
        <span class="o">*</span> <span class="n">totalphosfcn</span>
        <span class="o">*</span> <span class="n">tempfcn</span>
        <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span>
        <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_depth</span>
        <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">uptake_PNratio</span>
    <span class="p">)</span>  <span class="c1"># [kg N/day]</span>
    <span class="k">if</span> <span class="n">minprodN</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># production (inorg -&gt; org)</span>
        <span class="n">minprodN</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span>
            <span class="mf">0.5</span> <span class="o">*</span> <span class="n">din</span><span class="p">,</span> <span class="n">minprodN</span>
        <span class="p">)</span>  <span class="c1"># only half pool can be used for production</span>
        <span class="n">minprodP</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span>
            <span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s2">&quot;phosphate&quot;</span><span class="p">],</span> <span class="n">minprodP</span>
        <span class="p">)</span>  <span class="c1"># only half pool can be used for production</span>

        <span class="c1"># Update mass balance</span>
        <span class="n">out_</span><span class="p">[</span><span class="s2">&quot;phosphate&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">minprodP</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s2">&quot;phosphate&quot;</span><span class="p">]</span> <span class="o">-=</span> <span class="n">minprodP</span>
        <span class="n">in_</span><span class="p">[</span><span class="s2">&quot;org-phosphorus&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">minprodP</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s2">&quot;org-phosphorus&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">minprodP</span>
        <span class="k">if</span> <span class="n">din</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">pol</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">din_components</span><span class="p">:</span>
                <span class="n">loss</span> <span class="o">=</span> <span class="n">minprodN</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="n">pol</span><span class="p">]</span> <span class="o">/</span> <span class="n">din</span>
                <span class="n">out_</span><span class="p">[</span><span class="n">pol</span><span class="p">]</span> <span class="o">+=</span> <span class="n">loss</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="n">pol</span><span class="p">]</span> <span class="o">-=</span> <span class="n">loss</span>

        <span class="n">in_</span><span class="p">[</span><span class="s2">&quot;org-nitrogen&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">minprodN</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s2">&quot;org-nitrogen&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">minprodN</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># mineralisation (org -&gt; inorg)</span>
        <span class="n">minprodN</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s2">&quot;org-nitrogen&quot;</span><span class="p">],</span> <span class="o">-</span><span class="n">minprodN</span><span class="p">)</span>
        <span class="n">minprodP</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s2">&quot;org-phosphorus&quot;</span><span class="p">],</span> <span class="o">-</span><span class="n">minprodP</span><span class="p">)</span>

        <span class="c1"># Update mass balance</span>
        <span class="n">in_</span><span class="p">[</span><span class="s2">&quot;phosphate&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">minprodP</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s2">&quot;phosphate&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">minprodP</span>
        <span class="n">out_</span><span class="p">[</span><span class="s2">&quot;org-phosphorus&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">minprodP</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s2">&quot;org-phosphorus&quot;</span><span class="p">]</span> <span class="o">-=</span> <span class="n">minprodP</span>
        <span class="k">if</span> <span class="n">din</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">pol</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">din_components</span><span class="p">:</span>
                <span class="n">gain</span> <span class="o">=</span> <span class="n">minprodN</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="n">pol</span><span class="p">]</span> <span class="o">/</span> <span class="n">din</span>
                <span class="n">in_</span><span class="p">[</span><span class="n">pol</span><span class="p">]</span> <span class="o">+=</span> <span class="n">gain</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="n">pol</span><span class="p">]</span> <span class="o">+=</span> <span class="n">gain</span>

        <span class="n">out_</span><span class="p">[</span><span class="s2">&quot;org-nitrogen&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">minprodN</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s2">&quot;org-nitrogen&quot;</span><span class="p">]</span> <span class="o">-=</span> <span class="n">minprodN</span>

    <span class="n">din</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_din_pool</span><span class="p">()</span>

    <span class="c1"># macrophyte uptake temperature dependence factor</span>
    <span class="n">tempfcn1</span> <span class="o">=</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s2">&quot;temperature&quot;</span><span class="p">])</span> <span class="o">/</span> <span class="mi">20</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.3</span>
    <span class="n">tempfcn2</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s2">&quot;temperature&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">temp_20_day</span><span class="p">)</span> <span class="o">/</span> <span class="mi">5</span>
    <span class="n">tempfcn</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">tempfcn1</span> <span class="o">*</span> <span class="n">tempfcn2</span><span class="p">)</span>

    <span class="n">macrouptN</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">muptNpar</span> <span class="o">*</span> <span class="n">tempfcn</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span>  <span class="c1"># [kg/day]</span>
    <span class="n">macrophyte_uptake_N</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">din</span><span class="p">,</span> <span class="n">macrouptN</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">din</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">pol</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">din_components</span><span class="p">:</span>
            <span class="n">loss</span> <span class="o">=</span> <span class="n">macrophyte_uptake_N</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="n">pol</span><span class="p">]</span> <span class="o">/</span> <span class="n">din</span>
            <span class="n">out_</span><span class="p">[</span><span class="n">pol</span><span class="p">]</span> <span class="o">+=</span> <span class="n">loss</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="n">pol</span><span class="p">]</span> <span class="o">-=</span> <span class="n">loss</span>

    <span class="n">macrouptP</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muptPpar</span> <span class="o">*</span> <span class="n">tempfcn</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">totalphosfcn</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span>
    <span class="p">)</span>  <span class="c1"># [kg/day]</span>
    <span class="n">macrophyte_uptake_P</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s2">&quot;phosphate&quot;</span><span class="p">],</span> <span class="n">macrouptP</span><span class="p">)</span>
    <span class="n">out_</span><span class="p">[</span><span class="s2">&quot;phosphate&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">macrophyte_uptake_P</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s2">&quot;phosphate&quot;</span><span class="p">]</span> <span class="o">-=</span> <span class="n">macrophyte_uptake_P</span>

    <span class="c1"># TODO source/sink for benthos sediment P suspension/resuspension</span>
    <span class="k">return</span> <span class="n">in_</span><span class="p">,</span> <span class="n">out_</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="wsimod.nodes.storage.River.calculate_discharge" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_discharge</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        

            <details class="quote">
              <summary>Source code in <code>wsimod/nodes/storage.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_discharge</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;nitrate&quot;</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">POLLUTANTS</span><span class="p">:</span>
        <span class="c1"># TODO clumsy Run biochemical processes</span>
        <span class="n">in_</span><span class="p">,</span> <span class="n">out_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">biochemical_processes</span><span class="p">()</span>
        <span class="c1"># Mass balance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bio_in</span> <span class="o">=</span> <span class="n">in_</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bio_out</span> <span class="o">=</span> <span class="n">out_</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="wsimod.nodes.storage.River.distribute" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">distribute</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Run biochemical processes, track mass balance, and distribute water.</p>

            <details class="quote">
              <summary>Source code in <code>wsimod/nodes/storage.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">distribute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run biochemical processes, track mass balance, and distribute water.&quot;&quot;&quot;</span>
    <span class="c1"># self.calculate_discharge() Get outflow</span>
    <span class="n">outflow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">pull_storage</span><span class="p">(</span>
        <span class="p">{</span><span class="s2">&quot;volume&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_riverrc</span><span class="p">()}</span>
    <span class="p">)</span>
    <span class="c1"># Distribute outflow</span>
    <span class="n">reply</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_distributed</span><span class="p">(</span><span class="n">outflow</span><span class="p">,</span> <span class="n">of_type</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;River&quot;</span><span class="p">,</span> <span class="s2">&quot;Node&quot;</span><span class="p">,</span> <span class="s2">&quot;Waste&quot;</span><span class="p">])</span>
    <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="n">reply</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">constants</span><span class="o">.</span><span class="n">FLOAT_ACCURACY</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;river cant push: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="wsimod.nodes.storage.River.end_timestep_" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">end_timestep_</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Update state variables.</p>

            <details class="quote">
              <summary>Source code in <code>wsimod/nodes/storage.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span>
<span class="normal">954</span>
<span class="normal">955</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">end_timestep_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update state variables.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">end_timestep</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bio_in</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bio_out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="wsimod.nodes.storage.River.get_din_pool" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_din_pool</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get total dissolved inorganic nitrogen from tank storage.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>total din</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>wsimod/nodes/storage.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_din_pool</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get total dissolved inorganic nitrogen from tank storage.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (float): total din</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span>
        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">din_components</span><span class="p">]</span>
    <span class="p">)</span>  <span class="c1"># TODO + self.tank.storage[&#39;nitrite&#39;] but nitrite might not be modelled...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="wsimod.nodes.storage.River.get_riverrc" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_riverrc</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get river outflow coefficient (i.e., how much water leaves the tank in this
timestep).</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>riverrc</code></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>outflow coeffficient</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>wsimod/nodes/storage.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_riverrc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get river outflow coefficient (i.e., how much water leaves the tank in this</span>
<span class="sd">    timestep).</span>

<span class="sd">    Returns:</span>
<span class="sd">        riverrc (float): outflow coeffficient</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Calculate travel time</span>
    <span class="n">total_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">velocity</span>
    <span class="c1"># Apply damp</span>
    <span class="n">kt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">damp</span> <span class="o">*</span> <span class="n">total_time</span>  <span class="c1"># [day]</span>
    <span class="k">if</span> <span class="n">kt</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">riverrc</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">kt</span> <span class="o">+</span> <span class="n">kt</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">/</span> <span class="n">kt</span><span class="p">)</span>  <span class="c1"># [-]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">riverrc</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">riverrc</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="wsimod.nodes.storage.River.pull_check_fp" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pull_check_fp</span><span class="p">(</span><span class="n">vqip</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>vqip</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:</p>

            <details class="quote">
              <summary>Source code in <code>wsimod/nodes/storage.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">pull_check_fp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vqip</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Args:</span>
<span class="sd">        vqip:</span>

<span class="sd">    Returns:</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO Pull checking for riparian buffer, needs updating update river depth</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">update_depth</span><span class="p">()</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_depth</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_tank</span><span class="o">.</span><span class="n">storage</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="wsimod.nodes.storage.River.pull_check_river" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pull_check_river</span><span class="p">(</span><span class="n">vqip</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Check amount of water that can be pulled from river tank and upstream.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>vqip</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum water required (only 'volume' is used)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>avail</code></td>            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A VQIP amount that can be pulled</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>wsimod/nodes/storage.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">pull_check_river</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vqip</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check amount of water that can be pulled from river tank and upstream.</span>

<span class="sd">    Args:</span>
<span class="sd">        vqip (dict, optional): Maximum water required (only &#39;volume&#39; is used)</span>

<span class="sd">    Returns:</span>
<span class="sd">        avail (dict): A VQIP amount that can be pulled</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get storage</span>
    <span class="n">avail</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">get_avail</span><span class="p">()</span>

    <span class="c1"># Check incoming</span>
    <span class="n">upstream</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_connected</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="s2">&quot;pull&quot;</span><span class="p">,</span> <span class="n">of_type</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;River&quot;</span><span class="p">,</span> <span class="s2">&quot;Node&quot;</span><span class="p">])</span>
    <span class="n">avail</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">upstream</span><span class="p">[</span><span class="s2">&quot;avail&quot;</span><span class="p">]</span>

    <span class="c1"># convert mrf from volume/timestep to discrete value</span>
    <span class="n">mrf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mrf</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_riverrc</span><span class="p">()</span>

    <span class="c1"># Apply mrf</span>
    <span class="n">avail_vol</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">avail</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">mrf</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">vqip</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">avail</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_change_vqip</span><span class="p">(</span><span class="n">avail</span><span class="p">,</span> <span class="n">avail_vol</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">avail</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_change_vqip</span><span class="p">(</span><span class="n">avail</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">avail_vol</span><span class="p">,</span> <span class="n">vqip</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]))</span>

    <span class="k">return</span> <span class="n">avail</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="wsimod.nodes.storage.River.pull_set_river" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pull_set_river</span><span class="p">(</span><span class="n">vqip</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Pull from river tank and upstream, acknowledging MRF with pull_check.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>vqip</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A VQIP amount to pull (only volume key used)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A VQIP amount that was pulled</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>wsimod/nodes/storage.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">pull_set_river</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vqip</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Pull from river tank and upstream, acknowledging MRF with pull_check.</span>

<span class="sd">    Args:</span>
<span class="sd">        vqip (dict): A VQIP amount to pull (only volume key used)</span>

<span class="sd">    Returns:</span>
<span class="sd">        (dict): A VQIP amount that was pulled</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Calculate available pull</span>
    <span class="n">avail</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pull_check_river</span><span class="p">(</span><span class="n">vqip</span><span class="p">)</span>

    <span class="c1"># Take first from tank</span>
    <span class="n">pulled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">pull_storage</span><span class="p">(</span><span class="n">avail</span><span class="p">)</span>

    <span class="c1"># Take remaining from upstream</span>
    <span class="n">to_pull</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;volume&quot;</span><span class="p">:</span> <span class="n">avail</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">pulled</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]}</span>
    <span class="n">pulled_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pull_distributed</span><span class="p">(</span><span class="n">to_pull</span><span class="p">,</span> <span class="n">of_type</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;River&quot;</span><span class="p">,</span> <span class="s2">&quot;Node&quot;</span><span class="p">])</span>

    <span class="n">reply</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum_vqip</span><span class="p">(</span><span class="n">pulled</span><span class="p">,</span> <span class="n">pulled_</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">reply</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="wsimod.nodes.storage.River.push_set_river" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">push_set_river</span><span class="p">(</span><span class="n">vqip</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Push to river tank, currently forced.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>vqip</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A VQIP amount to push</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A VQIP amount that was not successfully received</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>wsimod/nodes/storage.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">push_set_river</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vqip</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Push to river tank, currently forced.</span>

<span class="sd">    Args:</span>
<span class="sd">        vqip (dict): A VQIP amount to push</span>

<span class="sd">    Returns:</span>
<span class="sd">        (dict): A VQIP amount that was not successfully received</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="n">vqip</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="wsimod.nodes.storage.River.update_depth" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_depth</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Recalculate depth.</p>

            <details class="quote">
              <summary>Source code in <code>wsimod/nodes/storage.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">update_depth</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Recalculate depth.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">current_depth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="wsimod.nodes.storage.RiverReservoir" class="doc doc-heading">
            <code>RiverReservoir</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="wsimod.nodes.storage.Reservoir" href="#wsimod.nodes.storage.Reservoir">Reservoir</a></code></p>


        






              <details class="quote">
                <summary>Source code in <code>wsimod/nodes/storage.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">RiverReservoir</span><span class="p">(</span><span class="n">Reservoir</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environmental_flow</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A reservoir with a natural river inflow, includes an environmental downstream</span>
<span class="sd">        flow to satisfy.</span>

<span class="sd">        Args:</span>
<span class="sd">            environmental_flow (float, optional): Downstream environmental flow.</span>
<span class="sd">                Defaults to 0.</span>

<span class="sd">        Functions intended to call in orchestration:</span>
<span class="sd">                make_abstractions (if any)</span>

<span class="sd">                satisfy_environmental (before river routing.. possibly before</span>
<span class="sd">                    downstream river abstractions depending on licence)</span>

<span class="sd">        Key assumptions:</span>
<span class="sd">            - Conceptualised as a `Tank`.</span>
<span class="sd">            - Recharged via pumped abstractions and receives water from</span>
<span class="sd">                inflowing arcs.</span>
<span class="sd">            - Reservoir aims to satisfy a static `environmental_flow`.</span>
<span class="sd">            - If tank capacity is exceeded, reservoir spills downstream</span>
<span class="sd">                towards `nodes.py/Node`, `storage.py/River` or `waste.py/Waste` nodes.</span>
<span class="sd">                Spill counts towards `environmental_flow`.</span>
<span class="sd">            - Evaporation/precipitation onto surface area currently ignored.</span>
<span class="sd">            - Currently, if a reservoir satisfies a pull from a downstream</span>
<span class="sd">                node, it does __not__ count towards `environmental_flow`.</span>
<span class="sd">            - If `decays` are provided to model water quality transformations,</span>
<span class="sd">                see `core.py/DecayObj`.</span>

<span class="sd">        Input data and parameter requirements:</span>
<span class="sd">            - Tank `capacity`, `area`, and `datum`.</span>
<span class="sd">                _Units_: cubic metres, squared metres, metres</span>
<span class="sd">            - `environmental_flow`</span>
<span class="sd">                _Units_: cubic metres/timestep</span>
<span class="sd">            - Optional dictionary of decays with pollutants as keys and decay</span>
<span class="sd">                parameters (a constant and a temperature sensitivity exponent) as</span>
<span class="sd">                values. _Units_: -</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">environmental_flow</span> <span class="o">=</span> <span class="n">environmental_flow</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># State variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_environmental_satisfied</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">push_set_handler</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_set_river_reservoir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push_check_handler</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_check_river_reservoir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_timestep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_timestep_</span>

        <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="s2">&quot;Reservoir&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">apply_overrides</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">overrides</span><span class="o">=</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Override parameters.</span>

<span class="sd">        Enables a user to override any of the following parameters:</span>
<span class="sd">        environmental_flow.</span>

<span class="sd">        Args:</span>
<span class="sd">            overrides (Dict[str, Any]): Dict describing which parameters should</span>
<span class="sd">                be overridden (keys) and new values (values). Defaults to {}.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">environmental_flow</span> <span class="o">=</span> <span class="n">overrides</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span>
            <span class="s2">&quot;environmental_flow&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">environmental_flow</span>
        <span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">apply_overrides</span><span class="p">(</span><span class="n">overrides</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">push_set_river_reservoir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vqip</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Receive water.</span>

<span class="sd">        Args:</span>
<span class="sd">            vqip (dict): A VQIP amount to be received</span>

<span class="sd">        Returns:</span>
<span class="sd">            reply (dict): A VQIP amount that was not successfully received</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Apply normal reservoir storage We do this under the assumption that spill is</span>
        <span class="c1"># mixed in with the reservoir If the reservoir can&#39;t spill everything you&#39;ll get</span>
        <span class="c1"># some weird numbers in reply, but if your reservoir can&#39;t spill as much as you</span>
        <span class="c1"># like then you should probably be pushing the right amount through</span>
        <span class="c1"># push_check_river_reservoir Some cunning could probably avoid this by checking</span>
        <span class="c1"># vqip, but this is a serious edge case</span>
        <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="n">vqip</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">spill</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">pull_ponded</span><span class="p">()</span>

        <span class="c1"># Send spill downstream</span>
        <span class="n">reply</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_distributed</span><span class="p">(</span><span class="n">spill</span><span class="p">,</span> <span class="n">of_type</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Node&quot;</span><span class="p">,</span> <span class="s2">&quot;River&quot;</span><span class="p">,</span> <span class="s2">&quot;Waste&quot;</span><span class="p">])</span>

        <span class="c1"># Use spill to satisfy downstream flow</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_environmental_satisfied</span> <span class="o">+=</span> <span class="n">spill</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">reply</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">reply</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">push_check_river_reservoir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vqip</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A push check to receive water, assumes spill may occur and checks downstream</span>
<span class="sd">        capacity.</span>

<span class="sd">        Args:</span>
<span class="sd">            vqip (dict, optional): A VQIP that can be used to limit the volume in</span>
<span class="sd">                the return value (only volume key is used). Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            excess (dict): A VQIP amount of water that cannot be received</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check downstream capacity (i.e., that would be spilled)</span>
        <span class="n">downstream_availability</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_connected</span><span class="p">(</span>
            <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;push&quot;</span><span class="p">,</span> <span class="n">of_type</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Node&quot;</span><span class="p">,</span> <span class="s2">&quot;River&quot;</span><span class="p">,</span> <span class="s2">&quot;Waste&quot;</span><span class="p">]</span>
        <span class="p">)[</span><span class="s2">&quot;avail&quot;</span><span class="p">]</span>
        <span class="c1"># Check excess capacity in the reservoir</span>
        <span class="n">excess</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">get_excess</span><span class="p">()</span>
        <span class="c1"># Combine excess and downstream in response</span>
        <span class="n">new_v</span> <span class="o">=</span> <span class="n">excess</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">downstream_availability</span>
        <span class="k">if</span> <span class="n">vqip</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">new_v</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">vqip</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">],</span> <span class="n">new_v</span><span class="p">)</span>
        <span class="c1"># Update to vqip</span>
        <span class="n">excess</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_change_vqip</span><span class="p">(</span><span class="n">excess</span><span class="p">,</span> <span class="n">new_v</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">excess</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">satisfy_environmental</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Satisfy environmental flow downstream.&quot;&quot;&quot;</span>
        <span class="c1"># Calculate how much environmental flow is yet to satisfy #(some may have been</span>
        <span class="c1"># already if pull-and-take abstractions have taken place)</span>
        <span class="n">to_satisfy</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">environmental_flow</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_environmental_satisfied</span><span class="p">,</span> <span class="mi">0</span>
        <span class="p">)</span>
        <span class="c1"># Pull from tank</span>
        <span class="n">environmental</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">pull_storage</span><span class="p">({</span><span class="s2">&quot;volume&quot;</span><span class="p">:</span> <span class="n">to_satisfy</span><span class="p">})</span>
        <span class="c1"># Send downstream</span>
        <span class="n">reply</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_distributed</span><span class="p">(</span><span class="n">environmental</span><span class="p">)</span>
        <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="n">reply</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">constants</span><span class="o">.</span><span class="n">FLOAT_ACCURACY</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;warning: environmental not able to push&quot;</span><span class="p">)</span>

        <span class="c1"># Update satisfaction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_environmental_satisfied</span> <span class="o">+=</span> <span class="n">environmental</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">end_timestep_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Udpate state varibles.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">end_timestep</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_environmental_satisfied</span> <span class="o">=</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="wsimod.nodes.storage.RiverReservoir.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">environmental_flow</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>A reservoir with a natural river inflow, includes an environmental downstream
flow to satisfy.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>environmental_flow</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Downstream environmental flow.
Defaults to 0.</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="functions-intended-to-call-in-orchestration" open>
  <summary>Functions intended to call in orchestration</summary>
  <p>make_abstractions (if any)</p>
<p>satisfy_environmental (before river routing.. possibly before
    downstream river abstractions depending on licence)</p>
</details>

<details class="key-assumptions" open>
  <summary>Key assumptions</summary>
  <ul>
<li>Conceptualised as a <code>Tank</code>.</li>
<li>Recharged via pumped abstractions and receives water from
    inflowing arcs.</li>
<li>Reservoir aims to satisfy a static <code>environmental_flow</code>.</li>
<li>If tank capacity is exceeded, reservoir spills downstream
    towards <code>nodes.py/Node</code>, <code>storage.py/River</code> or <code>waste.py/Waste</code> nodes.
    Spill counts towards <code>environmental_flow</code>.</li>
<li>Evaporation/precipitation onto surface area currently ignored.</li>
<li>Currently, if a reservoir satisfies a pull from a downstream
    node, it does <strong>not</strong> count towards <code>environmental_flow</code>.</li>
<li>If <code>decays</code> are provided to model water quality transformations,
    see <code>core.py/DecayObj</code>.</li>
</ul>
</details>

<details class="input-data-and-parameter-requirements" open>
  <summary>Input data and parameter requirements</summary>
  <ul>
<li>Tank <code>capacity</code>, <code>area</code>, and <code>datum</code>.
    <em>Units</em>: cubic metres, squared metres, metres</li>
<li><code>environmental_flow</code>
    <em>Units</em>: cubic metres/timestep</li>
<li>Optional dictionary of decays with pollutants as keys and decay
    parameters (a constant and a temperature sensitivity exponent) as
    values. <em>Units</em>: -</li>
</ul>
</details>
            <details class="quote">
              <summary>Source code in <code>wsimod/nodes/storage.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environmental_flow</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A reservoir with a natural river inflow, includes an environmental downstream</span>
<span class="sd">    flow to satisfy.</span>

<span class="sd">    Args:</span>
<span class="sd">        environmental_flow (float, optional): Downstream environmental flow.</span>
<span class="sd">            Defaults to 0.</span>

<span class="sd">    Functions intended to call in orchestration:</span>
<span class="sd">            make_abstractions (if any)</span>

<span class="sd">            satisfy_environmental (before river routing.. possibly before</span>
<span class="sd">                downstream river abstractions depending on licence)</span>

<span class="sd">    Key assumptions:</span>
<span class="sd">        - Conceptualised as a `Tank`.</span>
<span class="sd">        - Recharged via pumped abstractions and receives water from</span>
<span class="sd">            inflowing arcs.</span>
<span class="sd">        - Reservoir aims to satisfy a static `environmental_flow`.</span>
<span class="sd">        - If tank capacity is exceeded, reservoir spills downstream</span>
<span class="sd">            towards `nodes.py/Node`, `storage.py/River` or `waste.py/Waste` nodes.</span>
<span class="sd">            Spill counts towards `environmental_flow`.</span>
<span class="sd">        - Evaporation/precipitation onto surface area currently ignored.</span>
<span class="sd">        - Currently, if a reservoir satisfies a pull from a downstream</span>
<span class="sd">            node, it does __not__ count towards `environmental_flow`.</span>
<span class="sd">        - If `decays` are provided to model water quality transformations,</span>
<span class="sd">            see `core.py/DecayObj`.</span>

<span class="sd">    Input data and parameter requirements:</span>
<span class="sd">        - Tank `capacity`, `area`, and `datum`.</span>
<span class="sd">            _Units_: cubic metres, squared metres, metres</span>
<span class="sd">        - `environmental_flow`</span>
<span class="sd">            _Units_: cubic metres/timestep</span>
<span class="sd">        - Optional dictionary of decays with pollutants as keys and decay</span>
<span class="sd">            parameters (a constant and a temperature sensitivity exponent) as</span>
<span class="sd">            values. _Units_: -</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Parameters</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">environmental_flow</span> <span class="o">=</span> <span class="n">environmental_flow</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># State variables</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">total_environmental_satisfied</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">push_set_handler</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_set_river_reservoir</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">push_check_handler</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_check_river_reservoir</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">end_timestep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_timestep_</span>

    <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="s2">&quot;Reservoir&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="wsimod.nodes.storage.RiverReservoir.apply_overrides" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">apply_overrides</span><span class="p">(</span><span class="n">overrides</span><span class="o">=</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Override parameters.</p>
<p>Enables a user to override any of the following parameters:
environmental_flow.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>overrides</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dict describing which parameters should
be overridden (keys) and new values (values). Defaults to {}.</p>
              </div>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>wsimod/nodes/storage.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">apply_overrides</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">overrides</span><span class="o">=</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Override parameters.</span>

<span class="sd">    Enables a user to override any of the following parameters:</span>
<span class="sd">    environmental_flow.</span>

<span class="sd">    Args:</span>
<span class="sd">        overrides (Dict[str, Any]): Dict describing which parameters should</span>
<span class="sd">            be overridden (keys) and new values (values). Defaults to {}.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">environmental_flow</span> <span class="o">=</span> <span class="n">overrides</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span>
        <span class="s2">&quot;environmental_flow&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">environmental_flow</span>
    <span class="p">)</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">apply_overrides</span><span class="p">(</span><span class="n">overrides</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="wsimod.nodes.storage.RiverReservoir.end_timestep_" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">end_timestep_</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Udpate state varibles.</p>

            <details class="quote">
              <summary>Source code in <code>wsimod/nodes/storage.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">end_timestep_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Udpate state varibles.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">end_timestep</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">total_environmental_satisfied</span> <span class="o">=</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="wsimod.nodes.storage.RiverReservoir.push_check_river_reservoir" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">push_check_river_reservoir</span><span class="p">(</span><span class="n">vqip</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>A push check to receive water, assumes spill may occur and checks downstream
capacity.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>vqip</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A VQIP that can be used to limit the volume in
the return value (only volume key is used). Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>excess</code></td>            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A VQIP amount of water that cannot be received</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>wsimod/nodes/storage.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">push_check_river_reservoir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vqip</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A push check to receive water, assumes spill may occur and checks downstream</span>
<span class="sd">    capacity.</span>

<span class="sd">    Args:</span>
<span class="sd">        vqip (dict, optional): A VQIP that can be used to limit the volume in</span>
<span class="sd">            the return value (only volume key is used). Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        excess (dict): A VQIP amount of water that cannot be received</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check downstream capacity (i.e., that would be spilled)</span>
    <span class="n">downstream_availability</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_connected</span><span class="p">(</span>
        <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;push&quot;</span><span class="p">,</span> <span class="n">of_type</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Node&quot;</span><span class="p">,</span> <span class="s2">&quot;River&quot;</span><span class="p">,</span> <span class="s2">&quot;Waste&quot;</span><span class="p">]</span>
    <span class="p">)[</span><span class="s2">&quot;avail&quot;</span><span class="p">]</span>
    <span class="c1"># Check excess capacity in the reservoir</span>
    <span class="n">excess</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">get_excess</span><span class="p">()</span>
    <span class="c1"># Combine excess and downstream in response</span>
    <span class="n">new_v</span> <span class="o">=</span> <span class="n">excess</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">downstream_availability</span>
    <span class="k">if</span> <span class="n">vqip</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">new_v</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">vqip</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">],</span> <span class="n">new_v</span><span class="p">)</span>
    <span class="c1"># Update to vqip</span>
    <span class="n">excess</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_change_vqip</span><span class="p">(</span><span class="n">excess</span><span class="p">,</span> <span class="n">new_v</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">excess</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="wsimod.nodes.storage.RiverReservoir.push_set_river_reservoir" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">push_set_river_reservoir</span><span class="p">(</span><span class="n">vqip</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Receive water.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>vqip</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A VQIP amount to be received</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>reply</code></td>            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A VQIP amount that was not successfully received</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>wsimod/nodes/storage.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">push_set_river_reservoir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vqip</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Receive water.</span>

<span class="sd">    Args:</span>
<span class="sd">        vqip (dict): A VQIP amount to be received</span>

<span class="sd">    Returns:</span>
<span class="sd">        reply (dict): A VQIP amount that was not successfully received</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Apply normal reservoir storage We do this under the assumption that spill is</span>
    <span class="c1"># mixed in with the reservoir If the reservoir can&#39;t spill everything you&#39;ll get</span>
    <span class="c1"># some weird numbers in reply, but if your reservoir can&#39;t spill as much as you</span>
    <span class="c1"># like then you should probably be pushing the right amount through</span>
    <span class="c1"># push_check_river_reservoir Some cunning could probably avoid this by checking</span>
    <span class="c1"># vqip, but this is a serious edge case</span>
    <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="n">vqip</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">spill</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">pull_ponded</span><span class="p">()</span>

    <span class="c1"># Send spill downstream</span>
    <span class="n">reply</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_distributed</span><span class="p">(</span><span class="n">spill</span><span class="p">,</span> <span class="n">of_type</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Node&quot;</span><span class="p">,</span> <span class="s2">&quot;River&quot;</span><span class="p">,</span> <span class="s2">&quot;Waste&quot;</span><span class="p">])</span>

    <span class="c1"># Use spill to satisfy downstream flow</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">total_environmental_satisfied</span> <span class="o">+=</span> <span class="n">spill</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">reply</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">reply</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="wsimod.nodes.storage.RiverReservoir.satisfy_environmental" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">satisfy_environmental</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Satisfy environmental flow downstream.</p>

            <details class="quote">
              <summary>Source code in <code>wsimod/nodes/storage.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">satisfy_environmental</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Satisfy environmental flow downstream.&quot;&quot;&quot;</span>
    <span class="c1"># Calculate how much environmental flow is yet to satisfy #(some may have been</span>
    <span class="c1"># already if pull-and-take abstractions have taken place)</span>
    <span class="n">to_satisfy</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">environmental_flow</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_environmental_satisfied</span><span class="p">,</span> <span class="mi">0</span>
    <span class="p">)</span>
    <span class="c1"># Pull from tank</span>
    <span class="n">environmental</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">pull_storage</span><span class="p">({</span><span class="s2">&quot;volume&quot;</span><span class="p">:</span> <span class="n">to_satisfy</span><span class="p">})</span>
    <span class="c1"># Send downstream</span>
    <span class="n">reply</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_distributed</span><span class="p">(</span><span class="n">environmental</span><span class="p">)</span>
    <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="n">reply</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">constants</span><span class="o">.</span><span class="n">FLOAT_ACCURACY</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;warning: environmental not able to push&quot;</span><span class="p">)</span>

    <span class="c1"># Update satisfaction</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">total_environmental_satisfied</span> <span class="o">+=</span> <span class="n">environmental</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="wsimod.nodes.storage.Storage" class="doc doc-heading">
            <code>Storage</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="wsimod.nodes.nodes.Node" href="../reference-nodes/#wsimod.nodes.nodes.Node">Node</a></code></p>


        






              <details class="quote">
                <summary>Source code in <code>wsimod/nodes/storage.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Storage</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">,</span>
        <span class="n">capacity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">area</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">datum</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">decays</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">initial_storage</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A Node wrapper for a Tank or DecayTank.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): node name capacity (float, optional): Tank capacity (see</span>
<span class="sd">            nodes.py/Tank). Defaults to 0. area (float, optional): Tank area (see</span>
<span class="sd">            nodes.py/Tank). Defaults to 0. datum (float, optional): Tank datum (see</span>
<span class="sd">            nodes.py/Tank). Defaults to 0. decays (dict, optional): Tank decays if</span>
<span class="sd">            needed, (see nodes.py/DecayTank). Defaults to None. initial_storage (float</span>
<span class="sd">            or dict, optional): Initial storage (see nodes.py/Tank). Defaults to 0.</span>

<span class="sd">        Functions intended to call in orchestration:</span>
<span class="sd">            distribute (optional, depends on subclass)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Set parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initial_storage</span> <span class="o">=</span> <span class="n">initial_storage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">capacity</span> <span class="o">=</span> <span class="n">capacity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">area</span> <span class="o">=</span> <span class="n">area</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">datum</span> <span class="o">=</span> <span class="n">datum</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decays</span> <span class="o">=</span> <span class="n">decays</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># Create tank</span>
        <span class="k">if</span> <span class="s2">&quot;initial_storage&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">initial_storage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">decays</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tank</span> <span class="o">=</span> <span class="n">Tank</span><span class="p">(</span>
                <span class="n">capacity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">capacity</span><span class="p">,</span>
                <span class="n">area</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">area</span><span class="p">,</span>
                <span class="n">datum</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">datum</span><span class="p">,</span>
                <span class="n">initial_storage</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_storage</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tank</span> <span class="o">=</span> <span class="n">DecayTank</span><span class="p">(</span>
                <span class="n">capacity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">capacity</span><span class="p">,</span>
                <span class="n">area</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">area</span><span class="p">,</span>
                <span class="n">datum</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">datum</span><span class="p">,</span>
                <span class="n">initial_storage</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_storage</span><span class="p">,</span>
                <span class="n">decays</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">decays</span><span class="p">,</span>
                <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="c1"># Update handlers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push_set_handler</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_set_storage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push_check_handler</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">get_excess</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pull_set_handler</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">vol</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">pull_storage</span><span class="p">(</span><span class="n">vol</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pull_check_handler</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">get_avail</span>

        <span class="c1"># Mass balance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mass_balance_ds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">ds</span><span class="p">())</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">apply_overrides</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">overrides</span><span class="o">=</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Override parameters.</span>

<span class="sd">        Enables a user to override any of the following parameters:</span>
<span class="sd">        capacity, area, datum, decays.</span>

<span class="sd">        Args:</span>
<span class="sd">            overrides (Dict[str, Any]): Dict describing which parameters should</span>
<span class="sd">                be overridden (keys) and new values (values). Defaults to {}.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># not using pop as these items need to stay</span>
        <span class="c1"># in the overrides to be fed into the tank overrides</span>
        <span class="k">if</span> <span class="s2">&quot;capacity&quot;</span> <span class="ow">in</span> <span class="n">overrides</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">capacity</span> <span class="o">=</span> <span class="n">overrides</span><span class="p">[</span><span class="s2">&quot;capacity&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;area&quot;</span> <span class="ow">in</span> <span class="n">overrides</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">area</span> <span class="o">=</span> <span class="n">overrides</span><span class="p">[</span><span class="s2">&quot;area&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;datum&quot;</span> <span class="ow">in</span> <span class="n">overrides</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">datum</span> <span class="o">=</span> <span class="n">overrides</span><span class="p">[</span><span class="s2">&quot;datum&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;decays&quot;</span> <span class="ow">in</span> <span class="n">overrides</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">decays</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Attempting to override decays on a node initialised without decays&quot;</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">decays</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">overrides</span><span class="p">[</span><span class="s2">&quot;decays&quot;</span><span class="p">])</span>
        <span class="c1"># apply tank overrides</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">apply_overrides</span><span class="p">(</span><span class="n">overrides</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">apply_overrides</span><span class="p">(</span><span class="n">overrides</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">push_set_storage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vqip</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A node wrapper for the tank push_storage.</span>

<span class="sd">        Args:</span>
<span class="sd">            vqip (dict): A VQIP amount to push to the tank</span>

<span class="sd">        Returns:</span>
<span class="sd">            reply (dict): A VQIP amount that was not successfully pushed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Update tank</span>
        <span class="n">reply</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="n">vqip</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">reply</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">distribute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Optional function that discharges all tank storage with push_distributed.&quot;&quot;&quot;</span>
        <span class="c1"># Distribute any active storage</span>
        <span class="n">storage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">pull_storage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">get_avail</span><span class="p">())</span>
        <span class="n">retained</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_distributed</span><span class="p">(</span><span class="n">storage</span><span class="p">)</span>
        <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="n">retained</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">retained</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">constants</span><span class="o">.</span><span class="n">FLOAT_ACCURACY</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Storage unable to push&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_percent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Function that returns the volume in the storage tank expressed as a percent</span>
<span class="sd">        of capacity.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">capacity</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">end_timestep</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update tank states.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">end_timestep</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">reinit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call tank reinit.&quot;&quot;&quot;</span>
        <span class="c1"># TODO Automate this better</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">reinit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_storage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage_</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_storage</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="wsimod.nodes.storage.Storage.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">capacity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">area</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">datum</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">decays</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">initial_storage</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>A Node wrapper for a Tank or DecayTank.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>node name capacity (float, optional): Tank capacity (see</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>nodes.py/Tank).</code>
            </td>
            <td>
                  <code>Defaults to 0. area (float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tank area (see</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>nodes.py/Tank).</code>
            </td>
            <td>
                  <code>Defaults to 0. datum (float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tank datum (see</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>nodes.py/Tank).</code>
            </td>
            <td>
                  <code>Defaults to 0. decays (dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tank decays if</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>or</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Initial storage (see nodes.py/Tank). Defaults to 0.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<details class="functions-intended-to-call-in-orchestration" open>
  <summary>Functions intended to call in orchestration</summary>
  <p>distribute (optional, depends on subclass)</p>
</details>
            <details class="quote">
              <summary>Source code in <code>wsimod/nodes/storage.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">name</span><span class="p">,</span>
    <span class="n">capacity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">area</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">datum</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">decays</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">initial_storage</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A Node wrapper for a Tank or DecayTank.</span>

<span class="sd">    Args:</span>
<span class="sd">        name (str): node name capacity (float, optional): Tank capacity (see</span>
<span class="sd">        nodes.py/Tank). Defaults to 0. area (float, optional): Tank area (see</span>
<span class="sd">        nodes.py/Tank). Defaults to 0. datum (float, optional): Tank datum (see</span>
<span class="sd">        nodes.py/Tank). Defaults to 0. decays (dict, optional): Tank decays if</span>
<span class="sd">        needed, (see nodes.py/DecayTank). Defaults to None. initial_storage (float</span>
<span class="sd">        or dict, optional): Initial storage (see nodes.py/Tank). Defaults to 0.</span>

<span class="sd">    Functions intended to call in orchestration:</span>
<span class="sd">        distribute (optional, depends on subclass)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Set parameters</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">initial_storage</span> <span class="o">=</span> <span class="n">initial_storage</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">capacity</span> <span class="o">=</span> <span class="n">capacity</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">area</span> <span class="o">=</span> <span class="n">area</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">datum</span> <span class="o">=</span> <span class="n">datum</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">decays</span> <span class="o">=</span> <span class="n">decays</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># Create tank</span>
    <span class="k">if</span> <span class="s2">&quot;initial_storage&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initial_storage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">decays</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tank</span> <span class="o">=</span> <span class="n">Tank</span><span class="p">(</span>
            <span class="n">capacity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">capacity</span><span class="p">,</span>
            <span class="n">area</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">area</span><span class="p">,</span>
            <span class="n">datum</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">datum</span><span class="p">,</span>
            <span class="n">initial_storage</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_storage</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tank</span> <span class="o">=</span> <span class="n">DecayTank</span><span class="p">(</span>
            <span class="n">capacity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">capacity</span><span class="p">,</span>
            <span class="n">area</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">area</span><span class="p">,</span>
            <span class="n">datum</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">datum</span><span class="p">,</span>
            <span class="n">initial_storage</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_storage</span><span class="p">,</span>
            <span class="n">decays</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">decays</span><span class="p">,</span>
            <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="c1"># Update handlers</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">push_set_handler</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_set_storage</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">push_check_handler</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">get_excess</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pull_set_handler</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">vol</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">pull_storage</span><span class="p">(</span><span class="n">vol</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pull_check_handler</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">get_avail</span>

    <span class="c1"># Mass balance</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mass_balance_ds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">ds</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="wsimod.nodes.storage.Storage.apply_overrides" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">apply_overrides</span><span class="p">(</span><span class="n">overrides</span><span class="o">=</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Override parameters.</p>
<p>Enables a user to override any of the following parameters:
capacity, area, datum, decays.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>overrides</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dict describing which parameters should
be overridden (keys) and new values (values). Defaults to {}.</p>
              </div>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>wsimod/nodes/storage.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">apply_overrides</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">overrides</span><span class="o">=</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Override parameters.</span>

<span class="sd">    Enables a user to override any of the following parameters:</span>
<span class="sd">    capacity, area, datum, decays.</span>

<span class="sd">    Args:</span>
<span class="sd">        overrides (Dict[str, Any]): Dict describing which parameters should</span>
<span class="sd">            be overridden (keys) and new values (values). Defaults to {}.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># not using pop as these items need to stay</span>
    <span class="c1"># in the overrides to be fed into the tank overrides</span>
    <span class="k">if</span> <span class="s2">&quot;capacity&quot;</span> <span class="ow">in</span> <span class="n">overrides</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">capacity</span> <span class="o">=</span> <span class="n">overrides</span><span class="p">[</span><span class="s2">&quot;capacity&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="s2">&quot;area&quot;</span> <span class="ow">in</span> <span class="n">overrides</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">area</span> <span class="o">=</span> <span class="n">overrides</span><span class="p">[</span><span class="s2">&quot;area&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="s2">&quot;datum&quot;</span> <span class="ow">in</span> <span class="n">overrides</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">datum</span> <span class="o">=</span> <span class="n">overrides</span><span class="p">[</span><span class="s2">&quot;datum&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="s2">&quot;decays&quot;</span> <span class="ow">in</span> <span class="n">overrides</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">decays</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Attempting to override decays on a node initialised without decays&quot;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decays</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">overrides</span><span class="p">[</span><span class="s2">&quot;decays&quot;</span><span class="p">])</span>
    <span class="c1"># apply tank overrides</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">apply_overrides</span><span class="p">(</span><span class="n">overrides</span><span class="p">)</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">apply_overrides</span><span class="p">(</span><span class="n">overrides</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="wsimod.nodes.storage.Storage.distribute" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">distribute</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Optional function that discharges all tank storage with push_distributed.</p>

            <details class="quote">
              <summary>Source code in <code>wsimod/nodes/storage.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">distribute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Optional function that discharges all tank storage with push_distributed.&quot;&quot;&quot;</span>
    <span class="c1"># Distribute any active storage</span>
    <span class="n">storage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">pull_storage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">get_avail</span><span class="p">())</span>
    <span class="n">retained</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_distributed</span><span class="p">(</span><span class="n">storage</span><span class="p">)</span>
    <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="n">retained</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">retained</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">constants</span><span class="o">.</span><span class="n">FLOAT_ACCURACY</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Storage unable to push&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="wsimod.nodes.storage.Storage.end_timestep" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">end_timestep</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Update tank states.</p>

            <details class="quote">
              <summary>Source code in <code>wsimod/nodes/storage.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">end_timestep</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update tank states.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">end_timestep</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="wsimod.nodes.storage.Storage.get_percent" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_percent</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Function that returns the volume in the storage tank expressed as a percent
of capacity.</p>

            <details class="quote">
              <summary>Source code in <code>wsimod/nodes/storage.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_percent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function that returns the volume in the storage tank expressed as a percent</span>
<span class="sd">    of capacity.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">capacity</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="wsimod.nodes.storage.Storage.push_set_storage" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">push_set_storage</span><span class="p">(</span><span class="n">vqip</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>A node wrapper for the tank push_storage.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>vqip</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A VQIP amount to push to the tank</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>reply</code></td>            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A VQIP amount that was not successfully pushed</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>wsimod/nodes/storage.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">push_set_storage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vqip</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A node wrapper for the tank push_storage.</span>

<span class="sd">    Args:</span>
<span class="sd">        vqip (dict): A VQIP amount to push to the tank</span>

<span class="sd">    Returns:</span>
<span class="sd">        reply (dict): A VQIP amount that was not successfully pushed</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Update tank</span>
    <span class="n">reply</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="n">vqip</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">reply</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="wsimod.nodes.storage.Storage.reinit" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">reinit</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Call tank reinit.</p>

            <details class="quote">
              <summary>Source code in <code>wsimod/nodes/storage.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">reinit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Call tank reinit.&quot;&quot;&quot;</span>
    <span class="c1"># TODO Automate this better</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">reinit</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_storage</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tank</span><span class="o">.</span><span class="n">storage_</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_storage</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["content.code.copy"], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>